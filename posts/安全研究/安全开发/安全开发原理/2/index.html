<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>资产搜集 - 东隅 Blog</title><meta name="author" content="东隅">
<meta name="author-link" content="">
<meta name="description" content="" /><meta name="keywords" content='安全开发' />
  <meta itemprop="name" content="资产搜集">
  <meta itemprop="datePublished" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="dateModified" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="wordCount" content="606">
  <meta itemprop="keywords" content="安全开发"><meta property="og:url" content="https://dongyu29.github.io/posts/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91%E5%8E%9F%E7%90%86/2/">
  <meta property="og:site_name" content="东隅 Blog">
  <meta property="og:title" content="资产搜集">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:modified_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:tag" content="安全开发">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="资产搜集">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dongyu29.github.io/posts/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91%E5%8E%9F%E7%90%86/2/" /><link rel="prev" href="https://dongyu29.github.io/posts/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/%E9%80%9A%E7%94%A8/35/" /><link rel="next" href="https://dongyu29.github.io/posts/owasp/http%E8%B5%B0%E7%A7%81/115/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "资产搜集",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/dongyu29.github.io\/posts\/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6\/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91\/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91%E5%8E%9F%E7%90%86\/2\/"
    },"image": ["https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"],"genre": "posts","keywords": "安全开发","wordcount":  606 ,
    "url": "https:\/\/dongyu29.github.io\/posts\/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6\/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91\/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91%E5%8E%9F%E7%90%86\/2\/","datePublished": "2024-08-15T09:31:01+08:00","dateModified": "2024-08-15T09:31:01+08:00","publisher": {
      "@type": "Organization",
      "name": "","logo": "https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"},"author": {
        "@type": "Person",
        "name": "东隅"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ></a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ></a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="东隅 Blog">Home</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">资产搜集</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid x" aria-hidden="true"></i></span><span>资产搜集</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅" data-title="东隅" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;东隅</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/" class="post-category" title="Category - 安全开发"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 安全开发</a></span></div><div class="post-meta-line"><span title="published on 2024-08-15 09:31:01"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-15">2024-08-15</time></span>&nbsp;<span title="606 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 700 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>3 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#oneforall分析">oneforall分析</a>
      <ul>
        <li><a href="#泛域名">泛域名</a></li>
        <li><a href="#收集模块collect">收集模块(Collect)</a></li>
        <li><a href="#srv爆破模块brutesrv">SRV爆破模块(BruteSRV)</a></li>
        <li><a href="#爆破模块brute">爆破模块(Brute)</a></li>
        <li><a href="#dns验证run_resolve">dns验证(run_resolve)</a></li>
        <li><a href="#http验证run_request">http验证(run_request)</a></li>
        <li><a href="#子域爬取模块finder">子域爬取模块(Finder)</a></li>
        <li><a href="#丰富输出enrich">丰富输出(Enrich)</a></li>
        <li><a href="#子域接管模块takeover">子域接管模块(Takeover)</a></li>
        <li><a href="#oneforall存在的一些问题">oneforall存在的一些问题</a></li>
      </ul>
    </li>
    <li><a href="#互联网收集">互联网收集</a>
      <ul>
        <li><a href="#srv记录查询">SRV记录查询</a></li>
        <li><a href="#https证书透明度">HTTPS证书透明度</a></li>
        <li><a href="#子域名查询接口">子域名查询接口</a></li>
        <li><a href="#dns找子域名">DNS找子域名</a></li>
        <li><a href="#威胁情报">威胁情报</a></li>
        <li><a href="#搜索引擎查询">搜索引擎查询</a></li>
      </ul>
    </li>
    <li><a href="#爆破">爆破</a></li>
    <li><a href="#子域名查找">子域名查找</a></li>
    <li><a href="#泛解析域名">泛解析域名</a></li>
    <li><a href="#验证">验证</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="-----（完）-----"><h1 id="子域名" class="heading-element"><span>子域名</span>
  <a href="#%e5%ad%90%e5%9f%9f%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><a href="https://cloud.tencent.com/developer/article/1681277"target="_blank" rel="external nofollow noopener noreferrer">https://cloud.tencent.com/developer/article/1681277</a></p>
<h2 id="oneforall分析" class="heading-element"><span>oneforall分析</span>
  <a href="#oneforall%e5%88%86%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://blog.csdn.net/m0_58434634/article/details/120447411"target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/m0_58434634/article/details/120447411</a></p>
<p><a href="https://zone.huoxian.cn/d/685"target="_blank" rel="external nofollow noopener noreferrer">https://zone.huoxian.cn/d/685</a></p>
<p>oneforall除提供oneforall.py这个入口文件外， 提供了三个常用入口</p>
<pre tabindex="0"><code>brute.py 用于爆破子域名
export.py 用于导出数据
takeover.py #子域接管漏洞 这个不收集子域名</code></pre><p>概括oneforall核心流程如下</p>
<pre tabindex="0"><code>run======&gt;检测泛域名=====&gt;收集模块(Collect)=====&gt;SRV爆破模块(BruteSRV)=====&gt;爆破模块(Brute)=====&gt;dns验证(run_resolve)=====&gt;http验证(run_request)======&gt;子域爬取模块(Finder)=====&gt;子域置换模块(Altdns)=====&gt;丰富输出(Enrich)=====&gt;子域接管模块(Takeover)=====&gt;return</code></pre><h3 id="泛域名" class="heading-element"><span>泛域名</span>
  <a href="#%e6%b3%9b%e5%9f%9f%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>这里的检测泛域名方法为</strong>：生成3个随机域名，如果dns验证和http验证均成功，则判断页面是否相同，如果页面相似就是泛域名；如果dns验证均成功但http验证不成功，那么这个域名也是泛域名；否则不是泛域名。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">def</span> <span style="color:#58a1dd">to_detect_wildcard</span>(<span style="color:#58a1dd">domain</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#a6be9d">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">    Detect use wildcard dns record or not
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">    :param  str  domain:  domain
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">    :return bool use wildcard dns record or not
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">logger</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">log</span>(<span style="color:#a6be9d">&#39;INFOR&#39;</span>, <span style="color:#a6be9d">f</span><span style="color:#a6be9d">&#39;Detecting </span><span style="color:#a6be9d">{</span><span style="color:#58a1dd">domain</span><span style="color:#a6be9d">}</span><span style="color:#a6be9d"> use wildcard dns record or not&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">random_subdomains</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">gen_random_subdomains</span>(<span style="color:#58a1dd">domain</span>, <span style="color:#a6be9d">3</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">all_resolve_success</span>(<span style="color:#58a1dd">random_subdomains</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">return</span> <span style="color:#ff636f">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">is_all_success</span>, <span style="color:#58a1dd">all_request_resp</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">all_request_success</span>(<span style="color:#58a1dd">random_subdomains</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">is_all_success</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">return</span> <span style="color:#ff636f">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">return</span> <span style="color:#58a1dd">any_similar_html</span>(<span style="color:#58a1dd">all_request_resp</span>)</span></span></code></pre></div><p><strong>处理泛域名的方法</strong>：根据所有域名解析后<code>ip</code>和<code>cname</code>出现的次数来判断，如果一个子域名的ip或cname的出现次数超过设置的阈值，则丢弃这个子域名</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">def</span> <span style="color:#58a1dd">check_valid_subdomain</span>(<span style="color:#58a1dd">appear_times</span>, <span style="color:#58a1dd">info</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">ip_str</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">info</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#a6be9d">&#39;ip&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">if</span> <span style="color:#58a1dd">ip_str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">ips</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">ip_str</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">split</span>(<span style="color:#a6be9d">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">for</span> <span style="color:#58a1dd">ip</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">ips</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">ip_num</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">appear_times</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">ip</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">isvalid</span>, <span style="color:#58a1dd">reason</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">is_valid_subdomain</span>(<span style="color:#58a1dd">ip</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">ip</span>, <span style="color:#58a1dd">ip_num</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">ip_num</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">isvalid</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">return</span> <span style="color:#ff636f">False</span>, <span style="color:#58a1dd">reason</span>
</span></span><span style="display:flex;"><span>    <span style="color:#58a1dd">cname_str</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">info</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#a6be9d">&#39;cname&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">if</span> <span style="color:#58a1dd">cname_str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">cnames</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">cname_str</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">split</span>(<span style="color:#a6be9d">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">for</span> <span style="color:#58a1dd">cname</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">cnames</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">cname_num</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">appear_times</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">cname</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">isvalid</span>, <span style="color:#58a1dd">reason</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">is_valid_subdomain</span>(<span style="color:#58a1dd">cname</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">cname</span>, <span style="color:#58a1dd">cname_num</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">cname_num</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">isvalid</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">return</span> <span style="color:#ff636f">False</span>, <span style="color:#58a1dd">reason</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">return</span> <span style="color:#ff636f">True</span>, <span style="color:#a6be9d">&#39;OK&#39;</span></span></span></code></pre></div><h3 id="收集模块collect" class="heading-element"><span>收集模块(Collect)</span>
  <a href="#%e6%94%b6%e9%9b%86%e6%a8%a1%e5%9d%97collect" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>动态加载certificates, check, datasets, dnsquery, intelligence, search文件夹中的模块查询域名这些模块都是一些能一次查询出多个子域名的模块，且模块运行时间相对较少，可进行快速查询，同时使用了多线程加快扫描速度。</p>
<pre tabindex="0"><code>certificates:利用证书透明度收集子域模块 使用在线证书查询接口查询
check:常规检查收集子域模块 例如检测网站证书 robots.txt crossdomain等
datasets:在线子域名查询接口
dnsquery:利用DNS查询收集子域模块
intelligence:利用威胁情报查询
search:利用搜索引擎查询 如google baidu fofa zoomeye等</code></pre><p>看一下谷歌搜索</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">def</span> <span style="color:#58a1dd">search</span>(<span style="color:#58a1dd">self</span>, <span style="color:#58a1dd">domain</span>, <span style="color:#58a1dd">filtered_subdomain</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">&#39;&#39;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#a6be9d">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">        发送搜索请求并做子域匹配
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">        :param str domain: 域名
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">        :param str filtered_subdomain: 过滤的子域
</span></span></span><span style="display:flex;"><span><span style="color:#a6be9d">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">page_num</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">per_page_num</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">50</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">header</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get_header</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">header</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">update</span>({<span style="color:#a6be9d">&#39;User-Agent&#39;</span>: <span style="color:#a6be9d">&#39;Googlebot&#39;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#a6be9d">&#39;Referer&#39;</span>: <span style="color:#a6be9d">&#39;https://www.google.com&#39;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">proxy</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get_proxy</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">source</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">resp</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">init</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">resp</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">cookie</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">resp</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">cookies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">while</span> <span style="color:#ff636f">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">delay</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">random</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">randint</span>(<span style="color:#a6be9d">1</span>, <span style="color:#a6be9d">5</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">sleep</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">delay</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">proxy</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get_proxy</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">source</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">word</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;site:.&#39;</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">domain</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">filtered_subdomain</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">payload</span> <span style="color:#ff636f">=</span> {<span style="color:#a6be9d">&#39;q&#39;</span>: <span style="color:#58a1dd">word</span>, <span style="color:#a6be9d">&#39;start&#39;</span>: <span style="color:#58a1dd">page_num</span>, <span style="color:#a6be9d">&#39;num&#39;</span>: <span style="color:#58a1dd">per_page_num</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#a6be9d">&#39;filter&#39;</span>: <span style="color:#a6be9d">&#39;0&#39;</span>, <span style="color:#a6be9d">&#39;btnG&#39;</span>: <span style="color:#a6be9d">&#39;Search&#39;</span>, <span style="color:#a6be9d">&#39;gbv&#39;</span>: <span style="color:#a6be9d">&#39;1&#39;</span>, <span style="color:#a6be9d">&#39;hl&#39;</span>: <span style="color:#a6be9d">&#39;en&#39;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">resp</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">addr</span>, <span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">payload</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">subdomains</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">match_subdomains</span>(<span style="color:#58a1dd">resp</span>, <span style="color:#58a1dd">fuzzy</span><span style="color:#ff636f">=</span><span style="color:#ff636f">False</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">check_subdomains</span>(<span style="color:#58a1dd">subdomains</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">subdomains</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">update</span>(<span style="color:#58a1dd">subdomains</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">page_num</span> <span style="color:#ff636f">+=</span> <span style="color:#58a1dd">per_page_num</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#39;start=&#39;</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">str</span>(<span style="color:#58a1dd">page_num</span>) <span style="color:#ff636f">not</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">resp</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#39;302 Moved&#39;</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">resp</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span></span></span></code></pre></div><p>这段代码通过几个关键策略来模拟人类的行为，以避免被搜索引擎检测到为自动化脚本。这些策略包括随机延时、使用代理和模拟浏览器请求。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">while</span> <span style="color:#ff636f">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">delay</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">random</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">randint</span>(<span style="color:#a6be9d">1</span>, <span style="color:#a6be9d">5</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">sleep</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">delay</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">目的</span>：<span style="color:#58a1dd">通过随机延时</span>，<span style="color:#58a1dd">模仿人类用户在不同搜索之间的不规则停顿</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">实现</span>：<span style="color:#58a1dd">使用random</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">randint</span>(<span style="color:#a6be9d">1</span>, <span style="color:#a6be9d">5</span>)<span style="color:#58a1dd">生成1到5秒之间的随机数</span>，<span style="color:#58a1dd">并使用time</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">sleep</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">delay</span>)<span style="color:#58a1dd">暂停代码执行相应的秒数</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">效果</span>：<span style="color:#58a1dd">防止搜索引擎识别出固定的请求间隔</span>，<span style="color:#58a1dd">从而降低被识别为机器人请求的风险</span>。
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">proxy</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get_proxy</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">source</span>)
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">目的</span>：<span style="color:#58a1dd">通过使用不同的代理IP地址</span>，<span style="color:#58a1dd">避免来自同一IP地址的大量请求被搜索引擎封锁</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">实现</span>：<span style="color:#58a1dd">调用self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get_proxy</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">source</span>)<span style="color:#58a1dd">方法获取新的代理IP</span>，<span style="color:#58a1dd">并在后续请求中使用该代理</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">效果</span>：<span style="color:#58a1dd">分散请求的源IP地址</span>，<span style="color:#58a1dd">使得请求看起来像是来自不同的用户</span>，<span style="color:#58a1dd">进一步降低被检测的可能性</span>。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">分步处理搜索请求</span>，<span style="color:#58a1dd">避免一次性发送大量请求</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">实现</span>：<span style="color:#58a1dd">在每次循环中</span>，<span style="color:#58a1dd">构造查询参数并发送请求</span>，<span style="color:#58a1dd">解析响应内容</span>，<span style="color:#58a1dd">检查是否有新的子域名</span>，<span style="color:#58a1dd">更新子域名集合</span>。<span style="color:#58a1dd">如果没有新的子域名或遇到特定条件</span>（<span style="color:#58a1dd">如搜索结果不再包含新的页码或返回302跳转</span>），<span style="color:#58a1dd">则退出循环</span>。
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">效果</span>：<span style="color:#58a1dd">逐步发送请求和解析响应</span>，<span style="color:#58a1dd">使得行为更像人类用户逐页浏览搜索结果</span>，<span style="color:#58a1dd">同时通过退出条件避免不必要的请求</span>。
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">word</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;site:.&#39;</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">domain</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">filtered_subdomain</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">payload</span> <span style="color:#ff636f">=</span> {<span style="color:#a6be9d">&#39;q&#39;</span>: <span style="color:#58a1dd">word</span>, <span style="color:#a6be9d">&#39;start&#39;</span>: <span style="color:#58a1dd">page_num</span>, <span style="color:#a6be9d">&#39;num&#39;</span>: <span style="color:#58a1dd">per_page_num</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#a6be9d">&#39;filter&#39;</span>: <span style="color:#a6be9d">&#39;0&#39;</span>, <span style="color:#a6be9d">&#39;btnG&#39;</span>: <span style="color:#a6be9d">&#39;Search&#39;</span>, <span style="color:#a6be9d">&#39;gbv&#39;</span>: <span style="color:#a6be9d">&#39;1&#39;</span>, <span style="color:#a6be9d">&#39;hl&#39;</span>: <span style="color:#a6be9d">&#39;en&#39;</span>}
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">resp</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">get</span>(<span style="color:#58a1dd">url</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">addr</span>, <span style="color:#58a1dd">params</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">payload</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">subdomains</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">match_subdomains</span>(<span style="color:#58a1dd">resp</span>, <span style="color:#58a1dd">fuzzy</span><span style="color:#ff636f">=</span><span style="color:#ff636f">False</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#ff636f">not</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">check_subdomains</span>(<span style="color:#58a1dd">subdomains</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">subdomains</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">update</span>(<span style="color:#58a1dd">subdomains</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">page_num</span> <span style="color:#ff636f">+=</span> <span style="color:#58a1dd">per_page_num</span><span style="color:#828b96;font-style:italic">#下一次搜索的页码增加</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#39;start=&#39;</span> <span style="color:#ff636f">+</span> <span style="color:#58a1dd">str</span>(<span style="color:#58a1dd">page_num</span>) <span style="color:#ff636f">not</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">resp</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span>   <span style="color:#58a1dd">结束的条件</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">if</span> <span style="color:#a6be9d">&#39;302 Moved&#39;</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">resp</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">text</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">break</span></span></span></code></pre></div><h3 id="srv爆破模块brutesrv" class="heading-element"><span>SRV爆破模块(BruteSRV)</span>
  <a href="#srv%e7%88%86%e7%a0%b4%e6%a8%a1%e5%9d%97brutesrv" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这个收集方式还是是第一次遇见，原理是 通过爆破常见的SRV前缀来获取域名</p>
<p>SRV记录是dns记录的一种，一般是为Microsoft的活动目录设置时的应用。DNS可以独立于活动目录，但是活动目录必须有DNS的帮助才能工作。为了活动目录能够正常的工作，DNS服务器必须支持服务定位（SRV）资源记录，资源记录把服务名字映射为提供服务的服务器名字。活动目录客户和域控制器使用SRV资源记录决定域控制器的IP地址。</p>
<p>查询SRV记录的方式：</p>
<pre tabindex="0"><code>nslookup -q=srv _sip._tcp.zonetransfer.me #windows
dig srv _sip._tcp.zonetransfer.me #linux</code></pre><h3 id="爆破模块brute" class="heading-element"><span>爆破模块(Brute)</span>
  <a href="#%e7%88%86%e7%a0%b4%e6%a8%a1%e5%9d%97brute" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>爆破模块主要利用massdns工具来爆破，在这里会进行一次更严格的泛域名检测</p>
<p>执行流程简单来说就是首先检测是不是泛域名，生成字典，通过massdns工具爆破，再然后根据结果生成字典递归爆破二级以上，最后处理泛域名</p>
<h3 id="dns验证run_resolve" class="heading-element"><span>dns验证(run_resolve)</span>
  <a href="#dns%e9%aa%8c%e8%af%81run_resolve" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>通过call_massdns函数调用massdns进行dns验证，这里会将爆破模块扫描出来的子域名再次扫描一次</p>
<h3 id="http验证run_request" class="heading-element"><span>http验证(run_request)</span>
  <a href="#http%e9%aa%8c%e8%af%81run_request" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>将收集到的域名和配置文件中设置的端口生成url，使用requests访问url并验证，记录http请求结果</p>
<p>验证http存活的依据是状态码小于500且不是400</p>
<h3 id="子域爬取模块finder" class="heading-element"><span>子域爬取模块(Finder)</span>
  <a href="#%e5%ad%90%e5%9f%9f%e7%88%ac%e5%8f%96%e6%a8%a1%e5%9d%97finder" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这里主要通过三种方式寻找子域名</p>
<p>1.find_in_history：从URL跳转历史中查找子域名</p>
<p>2.find_in_resp：从返回内容种查找子域名</p>
<p>3.find_js_urls: 从js中查找子域名</p>
<p>子域置换模块(Altdns)
子域替换技术可根据已有的子域生成输出大量可能存在的潜在子域，利用这些潜在子域名进一步获取存活子域名，目前oneforall中主要有5种置换方式，生成规则如下：</p>
<pre tabindex="0"><code>increase_num: test.1.foo.example.com -&gt; test.2.foo.example.com, test.3.foo.example.com, ...
decrease_num: test.4.foo.example.com -&gt; test.3.foo.example.com, test.2.foo.example.com, ...
insert_word: test.1.foo.example.com -&gt; WORD.test.1.foo.example.com,test.WORD.1.foo.example.com,test.1.WORD.foo.example.com,...
add_word: test.1.foo.example.com -&gt;test-WORD.1.foo.example.com #WORD 替换为字典
replace_word: WORD1.1.foo.example.com -&gt; WORD2.1.foo.example.com,WORD3.1.foo.example.com,WORD4.1.foo.example.com,...</code></pre><p>在生成子域名后该模块会对生成的潜在子域名进行dns验证和http验证，利用的也是massdns和requests。</p>
<h3 id="丰富输出enrich" class="heading-element"><span>丰富输出(Enrich)</span>
  <a href="#%e4%b8%b0%e5%af%8c%e8%be%93%e5%87%baenrich" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>增加cidr，asn，org，addr，isp等内容，只是丰富结果，并不会收集新的子域名。</p>
<h3 id="子域接管模块takeover" class="heading-element"><span>子域接管模块(Takeover)</span>
  <a href="#%e5%ad%90%e5%9f%9f%e6%8e%a5%e7%ae%a1%e6%a8%a1%e5%9d%97takeover" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>检测是否存在子域名接管漏洞，不收集新的子域名，具体可参考以下两篇文章</p>
<p><a href="https://zhuanlan.zhihu.com/p/136694063"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/136694063</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/137001519"target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/137001519</a></p>
<h3 id="oneforall存在的一些问题" class="heading-element"><span>oneforall存在的一些问题</span>
  <a href="#oneforall%e5%ad%98%e5%9c%a8%e7%9a%84%e4%b8%80%e4%ba%9b%e9%97%ae%e9%a2%98" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>1.对子域名比较多的域名进行http验证时耗时过长，容易卡死</p>
<p>2.根据流程可发现，如果选择不进行http验证，则收集流程在爆破完成就结束了，后面的泛域名处理，域置换等模块完全不会执行</p>
<p>3.主流程里的泛域名处理方式和爆破里面的处理方式并不一样，主流程只是用出现cname，ip的次数来校验泛域名的，并没有爆破模块那么严格，所以如果阈值不合理，还是有可能多出来一些无效域名</p>
<p>4.递归爆破的问题，如果a.b.xxx.com存在，b.xxx.com不存在，这种情况用递归爆破是扫不出来的</p>
<p>5.只使用了A记录来获取域名，可能会丢失一部分域名</p>
<p>6.没有统一dns服务器，爆破模块和dns验证模块使用的dns服务器可能不一致</p>
<h2 id="互联网收集" class="heading-element"><span>互联网收集</span>
  <a href="#%e4%ba%92%e8%81%94%e7%bd%91%e6%94%b6%e9%9b%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="srv记录查询" class="heading-element"><span>SRV记录查询</span>
  <a href="#srv%e8%ae%b0%e5%bd%95%e6%9f%a5%e8%af%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p>SRV记录（Service Record）是DNS（域名系统）的一种资源记录类型，用于定义指定服务在某个域中的位置。SRV记录包含信息，如服务的主机名、端口号、优先级和权重。这使得服务能够灵活地分配和定位，而不需要硬编码到特定的服务器或IP地址。</p>
<p>SRV记录的典型用途包括：</p>
<ul>
<li><strong>即时消息和语音服务</strong>：例如，SIP（Session Initiation Protocol）和XMPP（Extensible Messaging and Presence Protocol）。</li>
<li><strong>LDAP（轻量级目录访问协议）</strong>：用于查找目录服务的服务器。</li>
</ul>
</blockquote>
<p>SRV记录的格式</p>
<p>SRV记录的格式如下：</p>
<pre tabindex="0"><code>kotlin
复制代码
_service._proto.name. TTL class SRV priority weight port target</code></pre><p>每个字段的含义如下：</p>
<ul>
<li><strong>service</strong>：服务名称，通常以<code>_</code>开头，例如<code>_sip</code>表示SIP服务。</li>
<li><strong>proto</strong>：协议类型，通常为<code>_tcp</code>或<code>_udp</code>。</li>
<li><strong>name</strong>：域名。</li>
<li><strong>TTL</strong>：生存时间，DNS记录的缓存时间。</li>
<li><strong>class</strong>：通常为<code>IN</code>（表示Internet）。</li>
<li><strong>SRV</strong>：资源记录类型。</li>
<li><strong>priority</strong>：优先级，数值越低优先级越高。</li>
<li><strong>weight</strong>：权重，用于在具有相同优先级的服务器之间进行负载均衡。</li>
<li><strong>port</strong>：服务端口号。</li>
<li><strong>target</strong>：提供服务的主机名。</li>
</ul>
<p>示例</p>
<p>一个SRV记录示例如下：</p>
<pre tabindex="0"><code>yaml
复制代码
_sip._tcp.example.com. 3600 IN SRV 10 60 5060 sipserver.example.com.</code></pre><p>这条记录表示：</p>
<ul>
<li>服务是SIP（Session Initiation Protocol）。</li>
<li>使用TCP协议。</li>
<li>属于域<code>example.com</code>。</li>
<li>TTL为3600秒。</li>
<li>优先级为10。</li>
<li>权重为60。</li>
<li>端口号为5060。</li>
<li>提供服务的主机名为<code>sipserver.example.com</code>。</li>
</ul>
<h3 id="https证书透明度" class="heading-element"><span>HTTPS证书透明度</span>
  <a href="#https%e8%af%81%e4%b9%a6%e9%80%8f%e6%98%8e%e5%ba%a6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><blockquote>
<p>证书透明度（Certificate Transparency，简称CT）是由Google发起的一个项目，旨在提高HTTPS证书的安全性和透明度。CT通过创建一个公开的、可审核的日志系统，记录所有已签发的SSL/TLS证书，以便于检测和防止非法或错误的证书签发。</p>
<p><strong>证书透明度的工作原理</strong></p>
<ol>
<li><strong>证书日志</strong>：证书颁发机构（CA）将每一个签发的证书记录到一个或多个公开的CT日志中。这些日志是公开可查询的，任何人都可以查看和审核。</li>
<li><strong>审计和监控</strong>：任何人，包括网站管理员、用户、浏览器等，都可以检查这些日志，验证证书的合法性。浏览器也可以利用这些日志来防止使用未记录的证书。</li>
<li><strong>嵌入SCT</strong>：证书透明度的证明（Signed Certificate Timestamp, SCT）可以嵌入到证书中，或通过TLS扩展提供。这确保了在TLS握手过程中，服务器提供的证书可以被浏览器验证是否存在于CT日志中。</li>
</ol>
</blockquote>
<p>获取子域名</p>
<p>通过查询证书透明度日志，可以发现某个域名下的所有已签发的SSL/TLS证书，进而获取该域名下的子域名。这是因为每个证书都包含一个或多个域名（包括子域名），这些信息在CT日志中是公开的。</p>
<p>如何从证书透明度日志中获取子域名</p>
<ol>
<li><strong>使用证书透明度日志查询工具</strong>：有很多工具和网站提供CT日志查询服务，可以用来查找特定域名的所有证书。例如，<a href="https://crt.sh/"target="_blank" rel="external nofollow noopener noreferrer">crt.sh</a>、<a href="https://censys.io/"target="_blank" rel="external nofollow noopener noreferrer">Censys</a>、Google Certificate Transparency等。</li>
<li><strong>API查询</strong>：一些服务提供API，可以编程方式查询证书透明度日志。例如，Censys和crt.sh都提供API接口，可以通过编写脚本自动化地查询和获取子域名。</li>
</ol>
<h3 id="子域名查询接口" class="heading-element"><span>子域名查询接口</span>
  <a href="#%e5%ad%90%e5%9f%9f%e5%90%8d%e6%9f%a5%e8%af%a2%e6%8e%a5%e5%8f%a3" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>一些在线的查询接口</p>
<h3 id="dns找子域名" class="heading-element"><span>DNS找子域名</span>
  <a href="#dns%e6%89%be%e5%ad%90%e5%9f%9f%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li>
<p>爆破</p>
<p>简单来说就是爆破子域名字符串，如果DNS返回IP就认为这个子域名存在</p>
<p>对于爆破dns来说，有足够多且快的dns server是关键(爆破一段时间后，可能会有dns不再回应请求)</p>
</li>
<li>
<p>DNS域传送子域名漏洞(DNS Zone Transfers)</p>
<p><a href="https://www.freebuf.com/vuls/275451.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.freebuf.com/vuls/275451.html</a></p>
<blockquote>
<p>DNS域传送（Zone Transfer）是DNS服务器之间的一种机制，主要用于同步主DNS服务器和从DNS服务器之间的数据。通过域传送，DNS服务器可以将整个区域文件（包含该域所有DNS记录）复制到从服务器。这在主服务器发生变化时，确保所有DNS服务器都拥有一致的数据。</p>
</blockquote>
<p>示例：<code>dig axfr @ns1.example.com example.com</code></p>
<p><strong>配置限制</strong>：大多数现代DNS服务器默认会限制或禁止未授权的域传送请求。这是为了防止潜在的攻击者获取敏感的DNS信息。</p>
<p><strong>验证</strong>：只有被授权的从DNS服务器才能成功进行域传送。未授权的请求通常会被拒绝。</p>
<p>实现</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff636f">class</span> <span style="color:#58a1dd">DNSTransfer</span>(<span style="color:#58a1dd">object</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">def</span> <span style="color:#58a1dd">__init__</span>(<span style="color:#58a1dd">self</span>, <span style="color:#58a1dd">domain</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">domain</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">domain</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff636f">def</span> <span style="color:#58a1dd">transfer_info</span>(<span style="color:#58a1dd">self</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#58a1dd">ret_zones</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">list</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">nss</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">dns</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">resolver</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">query</span>(<span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">domain</span>, <span style="color:#a6be9d">&#39;NS&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">nameservers</span> <span style="color:#ff636f">=</span> [<span style="color:#58a1dd">str</span>(<span style="color:#58a1dd">ns</span>) <span style="color:#ff636f">for</span> <span style="color:#58a1dd">ns</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">nss</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">ns_addr</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">dns</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">resolver</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">query</span>(<span style="color:#58a1dd">nameservers</span>[<span style="color:#a6be9d">0</span>], <span style="color:#a6be9d">&#39;A&#39;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#828b96;font-style:italic"># dnspython 的 bug，需要设置 lifetime 参数</span>
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">zones</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">dns</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">zone</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">from_xfr</span>(<span style="color:#58a1dd">dns</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">query</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">xfr</span>(<span style="color:#58a1dd">ns_addr</span>, <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">domain</span>, <span style="color:#58a1dd">relativize</span><span style="color:#ff636f">=</span><span style="color:#ff636f">False</span>, <span style="color:#58a1dd">timeout</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">2</span>, <span style="color:#58a1dd">lifetime</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">2</span>), <span style="color:#58a1dd">check_origin</span><span style="color:#ff636f">=</span><span style="color:#ff636f">False</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#58a1dd">names</span> <span style="color:#ff636f">=</span> <span style="color:#58a1dd">zones</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">nodes</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">keys</span>()
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">for</span> <span style="color:#58a1dd">n</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">names</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#58a1dd">subdomain</span> <span style="color:#ff636f">=</span> <span style="color:#a6be9d">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">for</span> <span style="color:#58a1dd">t</span> <span style="color:#ff636f">in</span> <span style="color:#58a1dd">range</span>(<span style="color:#a6be9d">0</span>, <span style="color:#58a1dd">len</span>(<span style="color:#58a1dd">n</span>) <span style="color:#ff636f">-</span> <span style="color:#a6be9d">1</span>):
</span></span><span style="display:flex;"><span>                    <span style="color:#ff636f">if</span> <span style="color:#58a1dd">subdomain</span> <span style="color:#ff636f">!=</span> <span style="color:#a6be9d">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#58a1dd">subdomain</span> <span style="color:#ff636f">+=</span> <span style="color:#a6be9d">&#39;.&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#58a1dd">subdomain</span> <span style="color:#ff636f">+=</span> <span style="color:#58a1dd">str</span>(<span style="color:#58a1dd">n</span>[<span style="color:#58a1dd">t</span>]<span style="color:#ff636f">.</span><span style="color:#58a1dd">decode</span>())
</span></span><span style="display:flex;"><span>                <span style="color:#ff636f">if</span> <span style="color:#58a1dd">subdomain</span> <span style="color:#ff636f">!=</span> <span style="color:#58a1dd">self</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">domain</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#58a1dd">ret_zones</span><span style="color:#ff636f">.</span><span style="color:#58a1dd">append</span>(<span style="color:#58a1dd">subdomain</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">return</span> <span style="color:#58a1dd">ret_zones</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff636f">except</span> <span style="color:#58a1dd">BaseException</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff636f">return</span> []</span></span></code></pre></div></li>
</ul>
<h3 id="威胁情报" class="heading-element"><span>威胁情报</span>
  <a href="#%e5%a8%81%e8%83%81%e6%83%85%e6%8a%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h3 id="搜索引擎查询" class="heading-element"><span>搜索引擎查询</span>
  <a href="#%e6%90%9c%e7%b4%a2%e5%bc%95%e6%93%8e%e6%9f%a5%e8%af%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>针对不同的搜索引擎去写针对性的代码，然后从返回的结果去匹配子域名，这个过程中要注意伪装成正常用户，详细参考oneforall里面的写法</p>
<h2 id="爆破" class="heading-element"><span>爆破</span>
  <a href="#%e7%88%86%e7%a0%b4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>它主要使用massdns工具爆破，这里就引出了面试官另一个题，<strong>为什么会配置两个dns</strong>？</p>
<p>那我们来说一下massdns这个工具，这个工具其实还是利用dns服务器与子域名字典进行匹配爆破，那他为什么会有两个dns服务器呢，因为一个在国内一个在国外，不在国外使用国外服务器，在国内使用国内服务器；其他因素要参考处理泛解析。</p>
<h2 id="子域名查找" class="heading-element"><span>子域名查找</span>
  <a href="#%e5%ad%90%e5%9f%9f%e5%90%8d%e6%9f%a5%e6%89%be" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>历史查询</p>
<p>页面响应内容中出现的子域名，如js查询</p>
<p>跳转过程中的子域名</p>
<h2 id="泛解析域名" class="heading-element"><span>泛解析域名</span>
  <a href="#%e6%b3%9b%e8%a7%a3%e6%9e%90%e5%9f%9f%e5%90%8d" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><blockquote>
<p>泛解析域名（Wildcard Domain）是一种DNS配置，允许在同一域名下的所有子域名都解析到同一IP地址或一组IP地址。泛解析通常用于简化域名管理，使得不论用户访问哪个子域名，都能指向相同的资源。</p>
</blockquote>
<p>在DNS配置中，泛解析域名的记录通常以星号 (<code>*</code>) 开头，表示匹配所有子域名。例如，假设有一个域名<code>example.com</code>，其泛解析记录可以配置为：</p>
<pre tabindex="0"><code>*.example.com   A   192.0.2.1</code></pre><p>另一个例子是CNAME记录：</p>
<pre tabindex="0"><code>*.example.com   CNAME   www.example.com</code></pre><p>这表示所有子域名都指向<code>www.example.com</code>。</p>
<p>判断一个域名是否配置了泛解析，可以通过以下步骤：</p>
<ol>
<li><strong>查询多个随机子域名</strong>：
<ul>
<li>选择几个随机的、不存在的子域名进行DNS查询。例如，查询<code>random1.example.com</code>、<code>random2.example.com</code>等。</li>
</ul>
</li>
<li><strong>比较解析结果</strong>：
<ul>
<li>如果这些随机子域名解析到了相同的IP地址或相同的CNAME记录，则很可能存在泛解析配置。</li>
</ul>
</li>
<li>在权威 DNS 中，==泛解析记录的 TTL 肯定是相同的==，如果子域名记录相同，但 TTL 不同，那这条记录可以说肯定不是泛解析记录。</li>
</ol>
<p>脚本实现：</p>
<ul>
<li>生成三个随机域名，然后挨个匹配，如果页面相同存在泛解析；域名解析成功，http解析不成功也是泛解析；否侧不是泛解析。</li>
<li>匹配IP跟Cname次数，超过他设置的值就直接抛弃</li>
</ul>
<h2 id="验证" class="heading-element"><span>验证</span>
  <a href="#%e9%aa%8c%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>DNS验证模块</p>
<p>将结果重新进行DNS解析扫描</p>
<p>HTTP验证模块</p>
<p>这个其实很简单，就是在域名前加http头部进行访问不是500也不是400默认就是存活。</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2024-08-15 09:31:01">Updated on 2024-08-15&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/%E5%AE%89%E5%85%A8%E5%BC%80%E5%8F%91/" class="post-tag" title="Tags - 安全开发">安全开发</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/%E9%80%9A%E7%94%A8/35/" class="post-nav-item" rel="prev" title="软连接在CTF的应用"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>软连接在CTF的应用</a>
      <a href="/posts/owasp/http%E8%B5%B0%E7%A7%81/115/" class="post-nav-item" rel="next" title="请求走私学习">请求走私学习<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
<a href="https://statcounter.com/p13160752/?guest=1" target="_blank">访问量统计</a> 

<script type="text/javascript">
var sc_project=13160752;
var sc_invisible=0;
var sc_security="211d0342";
var scJsHost = "https://";
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost +
"statcounter.com/counter/counter.js'></"+"script>");
</script>

<noscript>
  <div class="statcounter">
    <a title="web stats" href="https://statcounter.com/" target="_blank">
      <img referrerPolicy="no-referrer-when-downgrade">
    </a>
  </div>
</noscript>


    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.132.1">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.9">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">东隅</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/instant-page/instantpage.min.js" async defer type="module"></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":20},"comment":{"enable":false},"typeit":{"cursorChar":"_","cursorSpeed":1000,"duration":-1,"loop":false,"speed":100},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-YMSM8DYT3D', { 'anonymize_ip': true });
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-YMSM8DYT3D" async></script></body>
</html>
